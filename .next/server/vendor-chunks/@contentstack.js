"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/@contentstack";
exports.ids = ["vendor-chunks/@contentstack"];
exports.modules = {

/***/ "(ssr)/./node_modules/@contentstack/utils/dist/index.es.js":
/*!***********************************************************!*\
  !*** ./node_modules/@contentstack/utils/dist/index.es.js ***!
  \***********************************************************/
/***/ ((__unused_webpack_module, exports) => {

eval("\n\nfunction replaceHtmlEntities(text) {\r\n    return text\r\n        .replace(/&/g, '&amp;')\r\n        .replace(/</g, '&lt;')\r\n        .replace(/>/g, '&gt;')\r\n        .replace(/\"/g, '&quot;');\r\n}\r\nvar forbiddenAttrChars = ['\"', \"'\", '>', '<', '/', '='];\n\nfunction createMetadata(attribute) {\r\n    return {\r\n        text: attribute['#text'],\r\n        itemUid: attribute['data-sys-entry-uid'] || attribute['data-sys-asset-uid'],\r\n        itemType: attribute.type,\r\n        styleType: attribute['sys-style-type'],\r\n        attributes: attribute,\r\n        contentTypeUid: attribute['data-sys-content-type-uid'],\r\n    };\r\n}\r\nfunction nodeToMetadata(attribute, textNode) {\r\n    return {\r\n        text: textNode.text,\r\n        itemUid: attribute['entry-uid'] || attribute['asset-uid'],\r\n        itemType: attribute.type,\r\n        styleType: attribute['display-type'],\r\n        attributes: attribute,\r\n        contentTypeUid: attribute['content-type-uid'],\r\n    };\r\n}\r\nfunction attributeToString(attributes) {\r\n    var result = '';\r\n    var _loop_1 = function (key) {\r\n        if (Object.prototype.hasOwnProperty.call(attributes, key)) {\r\n            if (forbiddenAttrChars.some(function (char) { return key.includes(char); })) {\r\n                return \"continue\";\r\n            }\r\n            var value = attributes[key];\r\n            if (Array.isArray(value)) {\r\n                value = value.join(', ');\r\n            }\r\n            else if (typeof value === 'object') {\r\n                var elementString = '';\r\n                for (var subKey in value) {\r\n                    if (Object.prototype.hasOwnProperty.call(value, subKey)) {\r\n                        var subValue = value[subKey];\r\n                        if (subValue != null && subValue !== '') {\r\n                            elementString += \"\".concat(subKey, \":\").concat(subValue, \"; \");\r\n                        }\r\n                    }\r\n                }\r\n                value = elementString;\r\n            }\r\n            result += \" \".concat(key, \"=\\\"\").concat(replaceHtmlEntities(String(value)), \"\\\"\");\r\n        }\r\n    };\r\n    for (var key in attributes) {\r\n        _loop_1(key);\r\n    }\r\n    return result;\r\n}\n\nvar StyleType;\r\n(function (StyleType) {\r\n    StyleType[\"BLOCK\"] = \"block\";\r\n    StyleType[\"INLINE\"] = \"inline\";\r\n    StyleType[\"LINK\"] = \"link\";\r\n    StyleType[\"DISPLAY\"] = \"display\";\r\n    StyleType[\"DOWNLOAD\"] = \"download\";\r\n})(StyleType || (StyleType = {}));\r\nvar StyleType$1 = StyleType;\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\ntypeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\n\nfunction elementToJson(element) {\r\n    var obj = {};\r\n    for (var i = 0; i < element.attributes.length; i++) {\r\n        obj[element.attributes.item(i).name] = element.attributes.item(i).value;\r\n    }\r\n    element.childNodes.forEach(function (chileNode) {\r\n        var node = (chileNode);\r\n        obj = __assign(__assign({}, obj), parseElement(node));\r\n    });\r\n    return obj;\r\n}\r\nfunction parseElement(node) {\r\n    var obj = {};\r\n    if (node.nodeType === 3) {\r\n        obj['#text'] = node.textContent;\r\n    }\r\n    else if (node.nodeType === 1) {\r\n        obj[node.nodeName.toLowerCase()] = elementToJson(node);\r\n    }\r\n    return obj;\r\n}\n\nvar frameflag = 'documentfragmentcontainer';\r\nString.prototype.forEachEmbeddedItem = function (callbackfn) {\r\n    var str = \"<\".concat(frameflag, \">\").concat(this.toString(), \"</\").concat(frameflag, \">\");\r\n    var root = (new DOMParser()).parseFromString(str, 'text/html');\r\n    var embeddedEntries = root.querySelectorAll(\".embedded-entry\");\r\n    embeddedEntries.forEach(function (element) {\r\n        callbackfn(element.outerHTML, createMetadata(elementToJson(element)));\r\n    });\r\n    var embeddedAsset = root.querySelectorAll(\".embedded-asset\");\r\n    embeddedAsset.forEach(function (element) {\r\n        callbackfn(element.outerHTML, createMetadata(elementToJson(element)));\r\n    });\r\n};\n\nfunction sanitizeHTML(input, allowedTags, allowedAttributes) {\r\n    if (allowedTags === void 0) { allowedTags = ['p', 'a', 'strong', 'em', 'ul', 'ol', 'li', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'sub', 'u', 'table', 'thead', 'tbody', 'tr', 'th', 'td', 'span', 'fragment', 'sup', 'strike', 'br', 'img', 'colgroup', 'col', 'div']; }\r\n    if (allowedAttributes === void 0) { allowedAttributes = ['href', 'title', 'target', 'alt', 'src', 'class', 'id', 'style', 'colspan', 'rowspan', 'content-type-uid', 'data-sys-asset-uid', 'sys-style-type', 'data-type', 'data-width', 'data-rows', 'data-cols', 'data-mtec']; }\r\n    // Replace newline characters with <br /> before processing the HTML tags\r\n    input = input.replace(/\\n/g, '<br />');\r\n    // Regular expression to find and remove all HTML tags except the allowed ones\r\n    var sanitized = input.replace(/<\\/?([a-z][a-z0-9]*)\\b[^<>]*>/gi, function (match, tag) {\r\n        return allowedTags.includes(tag.toLowerCase()) ? match : '';\r\n    });\r\n    // Regular expression to remove all attributes except the allowed ones\r\n    var cleaned = sanitized.replace(/<([a-z][a-z0-9]*)\\b[^<>]*>/gi, function (match, tag) {\r\n        if (!allowedTags.includes(tag.toLowerCase())) {\r\n            return match; // Ignore tags not in allowedTags\r\n        }\r\n        // For each tag that is allowed, clean its attributes\r\n        return match.replace(/\\s([a-z\\-]+)=['\"][^'\"]*['\"]/gi, function (attributeMatch, attribute) {\r\n            return allowedAttributes.includes(attribute.toLowerCase()) ? attributeMatch : '';\r\n        });\r\n    });\r\n    return cleaned;\r\n}\n\nvar _a$1;\r\nvar defaultOptions = (_a$1 = {},\r\n    _a$1[StyleType$1.BLOCK] = function (item) {\r\n        var title = sanitizeHTML(item.title || item.uid);\r\n        var content_type_uid = sanitizeHTML(item._content_type_uid || (item.system ? item.system.content_type_uid : ''));\r\n        return \"<div><p>\".concat(title, \"</p><p>Content type: <span>\").concat(content_type_uid, \"</span></p></div>\");\r\n    },\r\n    _a$1[StyleType$1.INLINE] = function (item) {\r\n        var title = sanitizeHTML(item.title || item.uid);\r\n        return \"<span>\".concat(title, \"</span>\");\r\n    },\r\n    _a$1[StyleType$1.LINK] = function (item, metadata) {\r\n        var url = item.url ? encodeURI(sanitizeHTML(item.url)) : null;\r\n        var text = sanitizeHTML(metadata.text || item.title || item.uid || (item.system ? item.system.uid : ''));\r\n        var hrefAttr = url ? \" href=\\\"\".concat(url, \"\\\"\") : '';\r\n        return \"<a\".concat(hrefAttr, \">\").concat(text, \"</a>\");\r\n    },\r\n    _a$1[StyleType$1.DISPLAY] = function (item, metadata) {\r\n        var url = item.url ? encodeURI(sanitizeHTML(item.url)) : null;\r\n        var alt = sanitizeHTML(metadata.attributes.alt || item.title || item.filename || item.uid\r\n            || (item.system ? item.system.uid : ''));\r\n        var srcAttr = url ? \" src=\\\"\".concat(url, \"\\\"\") : '';\r\n        return \"<img\".concat(srcAttr, \" alt=\\\"\").concat(alt, \"\\\" />\");\r\n    },\r\n    _a$1[StyleType$1.DOWNLOAD] = function (item, metadata) {\r\n        var href = item.url ? encodeURI(sanitizeHTML(item.url)) : null;\r\n        var text = sanitizeHTML(metadata.text || item.title || item.uid || (item.system ? item.system.content_type_uid : ''));\r\n        var hrefAttr = href ? \" href=\\\"\".concat(href, \"\\\"\") : '';\r\n        return \"<a\".concat(hrefAttr, \">\").concat(text, \"</a>\");\r\n    },\r\n    _a$1);\n\n// This function will find Embedded object present in string\r\nfunction findEmbeddedEntry(uid, contentTypeUid, embeddeditems) {\r\n    if (embeddeditems === void 0) { embeddeditems = []; }\r\n    return embeddeditems.filter(function (entry) {\r\n        if (!entry)\r\n            return false;\r\n        return ((entry.uid && entry.uid === uid && entry._content_type_uid === contentTypeUid) ||\r\n            (entry.system && entry.system.uid === uid && entry.system.content_type_uid === contentTypeUid));\r\n    });\r\n}\r\nfunction findEmbeddedAsset(uid, embeddedAssets) {\r\n    if (embeddedAssets === void 0) { embeddedAssets = []; }\r\n    return embeddedAssets.filter(function (asset) {\r\n        if (!asset)\r\n            return false;\r\n        return ((asset.uid && asset.uid === uid) ||\r\n            (asset.system && asset.system.uid === uid));\r\n    });\r\n}\r\nfunction findGQLEmbeddedItems(metadata, items) {\r\n    if (!metadata || !items)\r\n        return [];\r\n    if (metadata.itemType === 'entry') {\r\n        return findEmbeddedEntry(metadata.itemUid, metadata.contentTypeUid, items);\r\n    }\r\n    else {\r\n        return findEmbeddedAsset(metadata.itemUid, items);\r\n    }\r\n}\r\nfunction findEmbeddedItems(object, entry) {\r\n    if (object && object !== undefined && entry && entry !== undefined) {\r\n        if (entry._embedded_items !== undefined) {\r\n            var entryEmbedable = entry;\r\n            var items = Object.values(entryEmbedable._embedded_items || []).reduce(function (accumulator, value) { return accumulator.concat(value); }, []);\r\n            return findGQLEmbeddedItems(object, items);\r\n        }\r\n    }\r\n    return [];\r\n}\r\nfunction findRenderString(item, metadata, renderOptions) {\r\n    if ((!item && item === undefined) || (!metadata && metadata === undefined)) {\r\n        return '';\r\n    }\r\n    if (renderOptions && renderOptions[metadata.styleType] !== undefined) {\r\n        var renderFunction = renderOptions[metadata.styleType];\r\n        if (metadata.attributes['data-sys-content-type-uid'] !== undefined &&\r\n            typeof renderFunction !== 'function' &&\r\n            renderFunction[metadata.attributes['data-sys-content-type-uid']] !== undefined) {\r\n            return renderFunction[metadata.attributes['data-sys-content-type-uid']](item, metadata);\r\n        }\r\n        else if (metadata.attributes['data-sys-content-type-uid'] !== undefined &&\r\n            typeof renderFunction !== 'function' &&\r\n            renderFunction.$default !== undefined) {\r\n            return renderFunction.$default(item, metadata);\r\n        }\r\n        else if (metadata.contentTypeUid !== undefined &&\r\n            typeof renderFunction !== 'function' &&\r\n            renderFunction[metadata.contentTypeUid] !== undefined) {\r\n            return renderFunction[metadata.contentTypeUid](item, metadata);\r\n        }\r\n        else if (metadata.contentTypeUid !== undefined &&\r\n            typeof renderFunction !== 'function' &&\r\n            renderFunction.$default !== undefined) {\r\n            return renderFunction.$default(item, metadata);\r\n        }\r\n        else if (typeof renderFunction === 'function') {\r\n            return renderFunction(item, metadata);\r\n        }\r\n    }\r\n    var defaultRenderFunction = defaultOptions[metadata.styleType];\r\n    return defaultRenderFunction(item, metadata);\r\n}\n\nfunction findRenderContent(keyPaths, entry, render) {\r\n    getContent(keyPaths.split(\".\"), entry, render);\r\n}\r\nfunction getContent(keys, object, render) {\r\n    if (keys) {\r\n        var key = keys[0];\r\n        if (keys.length === 1 && object[key]) {\r\n            object[key] = render(object[key]);\r\n        }\r\n        else if (keys.length > 0) {\r\n            if (object[key]) {\r\n                var newKeys = keys.slice(1);\r\n                if (Array.isArray(object[key])) {\r\n                    // tslint:disable-next-line: prefer-for-of\r\n                    for (var _i = 0, _a = object[key]; _i < _a.length; _i++) {\r\n                        var objKey = _a[_i];\r\n                        getContent(newKeys, objKey, render);\r\n                    }\r\n                }\r\n                else if (typeof object[key] === 'object') {\r\n                    getContent(newKeys, object[key], render);\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\n\n/**\r\n *\r\n * @param {EntryEmbedable| EntryEmbedable[]} entry - Objects that contains RTE with embedded objects\r\n * @param {string[]} paths - Key paths for RTE contents in Entry object\r\n * @param {RenderOption?} renderOption -  Optional render options to render content\r\n */\r\nfunction render(option) {\r\n    function findContent(path, entry) {\r\n        findRenderContent(path, entry, function (content) {\r\n            return renderContent(content, { entry: entry, renderOption: option.renderOption });\r\n        });\r\n    }\r\n    function findAndRender(entry) {\r\n        if (!option.paths || option.paths.length === 0) {\r\n            Object.keys(__assign({}, entry._embedded_items)).forEach(function (path) {\r\n                findContent(path, entry);\r\n            });\r\n        }\r\n        else {\r\n            option.paths.forEach(function (path) {\r\n                findContent(path, entry);\r\n            });\r\n        }\r\n    }\r\n    if (option.entry instanceof Array) {\r\n        option.entry.forEach(function (entry) {\r\n            findAndRender(entry);\r\n        });\r\n    }\r\n    else {\r\n        findAndRender(option.entry);\r\n    }\r\n}\r\n/**\r\n *\r\n * @param {string | string[]} content - RTE content to render\r\n * @param {EntryEmbedable} options.entry - Entry object containing embedded objects\r\n * @param {RenderOption?} options.renderOption - Optional render options to render content\r\n */\r\nfunction renderContent(content, option) {\r\n    // return blank if content not present\r\n    if (!content || content === undefined) {\r\n        return '';\r\n    }\r\n    // render content of type string\r\n    if (typeof content === 'string') {\r\n        var contentToReplace_1 = content;\r\n        content.forEachEmbeddedItem(function (embededObjectTag, object) {\r\n            contentToReplace_1 = findAndReplaceEmbeddedItem(contentToReplace_1, embededObjectTag, object, option);\r\n        });\r\n        return contentToReplace_1;\r\n    }\r\n    // render content of type array of string\r\n    var resultContent = [];\r\n    content.forEach(function (element) {\r\n        resultContent.push(renderContent(element, option));\r\n    });\r\n    return resultContent;\r\n}\r\nfunction findAndReplaceEmbeddedItem(content, embededObjectTag, metadata, option) {\r\n    var embeddedObjects = findEmbeddedItems(metadata, option.entry);\r\n    var renderString = findRenderString(embeddedObjects[0], metadata, option.renderOption);\r\n    return content.replace(embededObjectTag, renderString);\r\n}\n\nvar NodeType;\r\n(function (NodeType) {\r\n    NodeType[\"DOCUMENT\"] = \"doc\";\r\n    NodeType[\"PARAGRAPH\"] = \"p\";\r\n    NodeType[\"LINK\"] = \"a\";\r\n    NodeType[\"IMAGE\"] = \"img\";\r\n    NodeType[\"EMBED\"] = \"embed\";\r\n    NodeType[\"HEADING_1\"] = \"h1\";\r\n    NodeType[\"HEADING_2\"] = \"h2\";\r\n    NodeType[\"HEADING_3\"] = \"h3\";\r\n    NodeType[\"HEADING_4\"] = \"h4\";\r\n    NodeType[\"HEADING_5\"] = \"h5\";\r\n    NodeType[\"HEADING_6\"] = \"h6\";\r\n    NodeType[\"ORDER_LIST\"] = \"ol\";\r\n    NodeType[\"UNORDER_LIST\"] = \"ul\";\r\n    NodeType[\"LIST_ITEM\"] = \"li\";\r\n    NodeType[\"FRAGMENT\"] = \"fragment\";\r\n    NodeType[\"HR\"] = \"hr\";\r\n    NodeType[\"TABLE\"] = \"table\";\r\n    NodeType[\"TABLE_HEADER\"] = \"thead\";\r\n    NodeType[\"TABLE_BODY\"] = \"tbody\";\r\n    NodeType[\"TABLE_FOOTER\"] = \"tfoot\";\r\n    NodeType[\"TABLE_ROW\"] = \"tr\";\r\n    NodeType[\"TABLE_HEAD\"] = \"th\";\r\n    NodeType[\"TABLE_DATA\"] = \"td\";\r\n    NodeType[\"COL_GROUP\"] = \"colgroup\";\r\n    NodeType[\"COL\"] = \"col\";\r\n    NodeType[\"BLOCK_QUOTE\"] = \"blockquote\";\r\n    NodeType[\"CODE\"] = \"code\";\r\n    NodeType[\"TEXT\"] = \"text\";\r\n    NodeType[\"REFERENCE\"] = \"reference\";\r\n})(NodeType || (NodeType = {}));\r\nvar NodeType$1 = NodeType;\n\nvar MarkType;\r\n(function (MarkType) {\r\n    MarkType[\"BOLD\"] = \"bold\";\r\n    MarkType[\"ITALIC\"] = \"italic\";\r\n    MarkType[\"UNDERLINE\"] = \"underline\";\r\n    MarkType[\"CLASSNAME_OR_ID\"] = \"classnameOrId\";\r\n    MarkType[\"STRIKE_THROUGH\"] = \"strikethrough\";\r\n    MarkType[\"INLINE_CODE\"] = \"inlineCode\";\r\n    MarkType[\"SUBSCRIPT\"] = \"subscript\";\r\n    MarkType[\"SUPERSCRIPT\"] = \"superscript\";\r\n    MarkType[\"BREAK\"] = \"break\";\r\n})(MarkType || (MarkType = {}));\r\nvar MarkType$1 = MarkType;\n\nvar Node = /** @class */ (function () {\r\n    function Node() {\r\n    }\r\n    return Node;\r\n}());\n\nvar Document = /** @class */ (function (_super) {\r\n    __extends(Document, _super);\r\n    function Document() {\r\n        var _this = _super.call(this) || this;\r\n        _this.type = NodeType$1.DOCUMENT;\r\n        return _this;\r\n    }\r\n    return Document;\r\n}(Node));\n\nvar TextNode = /** @class */ (function (_super) {\r\n    __extends(TextNode, _super);\r\n    function TextNode(text) {\r\n        var _this = _super.call(this) || this;\r\n        _this.text = text;\r\n        return _this;\r\n    }\r\n    return TextNode;\r\n}(Node));\n\nvar _a;\r\n/**\r\n * Safely gets an attribute value from node.attrs\r\n */\r\nfunction getAttr(node, key) {\r\n    var _a;\r\n    return (_a = node.attrs) === null || _a === void 0 ? void 0 : _a[key];\r\n}\r\n/**\r\n * Safely gets a string attribute value from node.attrs\r\n */\r\nfunction getAttrString(node, key) {\r\n    var _a;\r\n    var value = (_a = node.attrs) === null || _a === void 0 ? void 0 : _a[key];\r\n    return typeof value === 'string' ? value : undefined;\r\n}\r\n/**\r\n * Builds common HTML attributes string (style, class-name, id)\r\n */\r\nfunction buildCommonAttrs(node) {\r\n    if (!node.attrs)\r\n        return '';\r\n    var attrs = [];\r\n    if (node.attrs.style) {\r\n        attrs.push(\" style=\\\"\".concat(node.attrs.style, \"\\\"\"));\r\n    }\r\n    if (node.attrs['class-name']) {\r\n        attrs.push(\" class=\\\"\".concat(node.attrs['class-name'], \"\\\"\"));\r\n    }\r\n    if (node.attrs.id) {\r\n        attrs.push(\" id=\\\"\".concat(node.attrs.id, \"\\\"\"));\r\n    }\r\n    return attrs.join('');\r\n}\r\nvar defaultNodeOption = (_a = {},\r\n    _a[NodeType$1.DOCUMENT] = function () {\r\n        return \"\";\r\n    },\r\n    _a[NodeType$1.PARAGRAPH] = function (node, next) {\r\n        return \"<p\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</p>\");\r\n    },\r\n    _a[NodeType$1.LINK] = function (node, next) {\r\n        var href = getAttrString(node, 'href') || getAttrString(node, 'url') || '';\r\n        var sanitizedHref = sanitizeHTML(href);\r\n        var target = getAttrString(node, 'target');\r\n        var targetAttr = target ? \" target=\\\"\".concat(target, \"\\\"\") : '';\r\n        return \"<a\".concat(buildCommonAttrs(node)).concat(sanitizedHref ? \" href=\\\"\".concat(sanitizedHref, \"\\\"\") : '').concat(targetAttr, \">\").concat(sanitizeHTML(next(node.children)), \"</a>\");\r\n    },\r\n    _a[NodeType$1.IMAGE] = function (node, next) {\r\n        var src = getAttrString(node, 'src') || getAttrString(node, 'url');\r\n        var sanitizedSrc = src ? encodeURI(sanitizeHTML(src)) : '';\r\n        return \"<img\".concat(buildCommonAttrs(node)).concat(sanitizedSrc ? \" src=\\\"\".concat(sanitizedSrc, \"\\\"\") : '', \" />\").concat(sanitizeHTML(next(node.children)));\r\n    },\r\n    _a[NodeType$1.EMBED] = function (node, next) {\r\n        var src = getAttrString(node, 'src') || getAttrString(node, 'url');\r\n        var sanitizedSrc = src ? encodeURI(sanitizeHTML(src)) : '';\r\n        return \"<iframe\".concat(buildCommonAttrs(node)).concat(sanitizedSrc ? \" src=\\\"\".concat(sanitizedSrc, \"\\\"\") : '', \">\").concat(sanitizeHTML(next(node.children)), \"</iframe>\");\r\n    },\r\n    _a[NodeType$1.HEADING_1] = function (node, next) {\r\n        return \"<h1\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</h1>\");\r\n    },\r\n    _a[NodeType$1.HEADING_2] = function (node, next) {\r\n        return \"<h2\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</h2>\");\r\n    },\r\n    _a[NodeType$1.HEADING_3] = function (node, next) {\r\n        return \"<h3\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</h3>\");\r\n    },\r\n    _a[NodeType$1.HEADING_4] = function (node, next) {\r\n        return \"<h4\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</h4>\");\r\n    },\r\n    _a[NodeType$1.HEADING_5] = function (node, next) {\r\n        return \"<h5\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</h5>\");\r\n    },\r\n    _a[NodeType$1.HEADING_6] = function (node, next) {\r\n        return \"<h6\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</h6>\");\r\n    },\r\n    _a[NodeType$1.ORDER_LIST] = function (node, next) {\r\n        return \"<ol\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</ol>\");\r\n    },\r\n    _a[NodeType$1.FRAGMENT] = function (node, next) {\r\n        return \"<fragment>\".concat(sanitizeHTML(next(node.children)), \"</fragment>\");\r\n    },\r\n    _a[NodeType$1.UNORDER_LIST] = function (node, next) {\r\n        return \"<ul\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</ul>\");\r\n    },\r\n    _a[NodeType$1.LIST_ITEM] = function (node, next) {\r\n        return \"<li\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</li>\");\r\n    },\r\n    _a[NodeType$1.HR] = function () {\r\n        return \"<hr>\";\r\n    },\r\n    _a[NodeType$1.TABLE] = function (node, next) {\r\n        // Generate colgroup if colWidths attribute is present\r\n        var colgroupHTML = '';\r\n        var colWidths = getAttr(node, 'colWidths');\r\n        if (colWidths && Array.isArray(colWidths)) {\r\n            var totalWidth_1 = colWidths.reduce(function (sum, width) { return sum + width; }, 0);\r\n            colgroupHTML = \"<\".concat(NodeType$1.COL_GROUP, \" data-width=\\\"\").concat(totalWidth_1, \"\\\">\");\r\n            colWidths.forEach(function (colWidth) {\r\n                var widthPercentage = (colWidth / totalWidth_1) * 100;\r\n                colgroupHTML += \"<\".concat(NodeType$1.COL, \" style=\\\"width:\").concat(widthPercentage.toFixed(2), \"%\\\"/>\");\r\n            });\r\n            colgroupHTML += \"</\".concat(NodeType$1.COL_GROUP, \">\");\r\n        }\r\n        // Generate table with colgroup and other attributes\r\n        return \"<table\".concat(buildCommonAttrs(node), \">\").concat(colgroupHTML).concat(sanitizeHTML(next(node.children)), \"</table>\");\r\n    },\r\n    _a[NodeType$1.TABLE_HEADER] = function (node, next) {\r\n        return \"<thead\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</thead>\");\r\n    },\r\n    _a[NodeType$1.TABLE_BODY] = function (node, next) {\r\n        return \"<tbody\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</tbody>\");\r\n    },\r\n    _a[NodeType$1.TABLE_FOOTER] = function (node, next) {\r\n        return \"<tfoot\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</tfoot>\");\r\n    },\r\n    _a[NodeType$1.TABLE_ROW] = function (node, next) {\r\n        return \"<tr\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</tr>\");\r\n    },\r\n    _a[NodeType$1.TABLE_HEAD] = function (node, next) {\r\n        if (getAttr(node, 'void'))\r\n            return '';\r\n        var rowSpan = getAttr(node, 'rowSpan');\r\n        var colSpan = getAttr(node, 'colSpan');\r\n        var rowSpanAttr = rowSpan ? \" rowspan=\\\"\".concat(rowSpan, \"\\\"\") : '';\r\n        var colSpanAttr = colSpan ? \" colspan=\\\"\".concat(colSpan, \"\\\"\") : '';\r\n        return \"<th\".concat(rowSpanAttr).concat(colSpanAttr).concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</th>\");\r\n    },\r\n    _a[NodeType$1.TABLE_DATA] = function (node, next) {\r\n        if (getAttr(node, 'void'))\r\n            return '';\r\n        var rowSpan = getAttr(node, 'rowSpan');\r\n        var colSpan = getAttr(node, 'colSpan');\r\n        var rowSpanAttr = rowSpan ? \" rowspan=\\\"\".concat(rowSpan, \"\\\"\") : '';\r\n        var colSpanAttr = colSpan ? \" colspan=\\\"\".concat(colSpan, \"\\\"\") : '';\r\n        return \"<td\".concat(rowSpanAttr).concat(colSpanAttr).concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</td>\");\r\n    },\r\n    _a[NodeType$1.BLOCK_QUOTE] = function (node, next) {\r\n        return \"<blockquote\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</blockquote>\");\r\n    },\r\n    _a[NodeType$1.CODE] = function (node, next) {\r\n        return \"<code\".concat(buildCommonAttrs(node), \">\").concat(sanitizeHTML(next(node.children)), \"</code>\");\r\n    },\r\n    _a['reference'] = function (node, next) {\r\n        var type = getAttr(node, 'type');\r\n        var displayType = getAttr(node, 'display-type');\r\n        if ((type === 'entry' || type === 'asset') && displayType === 'link') {\r\n            var href = getAttrString(node, 'href') || getAttrString(node, 'url') || '';\r\n            var target = getAttrString(node, 'target');\r\n            var assetUid = getAttrString(node, 'asset-uid');\r\n            var aTagAttrs = buildCommonAttrs(node);\r\n            if (href)\r\n                aTagAttrs += \" href=\\\"\".concat(href, \"\\\"\");\r\n            if (target) {\r\n                aTagAttrs += \" target=\\\"\".concat(target, \"\\\"\");\r\n            }\r\n            if (type === 'asset') {\r\n                aTagAttrs += \" type=\\\"asset\\\" content-type-uid=\\\"sys_assets\\\"\";\r\n                if (assetUid) {\r\n                    aTagAttrs += \" data-sys-asset-uid=\\\"\".concat(assetUid, \"\\\"\");\r\n                }\r\n                aTagAttrs += \" sys-style-type=\\\"download\\\"\";\r\n            }\r\n            return \"<a\".concat(aTagAttrs, \">\").concat(sanitizeHTML(next(node.children)), \"</a>\");\r\n        }\r\n        if (type === 'asset') {\r\n            var assetLink = getAttrString(node, 'asset-link');\r\n            var src = assetLink ? encodeURI(assetLink) : '';\r\n            var redactorAttrs = getAttr(node, 'redactor-attributes');\r\n            var alt = redactorAttrs === null || redactorAttrs === void 0 ? void 0 : redactorAttrs['alt'];\r\n            var link = getAttrString(node, 'link');\r\n            var target = getAttrString(node, 'target') || \"\";\r\n            var caption = (redactorAttrs === null || redactorAttrs === void 0 ? void 0 : redactorAttrs['asset-caption']) || getAttrString(node, 'asset-caption') || \"\";\r\n            var style = getAttrString(node, 'style');\r\n            var assetUid = getAttrString(node, 'asset-uid');\r\n            var className = getAttrString(node, 'class-name');\r\n            var assetUidAttr = assetUid ? \" asset_uid=\\\"\".concat(assetUid, \"\\\"\") : '';\r\n            var classAttr = className ? \" class=\\\"\".concat(sanitizeHTML(className), \"\\\"\") : '';\r\n            var srcAttr = src ? \" src=\\\"\".concat(sanitizeHTML(src), \"\\\"\") : '';\r\n            var altAttr = alt ? \" alt=\\\"\".concat(alt, \"\\\"\") : '';\r\n            var targetAttr = target === \"_blank\" ? \" target=\\\"_blank\\\"\" : '';\r\n            var styleAttr = style ? \" style=\\\"\".concat(style, \"\\\"\") : '';\r\n            var imageTag = \"<img\".concat(assetUidAttr).concat(classAttr).concat(srcAttr).concat(altAttr).concat(targetAttr).concat(styleAttr, \" />\");\r\n            var styleAttrFig = style ? \" style=\\\"\".concat(style, \"\\\"\") : '';\r\n            return \"<figure\".concat(styleAttrFig, \">\") +\r\n                (link ? \"<a href=\\\"\".concat(link, \"\\\" target=\\\"\").concat(target || \"\", \"\\\">\") : \"\") +\r\n                imageTag +\r\n                (link ? \"</a>\" : \"\") +\r\n                (caption ? \"<figcaption>\".concat(caption, \"</figcaption>\") : \"\") +\r\n                \"</figure>\";\r\n        }\r\n        return \"\";\r\n    },\r\n    _a['default'] = function (node, next) {\r\n        return sanitizeHTML(next(node.children));\r\n    },\r\n    _a[MarkType$1.BOLD] = function (text) {\r\n        return \"<strong>\".concat(sanitizeHTML(text), \"</strong>\");\r\n    },\r\n    _a[MarkType$1.ITALIC] = function (text) {\r\n        return \"<em>\".concat(sanitizeHTML(text), \"</em>\");\r\n    },\r\n    _a[MarkType$1.UNDERLINE] = function (text) {\r\n        return \"<u>\".concat(sanitizeHTML(text), \"</u>\");\r\n    },\r\n    _a[MarkType$1.STRIKE_THROUGH] = function (text) {\r\n        return \"<strike>\".concat(sanitizeHTML(text), \"</strike>\");\r\n    },\r\n    _a[MarkType$1.INLINE_CODE] = function (text) {\r\n        return \"<span data-type='inlineCode'>\".concat(sanitizeHTML(text), \"</span>\");\r\n    },\r\n    _a[MarkType$1.SUBSCRIPT] = function (text) {\r\n        return \"<sub>\".concat(sanitizeHTML(text), \"</sub>\");\r\n    },\r\n    _a[MarkType$1.SUPERSCRIPT] = function (text) {\r\n        return \"<sup>\".concat(sanitizeHTML(text), \"</sup>\");\r\n    },\r\n    _a[MarkType$1.BREAK] = function (text) {\r\n        // Check if text is only newlines (which will be converted to <br /> by sanitizeHTML)\r\n        // If so, don't add an extra <br /> to avoid duplication\r\n        var onlyNewlines = /^\\n+$/.test(text);\r\n        if (onlyNewlines) {\r\n            return sanitizeHTML(text);\r\n        }\r\n        return \"<br />\".concat(sanitizeHTML(text));\r\n    },\r\n    _a[MarkType$1.CLASSNAME_OR_ID] = function (text, classname, id) {\r\n        return \"<span\".concat(classname ? \" class=\\\"\".concat(classname, \"\\\"\") : \"\").concat(id ? \" id=\\\"\".concat(id, \"\\\"\") : \"\", \">\").concat(sanitizeHTML(text), \"</span>\");\r\n    },\r\n    _a);\n\nfunction enumerate(entries, process) {\r\n    for (var _i = 0, entries_1 = entries; _i < entries_1.length; _i++) {\r\n        var entry = entries_1[_i];\r\n        process(entry);\r\n    }\r\n}\r\nfunction enumerateContents(content, renderOption, renderEmbed) {\r\n    if (!(content instanceof Array) && content.type !== 'doc') {\r\n        return content;\r\n    }\r\n    if (content instanceof Array) {\r\n        var result_1 = [];\r\n        content.forEach(function (doc) {\r\n            result_1.push(enumerateContents(doc, renderOption, renderEmbed));\r\n        });\r\n        return result_1;\r\n    }\r\n    var commonRenderOption = __assign(__assign({}, defaultNodeOption), renderOption);\r\n    return nodeChildrenToHTML(content.children, commonRenderOption, renderEmbed);\r\n}\r\nfunction textNodeToHTML(node, renderOption) {\r\n    var text = replaceHtmlEntities(node.text);\r\n    // Convert newlines to <br /> tags if there are no other marks\r\n    // This ensures newlines are always handled consistently\r\n    var hasMarks = false;\r\n    if (node.classname || node.id) {\r\n        text = renderOption[MarkType$1.CLASSNAME_OR_ID](text, node.classname, node.id);\r\n        hasMarks = true;\r\n    }\r\n    if (node.break) {\r\n        text = renderOption[MarkType$1.BREAK](text);\r\n        hasMarks = true;\r\n    }\r\n    if (node.superscript) {\r\n        text = renderOption[MarkType$1.SUPERSCRIPT](text);\r\n        hasMarks = true;\r\n    }\r\n    if (node.subscript) {\r\n        text = renderOption[MarkType$1.SUBSCRIPT](text);\r\n        hasMarks = true;\r\n    }\r\n    if (node.inlineCode) {\r\n        text = renderOption[MarkType$1.INLINE_CODE](text);\r\n        hasMarks = true;\r\n    }\r\n    if (node.strikethrough) {\r\n        text = renderOption[MarkType$1.STRIKE_THROUGH](text);\r\n        hasMarks = true;\r\n    }\r\n    if (node.underline) {\r\n        text = renderOption[MarkType$1.UNDERLINE](text);\r\n        hasMarks = true;\r\n    }\r\n    if (node.italic) {\r\n        text = renderOption[MarkType$1.ITALIC](text);\r\n        hasMarks = true;\r\n    }\r\n    if (node.bold) {\r\n        text = renderOption[MarkType$1.BOLD](text);\r\n        hasMarks = true;\r\n    }\r\n    // If no marks were applied, but text contains newlines, convert them to <br />\r\n    if (!hasMarks && text.includes('\\n')) {\r\n        text = text.replace(/\\n/g, '<br />');\r\n    }\r\n    return text;\r\n}\r\nfunction referenceToHTML(node, renderOption, renderEmbed) {\r\n    function sendToRenderOption(referenceNode) {\r\n        var next = function (nodes) { return nodeChildrenToHTML(nodes, renderOption, renderEmbed); };\r\n        return renderOption[referenceNode.type](referenceNode, next);\r\n    }\r\n    if ((node.attrs.type === 'entry' || node.attrs.type === 'asset') && node.attrs['display-type'] === 'link') {\r\n        var entryText = node.children ? nodeChildrenToHTML(node.children, renderOption, renderEmbed) : '';\r\n        if (renderOption[node.type] !== undefined) {\r\n            return sendToRenderOption(node);\r\n        }\r\n        var href = node.attrs.href || node.attrs.url;\r\n        var aTagAttrs = \"\".concat(node.attrs.style ? \" style=\\\"\".concat(node.attrs.style, \"\\\"\") : \"\").concat(node.attrs['class-name'] ? \" class=\\\"\".concat(node.attrs['class-name'], \"\\\"\") : \"\").concat(node.attrs.id ? \" id=\\\"\".concat(node.attrs.id, \"\\\"\") : \"\").concat(href ? \" href=\\\"\".concat(href, \"\\\"\") : \"\");\r\n        if (node.attrs.target) {\r\n            aTagAttrs += \" target=\\\"\".concat(node.attrs.target, \"\\\"\");\r\n        }\r\n        if (node.attrs.type == 'asset') {\r\n            aTagAttrs += \" type=\\\"asset\\\" content-type-uid=\\\"sys_assets\\\" \".concat(node.attrs['asset-uid'] ? \"data-sys-asset-uid=\\\"\".concat(node.attrs['asset-uid'], \"\\\"\") : \"\", \" sys-style-type=\\\"download\\\"\");\r\n        }\r\n        var aTag = \"<a\".concat(aTagAttrs, \">\").concat(entryText, \"</a>\");\r\n        return aTag;\r\n    }\r\n    if (!renderEmbed && renderOption[node.type] !== undefined) {\r\n        return sendToRenderOption(node);\r\n    }\r\n    if (!renderEmbed) {\r\n        return '';\r\n    }\r\n    var metadata = nodeToMetadata(node.attrs, (node.children && node.children.length > 0 ? node.children[0] : {}));\r\n    var item = renderEmbed(metadata);\r\n    if (!item && renderOption[node.type] !== undefined) {\r\n        return sendToRenderOption(node);\r\n    }\r\n    return findRenderString(item, metadata, renderOption);\r\n}\r\nfunction nodeChildrenToHTML(nodes, renderOption, renderEmbed) {\r\n    return nodes.map(function (node) { return nodeToHTML(node, renderOption, renderEmbed); }).join('');\r\n}\r\nfunction styleObjectToString(styleObj) {\r\n    if (!styleObj)\r\n        return '';\r\n    if (typeof styleObj === 'string') {\r\n        return styleObj;\r\n    }\r\n    var styleString = '';\r\n    for (var key in styleObj) {\r\n        if (styleObj.hasOwnProperty(key)) {\r\n            var value = styleObj[key];\r\n            styleString += \"\".concat(key, \":\").concat(value, \";\");\r\n        }\r\n    }\r\n    return styleString;\r\n}\r\nfunction nodeToHTML(node, renderOption, renderEmbed) {\r\n    var _a;\r\n    if ((_a = node === null || node === void 0 ? void 0 : node.attrs) === null || _a === void 0 ? void 0 : _a.style) {\r\n        node.attrs.style = styleObjectToString(node.attrs.style);\r\n    }\r\n    if (!node.type) {\r\n        return textNodeToHTML(node, renderOption);\r\n    }\r\n    else if (node.type === 'reference') {\r\n        return referenceToHTML(node, renderOption, renderEmbed);\r\n    }\r\n    else {\r\n        var next = function (nodes) { return nodeChildrenToHTML(nodes, renderOption, renderEmbed); };\r\n        if (renderOption[node.type] !== undefined) {\r\n            return renderOption[node.type](node, next);\r\n        }\r\n        else {\r\n            return renderOption.default(node, next);\r\n        }\r\n    }\r\n}\n\nfunction jsonToHTML$1(option) {\r\n    if (option.entry instanceof Array) {\r\n        enumerate(option.entry, function (entry) {\r\n            jsonToHTML$1({ entry: entry, paths: option.paths, renderOption: option.renderOption });\r\n        });\r\n    }\r\n    else {\r\n        enumerateKeys$1({\r\n            entry: option.entry,\r\n            paths: option.paths,\r\n            renderOption: option.renderOption,\r\n        });\r\n    }\r\n}\r\nfunction enumerateKeys$1(option) {\r\n    for (var _i = 0, _a = option.paths; _i < _a.length; _i++) {\r\n        var key = _a[_i];\r\n        findRenderContent(key, option.entry, (function (content) {\r\n            return enumerateContents(content, option.renderOption, function (metadata) {\r\n                return findEmbeddedItems(metadata, option.entry)[0];\r\n            });\r\n        }));\r\n    }\r\n}\n\nfunction jsonToHTML(option) {\r\n    if (option.entry instanceof Array) {\r\n        enumerate(option.entry, function (entry) {\r\n            jsonToHTML({ entry: entry, paths: option.paths, renderOption: option.renderOption });\r\n        });\r\n    }\r\n    else {\r\n        enumerateKeys({\r\n            entry: option.entry,\r\n            paths: option.paths,\r\n            renderOption: option.renderOption,\r\n        });\r\n    }\r\n}\r\nfunction enumerateKeys(option) {\r\n    for (var _i = 0, _a = option.paths; _i < _a.length; _i++) {\r\n        var key = _a[_i];\r\n        findRenderContent(key, option.entry, (function (content) {\r\n            if (content && content.json) {\r\n                var edges = content.embedded_itemsConnection ? content.embedded_itemsConnection.edges : [];\r\n                var items_1 = Object.values(edges || []).reduce(function (accumulator, value) { return accumulator.concat(value.node); }, []);\r\n                return enumerateContents(content.json, option.renderOption, function (metadata) {\r\n                    return findGQLEmbeddedItems(metadata, items_1)[0];\r\n                });\r\n            }\r\n            return content;\r\n        }));\r\n    }\r\n}\r\nvar GQL = {\r\n    jsonToHTML: jsonToHTML\r\n};\n\nfunction addTags(entry, contentTypeUid, tagsAsObject, locale) {\r\n    var _a;\r\n    if (locale === void 0) { locale = 'en-us'; }\r\n    if (entry) {\r\n        // handle case senstivity for contentTypeUid and locale\r\n        contentTypeUid = contentTypeUid.toLowerCase();\r\n        locale = locale.toLowerCase();\r\n        var appliedVariants = entry._applied_variants || ((_a = entry === null || entry === void 0 ? void 0 : entry.system) === null || _a === void 0 ? void 0 : _a.applied_variants) || null;\r\n        entry.$ = getTag(entry, \"\".concat(contentTypeUid, \".\").concat(entry.uid, \".\").concat(locale), tagsAsObject, locale, { _applied_variants: appliedVariants, shouldApplyVariant: !!appliedVariants, metaKey: '' });\r\n    }\r\n}\r\nfunction getTag(content, prefix, tagsAsObject, locale, appliedVariants) {\r\n    var tags = {};\r\n    appliedVariants.metaKey; var shouldApplyVariant = appliedVariants.shouldApplyVariant, _applied_variants = appliedVariants._applied_variants;\r\n    Object.entries(content).forEach(function (_a) {\r\n        var key = _a[0], value = _a[1];\r\n        if (key === '$')\r\n            return;\r\n        var metaUID = value && typeof value === 'object' && value !== null && value._metadata && value._metadata.uid ? value._metadata.uid : '';\r\n        var updatedMetakey = appliedVariants.shouldApplyVariant ? \"\".concat(appliedVariants.metaKey ? appliedVariants.metaKey + '.' : '').concat(key) : '';\r\n        if (metaUID && updatedMetakey)\r\n            updatedMetakey = updatedMetakey + '.' + metaUID;\r\n        switch (typeof value) {\r\n            case \"object\":\r\n                if (Array.isArray(value)) {\r\n                    value.forEach(function (obj, index) {\r\n                        var _a;\r\n                        if (obj === null || obj === undefined) {\r\n                            return;\r\n                        }\r\n                        var childKey = \"\".concat(key, \"__\").concat(index);\r\n                        var parentKey = \"\".concat(key, \"__parent\");\r\n                        metaUID = value && typeof value === 'object' && obj !== null && obj._metadata && obj._metadata.uid ? obj._metadata.uid : '';\r\n                        updatedMetakey = appliedVariants.shouldApplyVariant ? \"\".concat(appliedVariants.metaKey ? appliedVariants.metaKey + '.' : '').concat(key) : '';\r\n                        if (metaUID && updatedMetakey)\r\n                            updatedMetakey = updatedMetakey + '.' + metaUID;\r\n                        /**\r\n                         * Indexes of array are handled here\r\n                         * {\r\n                         *  \"array\": [\"hello\", \"world\"],\r\n                         *  \"$\": {\r\n                         *      \"array\": {\"data-cslp\": \"content_type_uid.entry_uid.locale.array\"}\r\n                         *      \"array__0\": {\"data-cslp\": \"content_type_uid.entry_uid.locale.array.0\"}\r\n                         *      \"array__1\": {\"data-cslp\": \"content_type_uid.entry_uid.locale.array.1\"}\r\n                         *  }\r\n                         * }\r\n                         */\r\n                        tags[childKey] = getTagsValue(\"\".concat(prefix, \".\").concat(key, \".\").concat(index), tagsAsObject, { _applied_variants: _applied_variants, shouldApplyVariant: shouldApplyVariant, metaKey: updatedMetakey });\r\n                        tags[parentKey] = getParentTagsValue(\"\".concat(prefix, \".\").concat(key), tagsAsObject);\r\n                        if (typeof obj !== 'undefined' && obj !== null && obj._content_type_uid !== undefined && obj.uid !== undefined) {\r\n                            /**\r\n                             * References are handled here\r\n                             * {\r\n                             *  \"reference\": [{\r\n                             *      \"title\": \"title\",\r\n                             *      \"uid\": \"ref_uid\",\r\n                             *      \"_content_type_uid\": \"ref_content_type_uid\",\r\n                             *     \"$\": {\"title\": {\"data-cslp\": \"ref_content_type_uid.ref_uid.locale.title\"}}\r\n                             *  }]\r\n                             * }\r\n                             */\r\n                            var newAppliedVariants = obj._applied_variants || ((_a = obj === null || obj === void 0 ? void 0 : obj.system) === null || _a === void 0 ? void 0 : _a.applied_variants) || null; //check for _applied_variants in the reference object only return null if not present , do not check in the parent object;\r\n                            var newShouldApplyVariant = !!newAppliedVariants;\r\n                            value[index].$ = getTag(obj, \"\".concat(obj._content_type_uid, \".\").concat(obj.uid, \".\").concat(obj.locale || locale), tagsAsObject, locale, { _applied_variants: newAppliedVariants, shouldApplyVariant: newShouldApplyVariant, metaKey: \"\" });\r\n                        }\r\n                        else if (typeof obj === \"object\") {\r\n                            /**\r\n                             * Objects inside Array like modular blocks are handled here\r\n                             * {\r\n                             *  \"array\": [{\r\n                             *    \"title\": \"title\",\r\n                             *    \"$\": {\"title\": {\"data-cslp\": \"content_type_uid.entry_uid.locale.array.0.title\"}}\r\n                             *  }]\r\n                             * }\r\n                             */\r\n                            obj.$ = getTag(obj, \"\".concat(prefix, \".\").concat(key, \".\").concat(index), tagsAsObject, locale, { _applied_variants: _applied_variants, shouldApplyVariant: shouldApplyVariant, metaKey: updatedMetakey });\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    if (value) {\r\n                        /**\r\n                         * Objects are handled here\r\n                         * {\r\n                         *  \"object\": {\r\n                         *      \"title\": \"title\",\r\n                         *      \"$\": {\r\n                         *          \"title\": {\"data-cslp\": \"content_type_uid.entry_uid.locale.object.title\"}\r\n                         *      }\r\n                         *  },\r\n                         * }\r\n                         */\r\n                        value.$ = getTag(value, \"\".concat(prefix, \".\").concat(key), tagsAsObject, locale, { _applied_variants: _applied_variants, shouldApplyVariant: shouldApplyVariant, metaKey: updatedMetakey });\r\n                    }\r\n                }\r\n                /**\r\n                 * {\r\n                 *  \"object\": {\r\n                 *      \"title\": \"title\",\r\n                 *  },\r\n                 *  \"array\": [\"hello\", \"world\"]\r\n                 *  \"$\": {\r\n                 *      \"object\": {\"data-cslp\": \"content_type_uid.entry_uid.locale.object\"},\r\n                 *      \"array\": {\"data-cslp\": \"content_type_uid.entry_uid.locale.array\"}\r\n                 *  }\r\n                 * }\r\n                 */\r\n                tags[key] = getTagsValue(\"\".concat(prefix, \".\").concat(key), tagsAsObject, { _applied_variants: _applied_variants, shouldApplyVariant: shouldApplyVariant, metaKey: updatedMetakey });\r\n                break;\r\n            default:\r\n                /**\r\n                 * All primitive values are handled here\r\n                 * {\r\n                 *  \"title\": \"title\",\r\n                 *  \"$\": {title: {\"data-cslp\": \"content_type_uid.entry_uid.locale.title\"}}\r\n                 * }\r\n                 */\r\n                tags[key] = getTagsValue(\"\".concat(prefix, \".\").concat(key), tagsAsObject, { _applied_variants: _applied_variants, shouldApplyVariant: shouldApplyVariant, metaKey: updatedMetakey });\r\n        }\r\n    });\r\n    return tags;\r\n}\r\nfunction getTagsValue(dataValue, tagsAsObject, appliedVariants) {\r\n    if (appliedVariants.shouldApplyVariant && appliedVariants._applied_variants) {\r\n        var isFieldVariantised = appliedVariants._applied_variants[appliedVariants.metaKey];\r\n        if (isFieldVariantised) {\r\n            var variant = appliedVariants._applied_variants[appliedVariants.metaKey];\r\n            // Adding v2 prefix to the cslp tag. New cslp tags are in v2 format. ex: v2:content_type_uid.entry_uid.locale.title\r\n            var newDataValueArray = ('v2:' + dataValue).split('.');\r\n            newDataValueArray[1] = newDataValueArray[1] + '_' + variant;\r\n            dataValue = newDataValueArray.join('.');\r\n        }\r\n        else {\r\n            var parentVariantisedPath = getParentVariantisedPath(appliedVariants);\r\n            if (parentVariantisedPath) {\r\n                var variant = appliedVariants._applied_variants[parentVariantisedPath];\r\n                var newDataValueArray = ('v2:' + dataValue).split('.');\r\n                newDataValueArray[1] = newDataValueArray[1] + '_' + variant;\r\n                dataValue = newDataValueArray.join('.');\r\n            }\r\n        }\r\n    }\r\n    if (tagsAsObject) {\r\n        return { \"data-cslp\": dataValue };\r\n    }\r\n    else {\r\n        return \"data-cslp=\".concat(dataValue);\r\n    }\r\n}\r\nfunction getParentTagsValue(dataValue, tagsAsObject) {\r\n    if (tagsAsObject) {\r\n        return { \"data-cslp-parent-field\": dataValue };\r\n    }\r\n    else {\r\n        return \"data-cslp-parent-field=\".concat(dataValue);\r\n    }\r\n}\r\nfunction getParentVariantisedPath(appliedVariants) {\r\n    var _a;\r\n    try {\r\n        // Safety fallback\r\n        if (!appliedVariants._applied_variants)\r\n            return '';\r\n        var variantisedFieldPaths = Object.keys(appliedVariants._applied_variants).sort(function (a, b) {\r\n            return b.length - a.length;\r\n        });\r\n        var childPathFragments_1 = appliedVariants.metaKey.split('.');\r\n        // Safety fallback\r\n        if (childPathFragments_1.length === 0 || variantisedFieldPaths.length === 0)\r\n            return '';\r\n        var parentVariantisedPath = (_a = variantisedFieldPaths.find(function (path) {\r\n            var parentFragments = path.split('.');\r\n            if (parentFragments.length > childPathFragments_1.length)\r\n                return false;\r\n            return parentFragments.every(function (fragment, index) { return childPathFragments_1[index] === fragment; });\r\n        })) !== null && _a !== void 0 ? _a : '';\r\n        return parentVariantisedPath;\r\n    }\r\n    catch (e) {\r\n        return '';\r\n    }\r\n}\n\nfunction updateAssetURLForGQL(gqlResponse) {\r\n    try {\r\n        var response = gqlResponse === null || gqlResponse === void 0 ? void 0 : gqlResponse.data;\r\n        for (var contentType in response) {\r\n            if (\"items\" in response[contentType]) {\r\n                var entries = response[contentType].items;\r\n                entries.forEach(function (entry) {\r\n                    processEntry(entry);\r\n                });\r\n            }\r\n            else {\r\n                processEntry(response[contentType]);\r\n            }\r\n        }\r\n    }\r\n    catch (error) {\r\n        console.error('Error in updating asset URL for GQL response', error);\r\n    }\r\n}\r\nfunction processEntry(entry) {\r\n    for (var field in entry) {\r\n        var fieldData = entry[field];\r\n        if (fieldData instanceof Array) {\r\n            fieldData.forEach(function (data) {\r\n                findRTEFieldAndUpdateURL(data);\r\n            });\r\n        }\r\n        else if (fieldData && typeof fieldData === 'object') {\r\n            findRTEFieldAndUpdateURL(fieldData);\r\n        }\r\n    }\r\n}\r\nfunction findRTEFieldAndUpdateURL(fieldData) {\r\n    var _a;\r\n    var rteField = findRTEField(fieldData);\r\n    if (!rteField)\r\n        return;\r\n    var edges = (_a = rteField === null || rteField === void 0 ? void 0 : rteField.embedded_itemsConnection) === null || _a === void 0 ? void 0 : _a.edges;\r\n    edges.forEach(function (edge) {\r\n        var _a, _b, _c;\r\n        var node = edge.node;\r\n        if ((node === null || node === void 0 ? void 0 : node.url) && (node === null || node === void 0 ? void 0 : node.filename)) {\r\n            if (!((_a = node === null || node === void 0 ? void 0 : node.system) === null || _a === void 0 ? void 0 : _a.uid))\r\n                throw new Error('Asset UID not found in the response');\r\n            var correspondingAsset = (_c = (_b = rteField === null || rteField === void 0 ? void 0 : rteField.json) === null || _b === void 0 ? void 0 : _b.children) === null || _c === void 0 ? void 0 : _c.find(function (child) { return child.attrs['asset-uid'] === node.system.uid; });\r\n            correspondingAsset.attrs['asset-link'] = node.url;\r\n        }\r\n    });\r\n}\r\nfunction findRTEField(fieldData) {\r\n    if (fieldData && fieldData.embedded_itemsConnection) {\r\n        return fieldData;\r\n    }\r\n    for (var key in fieldData) {\r\n        if (fieldData[key] && typeof fieldData[key] === 'object') {\r\n            var found = findRTEField(fieldData[key]);\r\n            if (found) {\r\n                return found;\r\n            }\r\n        }\r\n    }\r\n}\n\nvar regions = [\n\t{\n\t\tid: \"na\",\n\t\tname: \"AWS North America\",\n\t\tcloudProvider: \"AWS\",\n\t\tlocation: \"North America\",\n\t\talias: [\n\t\t\t\"na\",\n\t\t\t\"us\",\n\t\t\t\"aws-na\",\n\t\t\t\"aws_na\",\n\t\t\t\"NA\",\n\t\t\t\"US\",\n\t\t\t\"AWS-NA\",\n\t\t\t\"AWS_NA\"\n\t\t],\n\t\tisDefault: true,\n\t\tendpoints: {\n\t\t\tapplication: \"https://app.contentstack.com\",\n\t\t\tcontentDelivery: \"https://cdn.contentstack.io\",\n\t\t\tcontentManagement: \"https://api.contentstack.io\",\n\t\t\tauth: \"https://auth-api.contentstack.com\",\n\t\t\tgraphqlDelivery: \"https://graphql.contentstack.com\",\n\t\t\tpreview: \"https://rest-preview.contentstack.com\",\n\t\t\tgraphqlPreview: \"https://graphql-preview.contentstack.com\",\n\t\t\timages: \"https://images.contentstack.io\",\n\t\t\tassets: \"https://assets.contentstack.io\",\n\t\t\tautomate: \"https://automations-api.contentstack.com\",\n\t\t\tlaunch: \"https://launch-api.contentstack.com\",\n\t\t\tdeveloperHub: \"https://developerhub-api.contentstack.com\",\n\t\t\tbrandKit: \"https://brand-kits-api.contentstack.com\",\n\t\t\tgenAI: \"https://ai.contentstack.com/brand-kits\",\n\t\t\tpersonalizeManagement: \"https://personalize-api.contentstack.com\",\n\t\t\tpersonalizeEdge: \"https://personalize-edge.contentstack.com\"\n\t\t}\n\t},\n\t{\n\t\tid: \"eu\",\n\t\tname: \"AWS Europe\",\n\t\tcloudProvider: \"AWS\",\n\t\tlocation: \"Europe\",\n\t\talias: [\n\t\t\t\"eu\",\n\t\t\t\"aws-eu\",\n\t\t\t\"aws_eu\",\n\t\t\t\"EU\",\n\t\t\t\"AWS-EU\",\n\t\t\t\"AWS_EU\"\n\t\t],\n\t\tisDefault: false,\n\t\tendpoints: {\n\t\t\tapplication: \"https://eu-app.contentstack.com\",\n\t\t\tcontentDelivery: \"https://eu-cdn.contentstack.com\",\n\t\t\tcontentManagement: \"https://eu-api.contentstack.com\",\n\t\t\tauth: \"https://eu-auth-api.contentstack.com\",\n\t\t\tgraphqlDelivery: \"https://eu-graphql.contentstack.com\",\n\t\t\tpreview: \"https://eu-rest-preview.contentstack.com\",\n\t\t\tgraphqlPreview: \"https://eu-graphql-preview.contentstack.com\",\n\t\t\timages: \"https://eu-images.contentstack.com\",\n\t\t\tassets: \"https://eu-assets.contentstack.com\",\n\t\t\tautomate: \"https://eu-prod-automations-api.contentstack.com\",\n\t\t\tlaunch: \"https://eu-launch-api.contentstack.com\",\n\t\t\tdeveloperHub: \"https://eu-developerhub-api.contentstack.com\",\n\t\t\tbrandKit: \"https://eu-brand-kits-api.contentstack.com\",\n\t\t\tgenAI: \"https://eu-ai.contentstack.com/brand-kits\",\n\t\t\tpersonalizeManagement: \"https://eu-personalize-api.contentstack.com\",\n\t\t\tpersonalizeEdge: \"https://eu-personalize-edge.contentstack.com\"\n\t\t}\n\t},\n\t{\n\t\tid: \"au\",\n\t\tname: \"AWS Australia\",\n\t\tcloudProvider: \"AWS\",\n\t\tlocation: \"Australia\",\n\t\talias: [\n\t\t\t\"au\",\n\t\t\t\"aws-au\",\n\t\t\t\"aws_au\",\n\t\t\t\"AU\",\n\t\t\t\"AWS-AU\",\n\t\t\t\"AWS_AU\"\n\t\t],\n\t\tisDefault: false,\n\t\tendpoints: {\n\t\t\tapplication: \"https://au-app.contentstack.com\",\n\t\t\tcontentDelivery: \"https://au-cdn.contentstack.com\",\n\t\t\tcontentManagement: \"https://au-api.contentstack.com\",\n\t\t\tauth: \"https://au-auth-api.contentstack.com\",\n\t\t\tgraphqlDelivery: \"https://au-graphql.contentstack.com\",\n\t\t\tpreview: \"https://au-rest-preview.contentstack.com\",\n\t\t\tgraphqlPreview: \"https://au-graphql-preview.contentstack.com\",\n\t\t\timages: \"https://au-images.contentstack.com\",\n\t\t\tassets: \"https://au-assets.contentstack.com\",\n\t\t\tautomate: \"https://au-prod-automations-api.contentstack.com\",\n\t\t\tlaunch: \"https://au-launch-api.contentstack.com\",\n\t\t\tdeveloperHub: \"https://au-developerhub-api.contentstack.com\",\n\t\t\tbrandKit: \"https://au-brand-kits-api.contentstack.com\",\n\t\t\tgenAI: \"https://au-ai.contentstack.com/brand-kits\",\n\t\t\tpersonalizeManagement: \"https://au-personalize-api.contentstack.com\",\n\t\t\tpersonalizeEdge: \"https://au-personalize-edge.contentstack.com\"\n\t\t}\n\t},\n\t{\n\t\tid: \"azure-na\",\n\t\tname: \"Azure North America\",\n\t\tcloudProvider: \"Azure\",\n\t\tlocation: \"North America\",\n\t\talias: [\n\t\t\t\"azure-na\",\n\t\t\t\"azure_na\",\n\t\t\t\"AZURE-NA\",\n\t\t\t\"AZURE_NA\"\n\t\t],\n\t\tisDefault: false,\n\t\tendpoints: {\n\t\t\tapplication: \"https://azure-na-app.contentstack.com\",\n\t\t\tcontentDelivery: \"https://azure-na-cdn.contentstack.com\",\n\t\t\tcontentManagement: \"https://azure-na-api.contentstack.com\",\n\t\t\tauth: \"https://azure-na-auth-api.contentstack.com\",\n\t\t\tgraphqlDelivery: \"https://azure-na-graphql.contentstack.com\",\n\t\t\tpreview: \"https://azure-na-rest-preview.contentstack.com\",\n\t\t\tgraphqlPreview: \"https://azure-na-graphql-preview.contentstack.com\",\n\t\t\timages: \"https://azure-na-images.contentstack.com\",\n\t\t\tassets: \"https://azure-na-assets.contentstack.com\",\n\t\t\tautomate: \"https://azure-na-automations-api.contentstack.com\",\n\t\t\tlaunch: \"https://azure-na-launch-api.contentstack.com\",\n\t\t\tdeveloperHub: \"https://azure-na-developerhub-api.contentstack.com\",\n\t\t\tbrandKit: \"https://azure-na-brand-kits-api.contentstack.com\",\n\t\t\tgenAI: \"https://azure-na-ai.contentstack.com/brand-kits\",\n\t\t\tpersonalizeManagement: \"https://azure-na-personalize-api.contentstack.com\",\n\t\t\tpersonalizeEdge: \"https://azure-na-personalize-edge.contentstack.com\"\n\t\t}\n\t},\n\t{\n\t\tid: \"azure-eu\",\n\t\tname: \"Azure Europe\",\n\t\tcloudProvider: \"Azure\",\n\t\tlocation: \"Europe\",\n\t\talias: [\n\t\t\t\"azure-eu\",\n\t\t\t\"azure_eu\",\n\t\t\t\"AZURE-EU\",\n\t\t\t\"AZURE_EU\"\n\t\t],\n\t\tisDefault: false,\n\t\tendpoints: {\n\t\t\tapplication: \"https://azure-eu-app.contentstack.com\",\n\t\t\tcontentDelivery: \"https://azure-eu-cdn.contentstack.com\",\n\t\t\tcontentManagement: \"https://azure-eu-api.contentstack.com\",\n\t\t\tauth: \"https://azure-eu-auth-api.contentstack.com\",\n\t\t\tgraphqlDelivery: \"https://azure-eu-graphql.contentstack.com\",\n\t\t\tpreview: \"https://azure-eu-rest-preview.contentstack.com\",\n\t\t\tgraphqlPreview: \"https://azure-eu-graphql-preview.contentstack.com\",\n\t\t\timages: \"https://azure-eu-images.contentstack.com\",\n\t\t\tassets: \"https://azure-eu-assets.contentstack.com\",\n\t\t\tautomate: \"https://azure-eu-automations-api.contentstack.com\",\n\t\t\tlaunch: \"https://azure-eu-launch-api.contentstack.com\",\n\t\t\tdeveloperHub: \"https://azure-eu-developerhub-api.contentstack.com\",\n\t\t\tbrandKit: \"https://azure-eu-brand-kits-api.contentstack.com\",\n\t\t\tgenAI: \"https://azure-eu-ai.contentstack.com/brand-kits\",\n\t\t\tpersonalizeManagement: \"https://azure-eu-personalize-api.contentstack.com\",\n\t\t\tpersonalizeEdge: \"https://azure-eu-personalize-edge.contentstack.com\"\n\t\t}\n\t},\n\t{\n\t\tid: \"gcp-na\",\n\t\tname: \"GCP North America\",\n\t\tcloudProvider: \"GCP\",\n\t\tlocation: \"North America\",\n\t\talias: [\n\t\t\t\"gcp-na\",\n\t\t\t\"gcp_na\",\n\t\t\t\"GCP-NA\",\n\t\t\t\"GCP_NA\"\n\t\t],\n\t\tisDefault: false,\n\t\tendpoints: {\n\t\t\tapplication: \"https://gcp-na-app.contentstack.com\",\n\t\t\tcontentDelivery: \"https://gcp-na-cdn.contentstack.com\",\n\t\t\tcontentManagement: \"https://gcp-na-api.contentstack.com\",\n\t\t\tauth: \"https://gcp-na-auth-api.contentstack.com\",\n\t\t\tgraphqlDelivery: \"https://gcp-na-graphql.contentstack.com\",\n\t\t\tpreview: \"https://gcp-na-rest-preview.contentstack.com\",\n\t\t\tgraphqlPreview: \"https://gcp-na-graphql-preview.contentstack.com\",\n\t\t\timages: \"https://gcp-na-images.contentstack.com\",\n\t\t\tassets: \"https://gcp-na-assets.contentstack.com\",\n\t\t\tautomate: \"https://gcp-na-automations-api.contentstack.com\",\n\t\t\tlaunch: \"https://gcp-na-launch-api.contentstack.com\",\n\t\t\tdeveloperHub: \"https://gcp-na-developerhub-api.contentstack.com\",\n\t\t\tbrandKit: \"https://gcp-na-brand-kits-api.contentstack.com\",\n\t\t\tgenAI: \"https://gcp-na-ai.contentstack.com/brand-kits\",\n\t\t\tpersonalizeManagement: \"https://gcp-na-personalize-api.contentstack.com\",\n\t\t\tpersonalizeEdge: \"https://gcp-na-personalize-edge.contentstack.com\"\n\t\t}\n\t},\n\t{\n\t\tid: \"gcp-eu\",\n\t\tname: \"GCP Europe\",\n\t\tcloudProvider: \"GCP\",\n\t\tlocation: \"Europe\",\n\t\talias: [\n\t\t\t\"gcp-eu\",\n\t\t\t\"gcp_eu\",\n\t\t\t\"GCP-EU\",\n\t\t\t\"GCP_EU\"\n\t\t],\n\t\tisDefault: false,\n\t\tendpoints: {\n\t\t\tapplication: \"https://gcp-eu-app.contentstack.com\",\n\t\t\tcontentDelivery: \"https://gcp-eu-cdn.contentstack.com\",\n\t\t\tcontentManagement: \"https://gcp-eu-api.contentstack.com\",\n\t\t\tauth: \"https://gcp-eu-auth-api.contentstack.com\",\n\t\t\tgraphqlDelivery: \"https://gcp-eu-graphql.contentstack.com\",\n\t\t\tpreview: \"https://gcp-eu-rest-preview.contentstack.com\",\n\t\t\tgraphqlPreview: \"https://gcp-eu-graphql-preview.contentstack.com\",\n\t\t\timages: \"https://gcp-eu-images.contentstack.com\",\n\t\t\tassets: \"https://gcp-eu-assets.contentstack.com\",\n\t\t\tautomate: \"https://gcp-eu-automations-api.contentstack.com\",\n\t\t\tlaunch: \"https://gcp-eu-launch-api.contentstack.com\",\n\t\t\tdeveloperHub: \"https://gcp-eu-developerhub-api.contentstack.com\",\n\t\t\tbrandKit: \"https://gcp-eu-brand-kits-api.contentstack.com\",\n\t\t\tgenAI: \"https://gcp-eu-ai.contentstack.com/brand-kits\",\n\t\t\tpersonalizeManagement: \"https://gcp-eu-personalize-api.contentstack.com\",\n\t\t\tpersonalizeEdge: \"https://gcp-eu-personalize-edge.contentstack.com\"\n\t\t}\n\t}\n];\nvar regionsData = {\n\tregions: regions\n};\n\nfunction getContentstackEndpoint(region, service, omitHttps) {\r\n    if (region === void 0) { region = 'us'; }\r\n    if (service === void 0) { service = ''; }\r\n    if (omitHttps === void 0) { omitHttps = false; }\r\n    // Validate empty region before any processing\r\n    if (region === '') {\r\n        throw new Error('Empty region provided. Please put valid region.');\r\n    }\r\n    var regions = regionsData;\r\n    // Normalize the region input\r\n    var normalizedRegion = region.toLowerCase().trim() || 'us';\r\n    // Check if regions data is malformed\r\n    if (!Array.isArray(regions.regions)) {\r\n        throw new Error('Invalid Regions file. Please install the SDK again to fix this issue.');\r\n    }\r\n    // Find the region by ID or alias\r\n    var regionData = findRegionByIDOrAlias(regions.regions, normalizedRegion);\r\n    if (!regionData) {\r\n        throw new Error(\"Invalid region: \".concat(region));\r\n    }\r\n    // Get the endpoint(s)\r\n    if (service) {\r\n        // Return specific service endpoint\r\n        var endpoint = regionData.endpoints[service];\r\n        if (!endpoint) {\r\n            throw new Error(\"Service \\\"\".concat(service, \"\\\" not found for region \\\"\").concat(regionData.id, \"\\\"\"));\r\n        }\r\n        return omitHttps ? stripHttps(endpoint) : endpoint;\r\n    }\r\n    else {\r\n        return omitHttps ? stripHttps(regionData.endpoints) : regionData.endpoints;\r\n    }\r\n}\r\nfunction findRegionByIDOrAlias(regions, regionInput) {\r\n    // First try to find by exact ID match\r\n    var region = regions.find(function (r) { return r.id === regionInput; });\r\n    if (region) {\r\n        return region;\r\n    }\r\n    // Then try to find by alias\r\n    region = regions.find(function (r) {\r\n        return r.alias.some(function (alias) { return alias.toLowerCase() === regionInput.toLowerCase(); });\r\n    });\r\n    return region || null;\r\n}\r\nfunction stripHttps(endpoint) {\r\n    if (typeof endpoint === 'string') {\r\n        return endpoint.replace(/^https?:\\/\\//, '');\r\n    }\r\n    else {\r\n        var result = {};\r\n        for (var key in endpoint) {\r\n            result[key] = stripHttps(endpoint[key]);\r\n        }\r\n        return result;\r\n    }\r\n}\n\nexports.Document = Document;\nexports.GQL = GQL;\nexports.MarkType = MarkType$1;\nexports.Node = Node;\nexports.NodeType = NodeType$1;\nexports.StyleType = StyleType$1;\nexports.TextNode = TextNode;\nexports.addEditableTags = addTags;\nexports.attributeToString = attributeToString;\nexports.getContentstackEndpoint = getContentstackEndpoint;\nexports.jsonToHTML = jsonToHTML$1;\nexports.render = render;\nexports.renderContent = renderContent;\nexports.updateAssetURLForGQL = updateAssetURLForGQL;\n//# sourceMappingURL=index.es.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvQGNvbnRlbnRzdGFjay91dGlscy9kaXN0L2luZGV4LmVzLmpzIiwibWFwcGluZ3MiOiJBQUFhOztBQUViO0FBQ0E7QUFDQSw2QkFBNkI7QUFDN0IsNEJBQTRCO0FBQzVCLDRCQUE0QjtBQUM1Qiw4QkFBOEI7QUFDOUI7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwREFBMEQsNEJBQTRCO0FBQ3RGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdGQUF3RjtBQUN4RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsOEJBQThCO0FBQy9COztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsZ0JBQWdCLHNDQUFzQyxrQkFBa0I7QUFDbkYsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CO0FBQ3BCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpREFBaUQsT0FBTztBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLG9CQUFvQiwrQkFBK0I7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0M7QUFDbEMsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQSxrQ0FBa0M7QUFDbEMsd0NBQXdDO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCO0FBQzFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNULEtBQUs7QUFDTDtBQUNBOztBQUVBO0FBQ0EsK0JBQStCO0FBQy9CO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMOztBQUVBO0FBQ0E7QUFDQSxvQ0FBb0M7QUFDcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EscUNBQXFDO0FBQ3JDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbUhBQW1ILG1DQUFtQztBQUN0SjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1REFBdUQsZ0JBQWdCO0FBQ3ZFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLFdBQVcsa0NBQWtDO0FBQzdDLFdBQVcsVUFBVTtBQUNyQixXQUFXLGVBQWU7QUFDMUI7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0Q0FBNEMsaURBQWlEO0FBQzdGLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUM7QUFDbkM7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFdBQVcsbUJBQW1CO0FBQzlCLFdBQVcsZ0JBQWdCO0FBQzNCLFdBQVcsZUFBZTtBQUMxQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsNEJBQTRCO0FBQzdCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLDRCQUE0QjtBQUM3Qjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnQ0FBZ0M7QUFDaEM7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdFQUF3RSxxQkFBcUI7QUFDN0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7O0FBRUE7QUFDQSwwQ0FBMEMsdUJBQXVCO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsaURBQWlEO0FBQ2pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnSEFBZ0g7QUFDaEg7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMscURBQXFEO0FBQzVGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrREFBK0Q7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0M7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsc0VBQXNFO0FBQ2pHLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLGdCQUFnQjtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYixTQUFTO0FBQ1Q7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSx5QkFBeUIsc0VBQXNFO0FBQy9GLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0Esd0NBQXdDLGdCQUFnQjtBQUN4RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdHQUFnRyx3Q0FBd0M7QUFDeEk7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQjtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEhBQThILHdGQUF3RjtBQUN0TjtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QjtBQUM3QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQ0FBMEM7QUFDMUMsNkNBQTZDO0FBQzdDLDZDQUE2QztBQUM3QztBQUNBO0FBQ0E7QUFDQSw2SEFBNkgsdUdBQXVHO0FBQ3BPO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHlDQUF5QyxVQUFVO0FBQ25ELGlDQUFpQztBQUNqQztBQUNBO0FBQ0EsOE1BQThNO0FBQzlNO0FBQ0EsMEtBQTBLLCtGQUErRjtBQUN6UTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdDQUF3QyxVQUFVO0FBQ2xELGlDQUFpQztBQUNqQztBQUNBO0FBQ0EsK0hBQStILHVHQUF1RztBQUN0TztBQUNBLHFCQUFxQjtBQUNyQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw4Q0FBOEM7QUFDOUM7QUFDQSw2QkFBNkI7QUFDN0I7QUFDQTtBQUNBLDRHQUE0Ryx1R0FBdUc7QUFDbk47QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUJBQXFCO0FBQ3JCO0FBQ0E7QUFDQSxtQ0FBbUMsd0RBQXdEO0FBQzNGLGtDQUFrQztBQUNsQztBQUNBO0FBQ0E7QUFDQSw2RkFBNkYsdUdBQXVHO0FBQ3BNO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDBCQUEwQixRQUFRO0FBQ2xDO0FBQ0E7QUFDQSw2RkFBNkYsdUdBQXVHO0FBQ3BNO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNFQUFzRSxrREFBa0Q7QUFDeEgsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNPQUFzTyxzREFBc0Q7QUFDNVI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxFQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSw2QkFBNkI7QUFDN0IsOEJBQThCO0FBQzlCLGdDQUFnQztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZDQUE2Qyw4QkFBOEI7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLCtDQUErQywyREFBMkQ7QUFDMUcsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsZ0JBQWdCO0FBQ2hCLFdBQVc7QUFDWCxnQkFBZ0I7QUFDaEIsWUFBWTtBQUNaLGdCQUFnQjtBQUNoQixpQkFBaUI7QUFDakIsZ0JBQWdCO0FBQ2hCLHVCQUF1QjtBQUN2Qix5QkFBeUI7QUFDekIsK0JBQStCO0FBQy9CLGtCQUFrQjtBQUNsQixjQUFjO0FBQ2QscUJBQXFCO0FBQ3JCLDRCQUE0QjtBQUM1QiIsInNvdXJjZXMiOlsid2VicGFjazovL3N0YWNrLWFjYWRlbXkvLi9ub2RlX21vZHVsZXMvQGNvbnRlbnRzdGFjay91dGlscy9kaXN0L2luZGV4LmVzLmpzPzhjYjAiXSwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5mdW5jdGlvbiByZXBsYWNlSHRtbEVudGl0aWVzKHRleHQpIHtcclxuICAgIHJldHVybiB0ZXh0XHJcbiAgICAgICAgLnJlcGxhY2UoLyYvZywgJyZhbXA7JylcclxuICAgICAgICAucmVwbGFjZSgvPC9nLCAnJmx0OycpXHJcbiAgICAgICAgLnJlcGxhY2UoLz4vZywgJyZndDsnKVxyXG4gICAgICAgIC5yZXBsYWNlKC9cIi9nLCAnJnF1b3Q7Jyk7XHJcbn1cclxudmFyIGZvcmJpZGRlbkF0dHJDaGFycyA9IFsnXCInLCBcIidcIiwgJz4nLCAnPCcsICcvJywgJz0nXTtcblxuZnVuY3Rpb24gY3JlYXRlTWV0YWRhdGEoYXR0cmlidXRlKSB7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHRleHQ6IGF0dHJpYnV0ZVsnI3RleHQnXSxcclxuICAgICAgICBpdGVtVWlkOiBhdHRyaWJ1dGVbJ2RhdGEtc3lzLWVudHJ5LXVpZCddIHx8IGF0dHJpYnV0ZVsnZGF0YS1zeXMtYXNzZXQtdWlkJ10sXHJcbiAgICAgICAgaXRlbVR5cGU6IGF0dHJpYnV0ZS50eXBlLFxyXG4gICAgICAgIHN0eWxlVHlwZTogYXR0cmlidXRlWydzeXMtc3R5bGUtdHlwZSddLFxyXG4gICAgICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZSxcclxuICAgICAgICBjb250ZW50VHlwZVVpZDogYXR0cmlidXRlWydkYXRhLXN5cy1jb250ZW50LXR5cGUtdWlkJ10sXHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIG5vZGVUb01ldGFkYXRhKGF0dHJpYnV0ZSwgdGV4dE5vZGUpIHtcclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgdGV4dDogdGV4dE5vZGUudGV4dCxcclxuICAgICAgICBpdGVtVWlkOiBhdHRyaWJ1dGVbJ2VudHJ5LXVpZCddIHx8IGF0dHJpYnV0ZVsnYXNzZXQtdWlkJ10sXHJcbiAgICAgICAgaXRlbVR5cGU6IGF0dHJpYnV0ZS50eXBlLFxyXG4gICAgICAgIHN0eWxlVHlwZTogYXR0cmlidXRlWydkaXNwbGF5LXR5cGUnXSxcclxuICAgICAgICBhdHRyaWJ1dGVzOiBhdHRyaWJ1dGUsXHJcbiAgICAgICAgY29udGVudFR5cGVVaWQ6IGF0dHJpYnV0ZVsnY29udGVudC10eXBlLXVpZCddLFxyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBhdHRyaWJ1dGVUb1N0cmluZyhhdHRyaWJ1dGVzKSB7XHJcbiAgICB2YXIgcmVzdWx0ID0gJyc7XHJcbiAgICB2YXIgX2xvb3BfMSA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGF0dHJpYnV0ZXMsIGtleSkpIHtcclxuICAgICAgICAgICAgaWYgKGZvcmJpZGRlbkF0dHJDaGFycy5zb21lKGZ1bmN0aW9uIChjaGFyKSB7IHJldHVybiBrZXkuaW5jbHVkZXMoY2hhcik7IH0pKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJjb250aW51ZVwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGF0dHJpYnV0ZXNba2V5XTtcclxuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmpvaW4oJywgJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRTdHJpbmcgPSAnJztcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIHN1YktleSBpbiB2YWx1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodmFsdWUsIHN1YktleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHN1YlZhbHVlID0gdmFsdWVbc3ViS2V5XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1YlZhbHVlICE9IG51bGwgJiYgc3ViVmFsdWUgIT09ICcnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50U3RyaW5nICs9IFwiXCIuY29uY2F0KHN1YktleSwgXCI6XCIpLmNvbmNhdChzdWJWYWx1ZSwgXCI7IFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhbHVlID0gZWxlbWVudFN0cmluZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXN1bHQgKz0gXCIgXCIuY29uY2F0KGtleSwgXCI9XFxcIlwiKS5jb25jYXQocmVwbGFjZUh0bWxFbnRpdGllcyhTdHJpbmcodmFsdWUpKSwgXCJcXFwiXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBmb3IgKHZhciBrZXkgaW4gYXR0cmlidXRlcykge1xyXG4gICAgICAgIF9sb29wXzEoa2V5KTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbn1cblxudmFyIFN0eWxlVHlwZTtcclxuKGZ1bmN0aW9uIChTdHlsZVR5cGUpIHtcclxuICAgIFN0eWxlVHlwZVtcIkJMT0NLXCJdID0gXCJibG9ja1wiO1xyXG4gICAgU3R5bGVUeXBlW1wiSU5MSU5FXCJdID0gXCJpbmxpbmVcIjtcclxuICAgIFN0eWxlVHlwZVtcIkxJTktcIl0gPSBcImxpbmtcIjtcclxuICAgIFN0eWxlVHlwZVtcIkRJU1BMQVlcIl0gPSBcImRpc3BsYXlcIjtcclxuICAgIFN0eWxlVHlwZVtcIkRPV05MT0FEXCJdID0gXCJkb3dubG9hZFwiO1xyXG59KShTdHlsZVR5cGUgfHwgKFN0eWxlVHlwZSA9IHt9KSk7XHJcbnZhciBTdHlsZVR5cGUkMSA9IFN0eWxlVHlwZTtcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlLCBTdXBwcmVzc2VkRXJyb3IsIFN5bWJvbCwgSXRlcmF0b3IgKi9cclxuXHJcbnZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24oZCwgYikge1xyXG4gICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxyXG4gICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcclxuICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xyXG4gICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbn07XHJcblxyXG5mdW5jdGlvbiBfX2V4dGVuZHMoZCwgYikge1xyXG4gICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcclxuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbnZhciBfX2Fzc2lnbiA9IGZ1bmN0aW9uKCkge1xyXG4gICAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIF9fYXNzaWduKHQpIHtcclxuICAgICAgICBmb3IgKHZhciBzLCBpID0gMSwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBuOyBpKyspIHtcclxuICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKSB0W3BdID0gc1twXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHQ7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIF9fYXNzaWduLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XHJcbn07XHJcblxyXG50eXBlb2YgU3VwcHJlc3NlZEVycm9yID09PSBcImZ1bmN0aW9uXCIgPyBTdXBwcmVzc2VkRXJyb3IgOiBmdW5jdGlvbiAoZXJyb3IsIHN1cHByZXNzZWQsIG1lc3NhZ2UpIHtcclxuICAgIHZhciBlID0gbmV3IEVycm9yKG1lc3NhZ2UpO1xyXG4gICAgcmV0dXJuIGUubmFtZSA9IFwiU3VwcHJlc3NlZEVycm9yXCIsIGUuZXJyb3IgPSBlcnJvciwgZS5zdXBwcmVzc2VkID0gc3VwcHJlc3NlZCwgZTtcclxufTtcblxuZnVuY3Rpb24gZWxlbWVudFRvSnNvbihlbGVtZW50KSB7XHJcbiAgICB2YXIgb2JqID0ge307XHJcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnQuYXR0cmlidXRlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIG9ialtlbGVtZW50LmF0dHJpYnV0ZXMuaXRlbShpKS5uYW1lXSA9IGVsZW1lbnQuYXR0cmlidXRlcy5pdGVtKGkpLnZhbHVlO1xyXG4gICAgfVxyXG4gICAgZWxlbWVudC5jaGlsZE5vZGVzLmZvckVhY2goZnVuY3Rpb24gKGNoaWxlTm9kZSkge1xyXG4gICAgICAgIHZhciBub2RlID0gKGNoaWxlTm9kZSk7XHJcbiAgICAgICAgb2JqID0gX19hc3NpZ24oX19hc3NpZ24oe30sIG9iaiksIHBhcnNlRWxlbWVudChub2RlKSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBvYmo7XHJcbn1cclxuZnVuY3Rpb24gcGFyc2VFbGVtZW50KG5vZGUpIHtcclxuICAgIHZhciBvYmogPSB7fTtcclxuICAgIGlmIChub2RlLm5vZGVUeXBlID09PSAzKSB7XHJcbiAgICAgICAgb2JqWycjdGV4dCddID0gbm9kZS50ZXh0Q29udGVudDtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHtcclxuICAgICAgICBvYmpbbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpXSA9IGVsZW1lbnRUb0pzb24obm9kZSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb2JqO1xyXG59XG5cbnZhciBmcmFtZWZsYWcgPSAnZG9jdW1lbnRmcmFnbWVudGNvbnRhaW5lcic7XHJcblN0cmluZy5wcm90b3R5cGUuZm9yRWFjaEVtYmVkZGVkSXRlbSA9IGZ1bmN0aW9uIChjYWxsYmFja2ZuKSB7XHJcbiAgICB2YXIgc3RyID0gXCI8XCIuY29uY2F0KGZyYW1lZmxhZywgXCI+XCIpLmNvbmNhdCh0aGlzLnRvU3RyaW5nKCksIFwiPC9cIikuY29uY2F0KGZyYW1lZmxhZywgXCI+XCIpO1xyXG4gICAgdmFyIHJvb3QgPSAobmV3IERPTVBhcnNlcigpKS5wYXJzZUZyb21TdHJpbmcoc3RyLCAndGV4dC9odG1sJyk7XHJcbiAgICB2YXIgZW1iZWRkZWRFbnRyaWVzID0gcm9vdC5xdWVyeVNlbGVjdG9yQWxsKFwiLmVtYmVkZGVkLWVudHJ5XCIpO1xyXG4gICAgZW1iZWRkZWRFbnRyaWVzLmZvckVhY2goZnVuY3Rpb24gKGVsZW1lbnQpIHtcclxuICAgICAgICBjYWxsYmFja2ZuKGVsZW1lbnQub3V0ZXJIVE1MLCBjcmVhdGVNZXRhZGF0YShlbGVtZW50VG9Kc29uKGVsZW1lbnQpKSk7XHJcbiAgICB9KTtcclxuICAgIHZhciBlbWJlZGRlZEFzc2V0ID0gcm9vdC5xdWVyeVNlbGVjdG9yQWxsKFwiLmVtYmVkZGVkLWFzc2V0XCIpO1xyXG4gICAgZW1iZWRkZWRBc3NldC5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgY2FsbGJhY2tmbihlbGVtZW50Lm91dGVySFRNTCwgY3JlYXRlTWV0YWRhdGEoZWxlbWVudFRvSnNvbihlbGVtZW50KSkpO1xyXG4gICAgfSk7XHJcbn07XG5cbmZ1bmN0aW9uIHNhbml0aXplSFRNTChpbnB1dCwgYWxsb3dlZFRhZ3MsIGFsbG93ZWRBdHRyaWJ1dGVzKSB7XHJcbiAgICBpZiAoYWxsb3dlZFRhZ3MgPT09IHZvaWQgMCkgeyBhbGxvd2VkVGFncyA9IFsncCcsICdhJywgJ3N0cm9uZycsICdlbScsICd1bCcsICdvbCcsICdsaScsICdoMScsICdoMicsICdoMycsICdoNCcsICdoNScsICdoNicsICdzdWInLCAndScsICd0YWJsZScsICd0aGVhZCcsICd0Ym9keScsICd0cicsICd0aCcsICd0ZCcsICdzcGFuJywgJ2ZyYWdtZW50JywgJ3N1cCcsICdzdHJpa2UnLCAnYnInLCAnaW1nJywgJ2NvbGdyb3VwJywgJ2NvbCcsICdkaXYnXTsgfVxyXG4gICAgaWYgKGFsbG93ZWRBdHRyaWJ1dGVzID09PSB2b2lkIDApIHsgYWxsb3dlZEF0dHJpYnV0ZXMgPSBbJ2hyZWYnLCAndGl0bGUnLCAndGFyZ2V0JywgJ2FsdCcsICdzcmMnLCAnY2xhc3MnLCAnaWQnLCAnc3R5bGUnLCAnY29sc3BhbicsICdyb3dzcGFuJywgJ2NvbnRlbnQtdHlwZS11aWQnLCAnZGF0YS1zeXMtYXNzZXQtdWlkJywgJ3N5cy1zdHlsZS10eXBlJywgJ2RhdGEtdHlwZScsICdkYXRhLXdpZHRoJywgJ2RhdGEtcm93cycsICdkYXRhLWNvbHMnLCAnZGF0YS1tdGVjJ107IH1cclxuICAgIC8vIFJlcGxhY2UgbmV3bGluZSBjaGFyYWN0ZXJzIHdpdGggPGJyIC8+IGJlZm9yZSBwcm9jZXNzaW5nIHRoZSBIVE1MIHRhZ3NcclxuICAgIGlucHV0ID0gaW5wdXQucmVwbGFjZSgvXFxuL2csICc8YnIgLz4nKTtcclxuICAgIC8vIFJlZ3VsYXIgZXhwcmVzc2lvbiB0byBmaW5kIGFuZCByZW1vdmUgYWxsIEhUTUwgdGFncyBleGNlcHQgdGhlIGFsbG93ZWQgb25lc1xyXG4gICAgdmFyIHNhbml0aXplZCA9IGlucHV0LnJlcGxhY2UoLzxcXC8/KFthLXpdW2EtejAtOV0qKVxcYltePD5dKj4vZ2ksIGZ1bmN0aW9uIChtYXRjaCwgdGFnKSB7XHJcbiAgICAgICAgcmV0dXJuIGFsbG93ZWRUYWdzLmluY2x1ZGVzKHRhZy50b0xvd2VyQ2FzZSgpKSA/IG1hdGNoIDogJyc7XHJcbiAgICB9KTtcclxuICAgIC8vIFJlZ3VsYXIgZXhwcmVzc2lvbiB0byByZW1vdmUgYWxsIGF0dHJpYnV0ZXMgZXhjZXB0IHRoZSBhbGxvd2VkIG9uZXNcclxuICAgIHZhciBjbGVhbmVkID0gc2FuaXRpemVkLnJlcGxhY2UoLzwoW2Etel1bYS16MC05XSopXFxiW148Pl0qPi9naSwgZnVuY3Rpb24gKG1hdGNoLCB0YWcpIHtcclxuICAgICAgICBpZiAoIWFsbG93ZWRUYWdzLmluY2x1ZGVzKHRhZy50b0xvd2VyQ2FzZSgpKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gbWF0Y2g7IC8vIElnbm9yZSB0YWdzIG5vdCBpbiBhbGxvd2VkVGFnc1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyBGb3IgZWFjaCB0YWcgdGhhdCBpcyBhbGxvd2VkLCBjbGVhbiBpdHMgYXR0cmlidXRlc1xyXG4gICAgICAgIHJldHVybiBtYXRjaC5yZXBsYWNlKC9cXHMoW2EtelxcLV0rKT1bJ1wiXVteJ1wiXSpbJ1wiXS9naSwgZnVuY3Rpb24gKGF0dHJpYnV0ZU1hdGNoLCBhdHRyaWJ1dGUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGFsbG93ZWRBdHRyaWJ1dGVzLmluY2x1ZGVzKGF0dHJpYnV0ZS50b0xvd2VyQ2FzZSgpKSA/IGF0dHJpYnV0ZU1hdGNoIDogJyc7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBjbGVhbmVkO1xyXG59XG5cbnZhciBfYSQxO1xyXG52YXIgZGVmYXVsdE9wdGlvbnMgPSAoX2EkMSA9IHt9LFxyXG4gICAgX2EkMVtTdHlsZVR5cGUkMS5CTE9DS10gPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgIHZhciB0aXRsZSA9IHNhbml0aXplSFRNTChpdGVtLnRpdGxlIHx8IGl0ZW0udWlkKTtcclxuICAgICAgICB2YXIgY29udGVudF90eXBlX3VpZCA9IHNhbml0aXplSFRNTChpdGVtLl9jb250ZW50X3R5cGVfdWlkIHx8IChpdGVtLnN5c3RlbSA/IGl0ZW0uc3lzdGVtLmNvbnRlbnRfdHlwZV91aWQgOiAnJykpO1xyXG4gICAgICAgIHJldHVybiBcIjxkaXY+PHA+XCIuY29uY2F0KHRpdGxlLCBcIjwvcD48cD5Db250ZW50IHR5cGU6IDxzcGFuPlwiKS5jb25jYXQoY29udGVudF90eXBlX3VpZCwgXCI8L3NwYW4+PC9wPjwvZGl2PlwiKTtcclxuICAgIH0sXHJcbiAgICBfYSQxW1N0eWxlVHlwZSQxLklOTElORV0gPSBmdW5jdGlvbiAoaXRlbSkge1xyXG4gICAgICAgIHZhciB0aXRsZSA9IHNhbml0aXplSFRNTChpdGVtLnRpdGxlIHx8IGl0ZW0udWlkKTtcclxuICAgICAgICByZXR1cm4gXCI8c3Bhbj5cIi5jb25jYXQodGl0bGUsIFwiPC9zcGFuPlwiKTtcclxuICAgIH0sXHJcbiAgICBfYSQxW1N0eWxlVHlwZSQxLkxJTktdID0gZnVuY3Rpb24gKGl0ZW0sIG1ldGFkYXRhKSB7XHJcbiAgICAgICAgdmFyIHVybCA9IGl0ZW0udXJsID8gZW5jb2RlVVJJKHNhbml0aXplSFRNTChpdGVtLnVybCkpIDogbnVsbDtcclxuICAgICAgICB2YXIgdGV4dCA9IHNhbml0aXplSFRNTChtZXRhZGF0YS50ZXh0IHx8IGl0ZW0udGl0bGUgfHwgaXRlbS51aWQgfHwgKGl0ZW0uc3lzdGVtID8gaXRlbS5zeXN0ZW0udWlkIDogJycpKTtcclxuICAgICAgICB2YXIgaHJlZkF0dHIgPSB1cmwgPyBcIiBocmVmPVxcXCJcIi5jb25jYXQodXJsLCBcIlxcXCJcIikgOiAnJztcclxuICAgICAgICByZXR1cm4gXCI8YVwiLmNvbmNhdChocmVmQXR0ciwgXCI+XCIpLmNvbmNhdCh0ZXh0LCBcIjwvYT5cIik7XHJcbiAgICB9LFxyXG4gICAgX2EkMVtTdHlsZVR5cGUkMS5ESVNQTEFZXSA9IGZ1bmN0aW9uIChpdGVtLCBtZXRhZGF0YSkge1xyXG4gICAgICAgIHZhciB1cmwgPSBpdGVtLnVybCA/IGVuY29kZVVSSShzYW5pdGl6ZUhUTUwoaXRlbS51cmwpKSA6IG51bGw7XHJcbiAgICAgICAgdmFyIGFsdCA9IHNhbml0aXplSFRNTChtZXRhZGF0YS5hdHRyaWJ1dGVzLmFsdCB8fCBpdGVtLnRpdGxlIHx8IGl0ZW0uZmlsZW5hbWUgfHwgaXRlbS51aWRcclxuICAgICAgICAgICAgfHwgKGl0ZW0uc3lzdGVtID8gaXRlbS5zeXN0ZW0udWlkIDogJycpKTtcclxuICAgICAgICB2YXIgc3JjQXR0ciA9IHVybCA/IFwiIHNyYz1cXFwiXCIuY29uY2F0KHVybCwgXCJcXFwiXCIpIDogJyc7XHJcbiAgICAgICAgcmV0dXJuIFwiPGltZ1wiLmNvbmNhdChzcmNBdHRyLCBcIiBhbHQ9XFxcIlwiKS5jb25jYXQoYWx0LCBcIlxcXCIgLz5cIik7XHJcbiAgICB9LFxyXG4gICAgX2EkMVtTdHlsZVR5cGUkMS5ET1dOTE9BRF0gPSBmdW5jdGlvbiAoaXRlbSwgbWV0YWRhdGEpIHtcclxuICAgICAgICB2YXIgaHJlZiA9IGl0ZW0udXJsID8gZW5jb2RlVVJJKHNhbml0aXplSFRNTChpdGVtLnVybCkpIDogbnVsbDtcclxuICAgICAgICB2YXIgdGV4dCA9IHNhbml0aXplSFRNTChtZXRhZGF0YS50ZXh0IHx8IGl0ZW0udGl0bGUgfHwgaXRlbS51aWQgfHwgKGl0ZW0uc3lzdGVtID8gaXRlbS5zeXN0ZW0uY29udGVudF90eXBlX3VpZCA6ICcnKSk7XHJcbiAgICAgICAgdmFyIGhyZWZBdHRyID0gaHJlZiA/IFwiIGhyZWY9XFxcIlwiLmNvbmNhdChocmVmLCBcIlxcXCJcIikgOiAnJztcclxuICAgICAgICByZXR1cm4gXCI8YVwiLmNvbmNhdChocmVmQXR0ciwgXCI+XCIpLmNvbmNhdCh0ZXh0LCBcIjwvYT5cIik7XHJcbiAgICB9LFxyXG4gICAgX2EkMSk7XG5cbi8vIFRoaXMgZnVuY3Rpb24gd2lsbCBmaW5kIEVtYmVkZGVkIG9iamVjdCBwcmVzZW50IGluIHN0cmluZ1xyXG5mdW5jdGlvbiBmaW5kRW1iZWRkZWRFbnRyeSh1aWQsIGNvbnRlbnRUeXBlVWlkLCBlbWJlZGRlZGl0ZW1zKSB7XHJcbiAgICBpZiAoZW1iZWRkZWRpdGVtcyA9PT0gdm9pZCAwKSB7IGVtYmVkZGVkaXRlbXMgPSBbXTsgfVxyXG4gICAgcmV0dXJuIGVtYmVkZGVkaXRlbXMuZmlsdGVyKGZ1bmN0aW9uIChlbnRyeSkge1xyXG4gICAgICAgIGlmICghZW50cnkpXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICByZXR1cm4gKChlbnRyeS51aWQgJiYgZW50cnkudWlkID09PSB1aWQgJiYgZW50cnkuX2NvbnRlbnRfdHlwZV91aWQgPT09IGNvbnRlbnRUeXBlVWlkKSB8fFxyXG4gICAgICAgICAgICAoZW50cnkuc3lzdGVtICYmIGVudHJ5LnN5c3RlbS51aWQgPT09IHVpZCAmJiBlbnRyeS5zeXN0ZW0uY29udGVudF90eXBlX3VpZCA9PT0gY29udGVudFR5cGVVaWQpKTtcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIGZpbmRFbWJlZGRlZEFzc2V0KHVpZCwgZW1iZWRkZWRBc3NldHMpIHtcclxuICAgIGlmIChlbWJlZGRlZEFzc2V0cyA9PT0gdm9pZCAwKSB7IGVtYmVkZGVkQXNzZXRzID0gW107IH1cclxuICAgIHJldHVybiBlbWJlZGRlZEFzc2V0cy5maWx0ZXIoZnVuY3Rpb24gKGFzc2V0KSB7XHJcbiAgICAgICAgaWYgKCFhc3NldClcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIHJldHVybiAoKGFzc2V0LnVpZCAmJiBhc3NldC51aWQgPT09IHVpZCkgfHxcclxuICAgICAgICAgICAgKGFzc2V0LnN5c3RlbSAmJiBhc3NldC5zeXN0ZW0udWlkID09PSB1aWQpKTtcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIGZpbmRHUUxFbWJlZGRlZEl0ZW1zKG1ldGFkYXRhLCBpdGVtcykge1xyXG4gICAgaWYgKCFtZXRhZGF0YSB8fCAhaXRlbXMpXHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgaWYgKG1ldGFkYXRhLml0ZW1UeXBlID09PSAnZW50cnknKSB7XHJcbiAgICAgICAgcmV0dXJuIGZpbmRFbWJlZGRlZEVudHJ5KG1ldGFkYXRhLml0ZW1VaWQsIG1ldGFkYXRhLmNvbnRlbnRUeXBlVWlkLCBpdGVtcyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZmluZEVtYmVkZGVkQXNzZXQobWV0YWRhdGEuaXRlbVVpZCwgaXRlbXMpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGZpbmRFbWJlZGRlZEl0ZW1zKG9iamVjdCwgZW50cnkpIHtcclxuICAgIGlmIChvYmplY3QgJiYgb2JqZWN0ICE9PSB1bmRlZmluZWQgJiYgZW50cnkgJiYgZW50cnkgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGlmIChlbnRyeS5fZW1iZWRkZWRfaXRlbXMgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB2YXIgZW50cnlFbWJlZGFibGUgPSBlbnRyeTtcclxuICAgICAgICAgICAgdmFyIGl0ZW1zID0gT2JqZWN0LnZhbHVlcyhlbnRyeUVtYmVkYWJsZS5fZW1iZWRkZWRfaXRlbXMgfHwgW10pLnJlZHVjZShmdW5jdGlvbiAoYWNjdW11bGF0b3IsIHZhbHVlKSB7IHJldHVybiBhY2N1bXVsYXRvci5jb25jYXQodmFsdWUpOyB9LCBbXSk7XHJcbiAgICAgICAgICAgIHJldHVybiBmaW5kR1FMRW1iZWRkZWRJdGVtcyhvYmplY3QsIGl0ZW1zKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gW107XHJcbn1cclxuZnVuY3Rpb24gZmluZFJlbmRlclN0cmluZyhpdGVtLCBtZXRhZGF0YSwgcmVuZGVyT3B0aW9ucykge1xyXG4gICAgaWYgKCghaXRlbSAmJiBpdGVtID09PSB1bmRlZmluZWQpIHx8ICghbWV0YWRhdGEgJiYgbWV0YWRhdGEgPT09IHVuZGVmaW5lZCkpIHtcclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICB9XHJcbiAgICBpZiAocmVuZGVyT3B0aW9ucyAmJiByZW5kZXJPcHRpb25zW21ldGFkYXRhLnN0eWxlVHlwZV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHZhciByZW5kZXJGdW5jdGlvbiA9IHJlbmRlck9wdGlvbnNbbWV0YWRhdGEuc3R5bGVUeXBlXTtcclxuICAgICAgICBpZiAobWV0YWRhdGEuYXR0cmlidXRlc1snZGF0YS1zeXMtY29udGVudC10eXBlLXVpZCddICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICAgICAgdHlwZW9mIHJlbmRlckZ1bmN0aW9uICE9PSAnZnVuY3Rpb24nICYmXHJcbiAgICAgICAgICAgIHJlbmRlckZ1bmN0aW9uW21ldGFkYXRhLmF0dHJpYnV0ZXNbJ2RhdGEtc3lzLWNvbnRlbnQtdHlwZS11aWQnXV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyRnVuY3Rpb25bbWV0YWRhdGEuYXR0cmlidXRlc1snZGF0YS1zeXMtY29udGVudC10eXBlLXVpZCddXShpdGVtLCBtZXRhZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKG1ldGFkYXRhLmF0dHJpYnV0ZXNbJ2RhdGEtc3lzLWNvbnRlbnQtdHlwZS11aWQnXSAhPT0gdW5kZWZpbmVkICYmXHJcbiAgICAgICAgICAgIHR5cGVvZiByZW5kZXJGdW5jdGlvbiAhPT0gJ2Z1bmN0aW9uJyAmJlxyXG4gICAgICAgICAgICByZW5kZXJGdW5jdGlvbi4kZGVmYXVsdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZW5kZXJGdW5jdGlvbi4kZGVmYXVsdChpdGVtLCBtZXRhZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKG1ldGFkYXRhLmNvbnRlbnRUeXBlVWlkICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICAgICAgdHlwZW9mIHJlbmRlckZ1bmN0aW9uICE9PSAnZnVuY3Rpb24nICYmXHJcbiAgICAgICAgICAgIHJlbmRlckZ1bmN0aW9uW21ldGFkYXRhLmNvbnRlbnRUeXBlVWlkXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZW5kZXJGdW5jdGlvblttZXRhZGF0YS5jb250ZW50VHlwZVVpZF0oaXRlbSwgbWV0YWRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChtZXRhZGF0YS5jb250ZW50VHlwZVVpZCAhPT0gdW5kZWZpbmVkICYmXHJcbiAgICAgICAgICAgIHR5cGVvZiByZW5kZXJGdW5jdGlvbiAhPT0gJ2Z1bmN0aW9uJyAmJlxyXG4gICAgICAgICAgICByZW5kZXJGdW5jdGlvbi4kZGVmYXVsdCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZW5kZXJGdW5jdGlvbi4kZGVmYXVsdChpdGVtLCBtZXRhZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiByZW5kZXJGdW5jdGlvbiA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyRnVuY3Rpb24oaXRlbSwgbWV0YWRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHZhciBkZWZhdWx0UmVuZGVyRnVuY3Rpb24gPSBkZWZhdWx0T3B0aW9uc1ttZXRhZGF0YS5zdHlsZVR5cGVdO1xyXG4gICAgcmV0dXJuIGRlZmF1bHRSZW5kZXJGdW5jdGlvbihpdGVtLCBtZXRhZGF0YSk7XHJcbn1cblxuZnVuY3Rpb24gZmluZFJlbmRlckNvbnRlbnQoa2V5UGF0aHMsIGVudHJ5LCByZW5kZXIpIHtcclxuICAgIGdldENvbnRlbnQoa2V5UGF0aHMuc3BsaXQoXCIuXCIpLCBlbnRyeSwgcmVuZGVyKTtcclxufVxyXG5mdW5jdGlvbiBnZXRDb250ZW50KGtleXMsIG9iamVjdCwgcmVuZGVyKSB7XHJcbiAgICBpZiAoa2V5cykge1xyXG4gICAgICAgIHZhciBrZXkgPSBrZXlzWzBdO1xyXG4gICAgICAgIGlmIChrZXlzLmxlbmd0aCA9PT0gMSAmJiBvYmplY3Rba2V5XSkge1xyXG4gICAgICAgICAgICBvYmplY3Rba2V5XSA9IHJlbmRlcihvYmplY3Rba2V5XSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGtleXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBpZiAob2JqZWN0W2tleV0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBuZXdLZXlzID0ga2V5cy5zbGljZSgxKTtcclxuICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KG9iamVjdFtrZXldKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTogcHJlZmVyLWZvci1vZlxyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBvYmplY3Rba2V5XTsgX2kgPCBfYS5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9iaktleSA9IF9hW19pXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Q29udGVudChuZXdLZXlzLCBvYmpLZXksIHJlbmRlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG9iamVjdFtrZXldID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIGdldENvbnRlbnQobmV3S2V5cywgb2JqZWN0W2tleV0sIHJlbmRlcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqXHJcbiAqIEBwYXJhbSB7RW50cnlFbWJlZGFibGV8IEVudHJ5RW1iZWRhYmxlW119IGVudHJ5IC0gT2JqZWN0cyB0aGF0IGNvbnRhaW5zIFJURSB3aXRoIGVtYmVkZGVkIG9iamVjdHNcclxuICogQHBhcmFtIHtzdHJpbmdbXX0gcGF0aHMgLSBLZXkgcGF0aHMgZm9yIFJURSBjb250ZW50cyBpbiBFbnRyeSBvYmplY3RcclxuICogQHBhcmFtIHtSZW5kZXJPcHRpb24/fSByZW5kZXJPcHRpb24gLSAgT3B0aW9uYWwgcmVuZGVyIG9wdGlvbnMgdG8gcmVuZGVyIGNvbnRlbnRcclxuICovXHJcbmZ1bmN0aW9uIHJlbmRlcihvcHRpb24pIHtcclxuICAgIGZ1bmN0aW9uIGZpbmRDb250ZW50KHBhdGgsIGVudHJ5KSB7XHJcbiAgICAgICAgZmluZFJlbmRlckNvbnRlbnQocGF0aCwgZW50cnksIGZ1bmN0aW9uIChjb250ZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZW5kZXJDb250ZW50KGNvbnRlbnQsIHsgZW50cnk6IGVudHJ5LCByZW5kZXJPcHRpb246IG9wdGlvbi5yZW5kZXJPcHRpb24gfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBmaW5kQW5kUmVuZGVyKGVudHJ5KSB7XHJcbiAgICAgICAgaWYgKCFvcHRpb24ucGF0aHMgfHwgb3B0aW9uLnBhdGhzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhfX2Fzc2lnbih7fSwgZW50cnkuX2VtYmVkZGVkX2l0ZW1zKSkuZm9yRWFjaChmdW5jdGlvbiAocGF0aCkge1xyXG4gICAgICAgICAgICAgICAgZmluZENvbnRlbnQocGF0aCwgZW50cnkpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIG9wdGlvbi5wYXRocy5mb3JFYWNoKGZ1bmN0aW9uIChwYXRoKSB7XHJcbiAgICAgICAgICAgICAgICBmaW5kQ29udGVudChwYXRoLCBlbnRyeSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChvcHRpb24uZW50cnkgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgIG9wdGlvbi5lbnRyeS5mb3JFYWNoKGZ1bmN0aW9uIChlbnRyeSkge1xyXG4gICAgICAgICAgICBmaW5kQW5kUmVuZGVyKGVudHJ5KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGZpbmRBbmRSZW5kZXIob3B0aW9uLmVudHJ5KTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICpcclxuICogQHBhcmFtIHtzdHJpbmcgfCBzdHJpbmdbXX0gY29udGVudCAtIFJURSBjb250ZW50IHRvIHJlbmRlclxyXG4gKiBAcGFyYW0ge0VudHJ5RW1iZWRhYmxlfSBvcHRpb25zLmVudHJ5IC0gRW50cnkgb2JqZWN0IGNvbnRhaW5pbmcgZW1iZWRkZWQgb2JqZWN0c1xyXG4gKiBAcGFyYW0ge1JlbmRlck9wdGlvbj99IG9wdGlvbnMucmVuZGVyT3B0aW9uIC0gT3B0aW9uYWwgcmVuZGVyIG9wdGlvbnMgdG8gcmVuZGVyIGNvbnRlbnRcclxuICovXHJcbmZ1bmN0aW9uIHJlbmRlckNvbnRlbnQoY29udGVudCwgb3B0aW9uKSB7XHJcbiAgICAvLyByZXR1cm4gYmxhbmsgaWYgY29udGVudCBub3QgcHJlc2VudFxyXG4gICAgaWYgKCFjb250ZW50IHx8IGNvbnRlbnQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxuICAgIC8vIHJlbmRlciBjb250ZW50IG9mIHR5cGUgc3RyaW5nXHJcbiAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgdmFyIGNvbnRlbnRUb1JlcGxhY2VfMSA9IGNvbnRlbnQ7XHJcbiAgICAgICAgY29udGVudC5mb3JFYWNoRW1iZWRkZWRJdGVtKGZ1bmN0aW9uIChlbWJlZGVkT2JqZWN0VGFnLCBvYmplY3QpIHtcclxuICAgICAgICAgICAgY29udGVudFRvUmVwbGFjZV8xID0gZmluZEFuZFJlcGxhY2VFbWJlZGRlZEl0ZW0oY29udGVudFRvUmVwbGFjZV8xLCBlbWJlZGVkT2JqZWN0VGFnLCBvYmplY3QsIG9wdGlvbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRlbnRUb1JlcGxhY2VfMTtcclxuICAgIH1cclxuICAgIC8vIHJlbmRlciBjb250ZW50IG9mIHR5cGUgYXJyYXkgb2Ygc3RyaW5nXHJcbiAgICB2YXIgcmVzdWx0Q29udGVudCA9IFtdO1xyXG4gICAgY29udGVudC5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgcmVzdWx0Q29udGVudC5wdXNoKHJlbmRlckNvbnRlbnQoZWxlbWVudCwgb3B0aW9uKSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiByZXN1bHRDb250ZW50O1xyXG59XHJcbmZ1bmN0aW9uIGZpbmRBbmRSZXBsYWNlRW1iZWRkZWRJdGVtKGNvbnRlbnQsIGVtYmVkZWRPYmplY3RUYWcsIG1ldGFkYXRhLCBvcHRpb24pIHtcclxuICAgIHZhciBlbWJlZGRlZE9iamVjdHMgPSBmaW5kRW1iZWRkZWRJdGVtcyhtZXRhZGF0YSwgb3B0aW9uLmVudHJ5KTtcclxuICAgIHZhciByZW5kZXJTdHJpbmcgPSBmaW5kUmVuZGVyU3RyaW5nKGVtYmVkZGVkT2JqZWN0c1swXSwgbWV0YWRhdGEsIG9wdGlvbi5yZW5kZXJPcHRpb24pO1xyXG4gICAgcmV0dXJuIGNvbnRlbnQucmVwbGFjZShlbWJlZGVkT2JqZWN0VGFnLCByZW5kZXJTdHJpbmcpO1xyXG59XG5cbnZhciBOb2RlVHlwZTtcclxuKGZ1bmN0aW9uIChOb2RlVHlwZSkge1xyXG4gICAgTm9kZVR5cGVbXCJET0NVTUVOVFwiXSA9IFwiZG9jXCI7XHJcbiAgICBOb2RlVHlwZVtcIlBBUkFHUkFQSFwiXSA9IFwicFwiO1xyXG4gICAgTm9kZVR5cGVbXCJMSU5LXCJdID0gXCJhXCI7XHJcbiAgICBOb2RlVHlwZVtcIklNQUdFXCJdID0gXCJpbWdcIjtcclxuICAgIE5vZGVUeXBlW1wiRU1CRURcIl0gPSBcImVtYmVkXCI7XHJcbiAgICBOb2RlVHlwZVtcIkhFQURJTkdfMVwiXSA9IFwiaDFcIjtcclxuICAgIE5vZGVUeXBlW1wiSEVBRElOR18yXCJdID0gXCJoMlwiO1xyXG4gICAgTm9kZVR5cGVbXCJIRUFESU5HXzNcIl0gPSBcImgzXCI7XHJcbiAgICBOb2RlVHlwZVtcIkhFQURJTkdfNFwiXSA9IFwiaDRcIjtcclxuICAgIE5vZGVUeXBlW1wiSEVBRElOR181XCJdID0gXCJoNVwiO1xyXG4gICAgTm9kZVR5cGVbXCJIRUFESU5HXzZcIl0gPSBcImg2XCI7XHJcbiAgICBOb2RlVHlwZVtcIk9SREVSX0xJU1RcIl0gPSBcIm9sXCI7XHJcbiAgICBOb2RlVHlwZVtcIlVOT1JERVJfTElTVFwiXSA9IFwidWxcIjtcclxuICAgIE5vZGVUeXBlW1wiTElTVF9JVEVNXCJdID0gXCJsaVwiO1xyXG4gICAgTm9kZVR5cGVbXCJGUkFHTUVOVFwiXSA9IFwiZnJhZ21lbnRcIjtcclxuICAgIE5vZGVUeXBlW1wiSFJcIl0gPSBcImhyXCI7XHJcbiAgICBOb2RlVHlwZVtcIlRBQkxFXCJdID0gXCJ0YWJsZVwiO1xyXG4gICAgTm9kZVR5cGVbXCJUQUJMRV9IRUFERVJcIl0gPSBcInRoZWFkXCI7XHJcbiAgICBOb2RlVHlwZVtcIlRBQkxFX0JPRFlcIl0gPSBcInRib2R5XCI7XHJcbiAgICBOb2RlVHlwZVtcIlRBQkxFX0ZPT1RFUlwiXSA9IFwidGZvb3RcIjtcclxuICAgIE5vZGVUeXBlW1wiVEFCTEVfUk9XXCJdID0gXCJ0clwiO1xyXG4gICAgTm9kZVR5cGVbXCJUQUJMRV9IRUFEXCJdID0gXCJ0aFwiO1xyXG4gICAgTm9kZVR5cGVbXCJUQUJMRV9EQVRBXCJdID0gXCJ0ZFwiO1xyXG4gICAgTm9kZVR5cGVbXCJDT0xfR1JPVVBcIl0gPSBcImNvbGdyb3VwXCI7XHJcbiAgICBOb2RlVHlwZVtcIkNPTFwiXSA9IFwiY29sXCI7XHJcbiAgICBOb2RlVHlwZVtcIkJMT0NLX1FVT1RFXCJdID0gXCJibG9ja3F1b3RlXCI7XHJcbiAgICBOb2RlVHlwZVtcIkNPREVcIl0gPSBcImNvZGVcIjtcclxuICAgIE5vZGVUeXBlW1wiVEVYVFwiXSA9IFwidGV4dFwiO1xyXG4gICAgTm9kZVR5cGVbXCJSRUZFUkVOQ0VcIl0gPSBcInJlZmVyZW5jZVwiO1xyXG59KShOb2RlVHlwZSB8fCAoTm9kZVR5cGUgPSB7fSkpO1xyXG52YXIgTm9kZVR5cGUkMSA9IE5vZGVUeXBlO1xuXG52YXIgTWFya1R5cGU7XHJcbihmdW5jdGlvbiAoTWFya1R5cGUpIHtcclxuICAgIE1hcmtUeXBlW1wiQk9MRFwiXSA9IFwiYm9sZFwiO1xyXG4gICAgTWFya1R5cGVbXCJJVEFMSUNcIl0gPSBcIml0YWxpY1wiO1xyXG4gICAgTWFya1R5cGVbXCJVTkRFUkxJTkVcIl0gPSBcInVuZGVybGluZVwiO1xyXG4gICAgTWFya1R5cGVbXCJDTEFTU05BTUVfT1JfSURcIl0gPSBcImNsYXNzbmFtZU9ySWRcIjtcclxuICAgIE1hcmtUeXBlW1wiU1RSSUtFX1RIUk9VR0hcIl0gPSBcInN0cmlrZXRocm91Z2hcIjtcclxuICAgIE1hcmtUeXBlW1wiSU5MSU5FX0NPREVcIl0gPSBcImlubGluZUNvZGVcIjtcclxuICAgIE1hcmtUeXBlW1wiU1VCU0NSSVBUXCJdID0gXCJzdWJzY3JpcHRcIjtcclxuICAgIE1hcmtUeXBlW1wiU1VQRVJTQ1JJUFRcIl0gPSBcInN1cGVyc2NyaXB0XCI7XHJcbiAgICBNYXJrVHlwZVtcIkJSRUFLXCJdID0gXCJicmVha1wiO1xyXG59KShNYXJrVHlwZSB8fCAoTWFya1R5cGUgPSB7fSkpO1xyXG52YXIgTWFya1R5cGUkMSA9IE1hcmtUeXBlO1xuXG52YXIgTm9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIE5vZGUoKSB7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gTm9kZTtcclxufSgpKTtcblxudmFyIERvY3VtZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKERvY3VtZW50LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gRG9jdW1lbnQoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy50eXBlID0gTm9kZVR5cGUkMS5ET0NVTUVOVDtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gRG9jdW1lbnQ7XHJcbn0oTm9kZSkpO1xuXG52YXIgVGV4dE5vZGUgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVGV4dE5vZGUsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBUZXh0Tm9kZSh0ZXh0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy50ZXh0ID0gdGV4dDtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gVGV4dE5vZGU7XHJcbn0oTm9kZSkpO1xuXG52YXIgX2E7XHJcbi8qKlxyXG4gKiBTYWZlbHkgZ2V0cyBhbiBhdHRyaWJ1dGUgdmFsdWUgZnJvbSBub2RlLmF0dHJzXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRBdHRyKG5vZGUsIGtleSkge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgcmV0dXJuIChfYSA9IG5vZGUuYXR0cnMpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtrZXldO1xyXG59XHJcbi8qKlxyXG4gKiBTYWZlbHkgZ2V0cyBhIHN0cmluZyBhdHRyaWJ1dGUgdmFsdWUgZnJvbSBub2RlLmF0dHJzXHJcbiAqL1xyXG5mdW5jdGlvbiBnZXRBdHRyU3RyaW5nKG5vZGUsIGtleSkge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgdmFyIHZhbHVlID0gKF9hID0gbm9kZS5hdHRycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hW2tleV07XHJcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyA/IHZhbHVlIDogdW5kZWZpbmVkO1xyXG59XHJcbi8qKlxyXG4gKiBCdWlsZHMgY29tbW9uIEhUTUwgYXR0cmlidXRlcyBzdHJpbmcgKHN0eWxlLCBjbGFzcy1uYW1lLCBpZClcclxuICovXHJcbmZ1bmN0aW9uIGJ1aWxkQ29tbW9uQXR0cnMobm9kZSkge1xyXG4gICAgaWYgKCFub2RlLmF0dHJzKVxyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIHZhciBhdHRycyA9IFtdO1xyXG4gICAgaWYgKG5vZGUuYXR0cnMuc3R5bGUpIHtcclxuICAgICAgICBhdHRycy5wdXNoKFwiIHN0eWxlPVxcXCJcIi5jb25jYXQobm9kZS5hdHRycy5zdHlsZSwgXCJcXFwiXCIpKTtcclxuICAgIH1cclxuICAgIGlmIChub2RlLmF0dHJzWydjbGFzcy1uYW1lJ10pIHtcclxuICAgICAgICBhdHRycy5wdXNoKFwiIGNsYXNzPVxcXCJcIi5jb25jYXQobm9kZS5hdHRyc1snY2xhc3MtbmFtZSddLCBcIlxcXCJcIikpO1xyXG4gICAgfVxyXG4gICAgaWYgKG5vZGUuYXR0cnMuaWQpIHtcclxuICAgICAgICBhdHRycy5wdXNoKFwiIGlkPVxcXCJcIi5jb25jYXQobm9kZS5hdHRycy5pZCwgXCJcXFwiXCIpKTtcclxuICAgIH1cclxuICAgIHJldHVybiBhdHRycy5qb2luKCcnKTtcclxufVxyXG52YXIgZGVmYXVsdE5vZGVPcHRpb24gPSAoX2EgPSB7fSxcclxuICAgIF9hW05vZGVUeXBlJDEuRE9DVU1FTlRdID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIlwiO1xyXG4gICAgfSxcclxuICAgIF9hW05vZGVUeXBlJDEuUEFSQUdSQVBIXSA9IGZ1bmN0aW9uIChub2RlLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIFwiPHBcIi5jb25jYXQoYnVpbGRDb21tb25BdHRycyhub2RlKSwgXCI+XCIpLmNvbmNhdChzYW5pdGl6ZUhUTUwobmV4dChub2RlLmNoaWxkcmVuKSksIFwiPC9wPlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVtOb2RlVHlwZSQxLkxJTktdID0gZnVuY3Rpb24gKG5vZGUsIG5leHQpIHtcclxuICAgICAgICB2YXIgaHJlZiA9IGdldEF0dHJTdHJpbmcobm9kZSwgJ2hyZWYnKSB8fCBnZXRBdHRyU3RyaW5nKG5vZGUsICd1cmwnKSB8fCAnJztcclxuICAgICAgICB2YXIgc2FuaXRpemVkSHJlZiA9IHNhbml0aXplSFRNTChocmVmKTtcclxuICAgICAgICB2YXIgdGFyZ2V0ID0gZ2V0QXR0clN0cmluZyhub2RlLCAndGFyZ2V0Jyk7XHJcbiAgICAgICAgdmFyIHRhcmdldEF0dHIgPSB0YXJnZXQgPyBcIiB0YXJnZXQ9XFxcIlwiLmNvbmNhdCh0YXJnZXQsIFwiXFxcIlwiKSA6ICcnO1xyXG4gICAgICAgIHJldHVybiBcIjxhXCIuY29uY2F0KGJ1aWxkQ29tbW9uQXR0cnMobm9kZSkpLmNvbmNhdChzYW5pdGl6ZWRIcmVmID8gXCIgaHJlZj1cXFwiXCIuY29uY2F0KHNhbml0aXplZEhyZWYsIFwiXFxcIlwiKSA6ICcnKS5jb25jYXQodGFyZ2V0QXR0ciwgXCI+XCIpLmNvbmNhdChzYW5pdGl6ZUhUTUwobmV4dChub2RlLmNoaWxkcmVuKSksIFwiPC9hPlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVtOb2RlVHlwZSQxLklNQUdFXSA9IGZ1bmN0aW9uIChub2RlLCBuZXh0KSB7XHJcbiAgICAgICAgdmFyIHNyYyA9IGdldEF0dHJTdHJpbmcobm9kZSwgJ3NyYycpIHx8IGdldEF0dHJTdHJpbmcobm9kZSwgJ3VybCcpO1xyXG4gICAgICAgIHZhciBzYW5pdGl6ZWRTcmMgPSBzcmMgPyBlbmNvZGVVUkkoc2FuaXRpemVIVE1MKHNyYykpIDogJyc7XHJcbiAgICAgICAgcmV0dXJuIFwiPGltZ1wiLmNvbmNhdChidWlsZENvbW1vbkF0dHJzKG5vZGUpKS5jb25jYXQoc2FuaXRpemVkU3JjID8gXCIgc3JjPVxcXCJcIi5jb25jYXQoc2FuaXRpemVkU3JjLCBcIlxcXCJcIikgOiAnJywgXCIgLz5cIikuY29uY2F0KHNhbml0aXplSFRNTChuZXh0KG5vZGUuY2hpbGRyZW4pKSk7XHJcbiAgICB9LFxyXG4gICAgX2FbTm9kZVR5cGUkMS5FTUJFRF0gPSBmdW5jdGlvbiAobm9kZSwgbmV4dCkge1xyXG4gICAgICAgIHZhciBzcmMgPSBnZXRBdHRyU3RyaW5nKG5vZGUsICdzcmMnKSB8fCBnZXRBdHRyU3RyaW5nKG5vZGUsICd1cmwnKTtcclxuICAgICAgICB2YXIgc2FuaXRpemVkU3JjID0gc3JjID8gZW5jb2RlVVJJKHNhbml0aXplSFRNTChzcmMpKSA6ICcnO1xyXG4gICAgICAgIHJldHVybiBcIjxpZnJhbWVcIi5jb25jYXQoYnVpbGRDb21tb25BdHRycyhub2RlKSkuY29uY2F0KHNhbml0aXplZFNyYyA/IFwiIHNyYz1cXFwiXCIuY29uY2F0KHNhbml0aXplZFNyYywgXCJcXFwiXCIpIDogJycsIFwiPlwiKS5jb25jYXQoc2FuaXRpemVIVE1MKG5leHQobm9kZS5jaGlsZHJlbikpLCBcIjwvaWZyYW1lPlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVtOb2RlVHlwZSQxLkhFQURJTkdfMV0gPSBmdW5jdGlvbiAobm9kZSwgbmV4dCkge1xyXG4gICAgICAgIHJldHVybiBcIjxoMVwiLmNvbmNhdChidWlsZENvbW1vbkF0dHJzKG5vZGUpLCBcIj5cIikuY29uY2F0KHNhbml0aXplSFRNTChuZXh0KG5vZGUuY2hpbGRyZW4pKSwgXCI8L2gxPlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVtOb2RlVHlwZSQxLkhFQURJTkdfMl0gPSBmdW5jdGlvbiAobm9kZSwgbmV4dCkge1xyXG4gICAgICAgIHJldHVybiBcIjxoMlwiLmNvbmNhdChidWlsZENvbW1vbkF0dHJzKG5vZGUpLCBcIj5cIikuY29uY2F0KHNhbml0aXplSFRNTChuZXh0KG5vZGUuY2hpbGRyZW4pKSwgXCI8L2gyPlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVtOb2RlVHlwZSQxLkhFQURJTkdfM10gPSBmdW5jdGlvbiAobm9kZSwgbmV4dCkge1xyXG4gICAgICAgIHJldHVybiBcIjxoM1wiLmNvbmNhdChidWlsZENvbW1vbkF0dHJzKG5vZGUpLCBcIj5cIikuY29uY2F0KHNhbml0aXplSFRNTChuZXh0KG5vZGUuY2hpbGRyZW4pKSwgXCI8L2gzPlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVtOb2RlVHlwZSQxLkhFQURJTkdfNF0gPSBmdW5jdGlvbiAobm9kZSwgbmV4dCkge1xyXG4gICAgICAgIHJldHVybiBcIjxoNFwiLmNvbmNhdChidWlsZENvbW1vbkF0dHJzKG5vZGUpLCBcIj5cIikuY29uY2F0KHNhbml0aXplSFRNTChuZXh0KG5vZGUuY2hpbGRyZW4pKSwgXCI8L2g0PlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVtOb2RlVHlwZSQxLkhFQURJTkdfNV0gPSBmdW5jdGlvbiAobm9kZSwgbmV4dCkge1xyXG4gICAgICAgIHJldHVybiBcIjxoNVwiLmNvbmNhdChidWlsZENvbW1vbkF0dHJzKG5vZGUpLCBcIj5cIikuY29uY2F0KHNhbml0aXplSFRNTChuZXh0KG5vZGUuY2hpbGRyZW4pKSwgXCI8L2g1PlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVtOb2RlVHlwZSQxLkhFQURJTkdfNl0gPSBmdW5jdGlvbiAobm9kZSwgbmV4dCkge1xyXG4gICAgICAgIHJldHVybiBcIjxoNlwiLmNvbmNhdChidWlsZENvbW1vbkF0dHJzKG5vZGUpLCBcIj5cIikuY29uY2F0KHNhbml0aXplSFRNTChuZXh0KG5vZGUuY2hpbGRyZW4pKSwgXCI8L2g2PlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVtOb2RlVHlwZSQxLk9SREVSX0xJU1RdID0gZnVuY3Rpb24gKG5vZGUsIG5leHQpIHtcclxuICAgICAgICByZXR1cm4gXCI8b2xcIi5jb25jYXQoYnVpbGRDb21tb25BdHRycyhub2RlKSwgXCI+XCIpLmNvbmNhdChzYW5pdGl6ZUhUTUwobmV4dChub2RlLmNoaWxkcmVuKSksIFwiPC9vbD5cIik7XHJcbiAgICB9LFxyXG4gICAgX2FbTm9kZVR5cGUkMS5GUkFHTUVOVF0gPSBmdW5jdGlvbiAobm9kZSwgbmV4dCkge1xyXG4gICAgICAgIHJldHVybiBcIjxmcmFnbWVudD5cIi5jb25jYXQoc2FuaXRpemVIVE1MKG5leHQobm9kZS5jaGlsZHJlbikpLCBcIjwvZnJhZ21lbnQ+XCIpO1xyXG4gICAgfSxcclxuICAgIF9hW05vZGVUeXBlJDEuVU5PUkRFUl9MSVNUXSA9IGZ1bmN0aW9uIChub2RlLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIFwiPHVsXCIuY29uY2F0KGJ1aWxkQ29tbW9uQXR0cnMobm9kZSksIFwiPlwiKS5jb25jYXQoc2FuaXRpemVIVE1MKG5leHQobm9kZS5jaGlsZHJlbikpLCBcIjwvdWw+XCIpO1xyXG4gICAgfSxcclxuICAgIF9hW05vZGVUeXBlJDEuTElTVF9JVEVNXSA9IGZ1bmN0aW9uIChub2RlLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIFwiPGxpXCIuY29uY2F0KGJ1aWxkQ29tbW9uQXR0cnMobm9kZSksIFwiPlwiKS5jb25jYXQoc2FuaXRpemVIVE1MKG5leHQobm9kZS5jaGlsZHJlbikpLCBcIjwvbGk+XCIpO1xyXG4gICAgfSxcclxuICAgIF9hW05vZGVUeXBlJDEuSFJdID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBcIjxocj5cIjtcclxuICAgIH0sXHJcbiAgICBfYVtOb2RlVHlwZSQxLlRBQkxFXSA9IGZ1bmN0aW9uIChub2RlLCBuZXh0KSB7XHJcbiAgICAgICAgLy8gR2VuZXJhdGUgY29sZ3JvdXAgaWYgY29sV2lkdGhzIGF0dHJpYnV0ZSBpcyBwcmVzZW50XHJcbiAgICAgICAgdmFyIGNvbGdyb3VwSFRNTCA9ICcnO1xyXG4gICAgICAgIHZhciBjb2xXaWR0aHMgPSBnZXRBdHRyKG5vZGUsICdjb2xXaWR0aHMnKTtcclxuICAgICAgICBpZiAoY29sV2lkdGhzICYmIEFycmF5LmlzQXJyYXkoY29sV2lkdGhzKSkge1xyXG4gICAgICAgICAgICB2YXIgdG90YWxXaWR0aF8xID0gY29sV2lkdGhzLnJlZHVjZShmdW5jdGlvbiAoc3VtLCB3aWR0aCkgeyByZXR1cm4gc3VtICsgd2lkdGg7IH0sIDApO1xyXG4gICAgICAgICAgICBjb2xncm91cEhUTUwgPSBcIjxcIi5jb25jYXQoTm9kZVR5cGUkMS5DT0xfR1JPVVAsIFwiIGRhdGEtd2lkdGg9XFxcIlwiKS5jb25jYXQodG90YWxXaWR0aF8xLCBcIlxcXCI+XCIpO1xyXG4gICAgICAgICAgICBjb2xXaWR0aHMuZm9yRWFjaChmdW5jdGlvbiAoY29sV2lkdGgpIHtcclxuICAgICAgICAgICAgICAgIHZhciB3aWR0aFBlcmNlbnRhZ2UgPSAoY29sV2lkdGggLyB0b3RhbFdpZHRoXzEpICogMTAwO1xyXG4gICAgICAgICAgICAgICAgY29sZ3JvdXBIVE1MICs9IFwiPFwiLmNvbmNhdChOb2RlVHlwZSQxLkNPTCwgXCIgc3R5bGU9XFxcIndpZHRoOlwiKS5jb25jYXQod2lkdGhQZXJjZW50YWdlLnRvRml4ZWQoMiksIFwiJVxcXCIvPlwiKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGNvbGdyb3VwSFRNTCArPSBcIjwvXCIuY29uY2F0KE5vZGVUeXBlJDEuQ09MX0dST1VQLCBcIj5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEdlbmVyYXRlIHRhYmxlIHdpdGggY29sZ3JvdXAgYW5kIG90aGVyIGF0dHJpYnV0ZXNcclxuICAgICAgICByZXR1cm4gXCI8dGFibGVcIi5jb25jYXQoYnVpbGRDb21tb25BdHRycyhub2RlKSwgXCI+XCIpLmNvbmNhdChjb2xncm91cEhUTUwpLmNvbmNhdChzYW5pdGl6ZUhUTUwobmV4dChub2RlLmNoaWxkcmVuKSksIFwiPC90YWJsZT5cIik7XHJcbiAgICB9LFxyXG4gICAgX2FbTm9kZVR5cGUkMS5UQUJMRV9IRUFERVJdID0gZnVuY3Rpb24gKG5vZGUsIG5leHQpIHtcclxuICAgICAgICByZXR1cm4gXCI8dGhlYWRcIi5jb25jYXQoYnVpbGRDb21tb25BdHRycyhub2RlKSwgXCI+XCIpLmNvbmNhdChzYW5pdGl6ZUhUTUwobmV4dChub2RlLmNoaWxkcmVuKSksIFwiPC90aGVhZD5cIik7XHJcbiAgICB9LFxyXG4gICAgX2FbTm9kZVR5cGUkMS5UQUJMRV9CT0RZXSA9IGZ1bmN0aW9uIChub2RlLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIFwiPHRib2R5XCIuY29uY2F0KGJ1aWxkQ29tbW9uQXR0cnMobm9kZSksIFwiPlwiKS5jb25jYXQoc2FuaXRpemVIVE1MKG5leHQobm9kZS5jaGlsZHJlbikpLCBcIjwvdGJvZHk+XCIpO1xyXG4gICAgfSxcclxuICAgIF9hW05vZGVUeXBlJDEuVEFCTEVfRk9PVEVSXSA9IGZ1bmN0aW9uIChub2RlLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIFwiPHRmb290XCIuY29uY2F0KGJ1aWxkQ29tbW9uQXR0cnMobm9kZSksIFwiPlwiKS5jb25jYXQoc2FuaXRpemVIVE1MKG5leHQobm9kZS5jaGlsZHJlbikpLCBcIjwvdGZvb3Q+XCIpO1xyXG4gICAgfSxcclxuICAgIF9hW05vZGVUeXBlJDEuVEFCTEVfUk9XXSA9IGZ1bmN0aW9uIChub2RlLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIFwiPHRyXCIuY29uY2F0KGJ1aWxkQ29tbW9uQXR0cnMobm9kZSksIFwiPlwiKS5jb25jYXQoc2FuaXRpemVIVE1MKG5leHQobm9kZS5jaGlsZHJlbikpLCBcIjwvdHI+XCIpO1xyXG4gICAgfSxcclxuICAgIF9hW05vZGVUeXBlJDEuVEFCTEVfSEVBRF0gPSBmdW5jdGlvbiAobm9kZSwgbmV4dCkge1xyXG4gICAgICAgIGlmIChnZXRBdHRyKG5vZGUsICd2b2lkJykpXHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB2YXIgcm93U3BhbiA9IGdldEF0dHIobm9kZSwgJ3Jvd1NwYW4nKTtcclxuICAgICAgICB2YXIgY29sU3BhbiA9IGdldEF0dHIobm9kZSwgJ2NvbFNwYW4nKTtcclxuICAgICAgICB2YXIgcm93U3BhbkF0dHIgPSByb3dTcGFuID8gXCIgcm93c3Bhbj1cXFwiXCIuY29uY2F0KHJvd1NwYW4sIFwiXFxcIlwiKSA6ICcnO1xyXG4gICAgICAgIHZhciBjb2xTcGFuQXR0ciA9IGNvbFNwYW4gPyBcIiBjb2xzcGFuPVxcXCJcIi5jb25jYXQoY29sU3BhbiwgXCJcXFwiXCIpIDogJyc7XHJcbiAgICAgICAgcmV0dXJuIFwiPHRoXCIuY29uY2F0KHJvd1NwYW5BdHRyKS5jb25jYXQoY29sU3BhbkF0dHIpLmNvbmNhdChidWlsZENvbW1vbkF0dHJzKG5vZGUpLCBcIj5cIikuY29uY2F0KHNhbml0aXplSFRNTChuZXh0KG5vZGUuY2hpbGRyZW4pKSwgXCI8L3RoPlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVtOb2RlVHlwZSQxLlRBQkxFX0RBVEFdID0gZnVuY3Rpb24gKG5vZGUsIG5leHQpIHtcclxuICAgICAgICBpZiAoZ2V0QXR0cihub2RlLCAndm9pZCcpKVxyXG4gICAgICAgICAgICByZXR1cm4gJyc7XHJcbiAgICAgICAgdmFyIHJvd1NwYW4gPSBnZXRBdHRyKG5vZGUsICdyb3dTcGFuJyk7XHJcbiAgICAgICAgdmFyIGNvbFNwYW4gPSBnZXRBdHRyKG5vZGUsICdjb2xTcGFuJyk7XHJcbiAgICAgICAgdmFyIHJvd1NwYW5BdHRyID0gcm93U3BhbiA/IFwiIHJvd3NwYW49XFxcIlwiLmNvbmNhdChyb3dTcGFuLCBcIlxcXCJcIikgOiAnJztcclxuICAgICAgICB2YXIgY29sU3BhbkF0dHIgPSBjb2xTcGFuID8gXCIgY29sc3Bhbj1cXFwiXCIuY29uY2F0KGNvbFNwYW4sIFwiXFxcIlwiKSA6ICcnO1xyXG4gICAgICAgIHJldHVybiBcIjx0ZFwiLmNvbmNhdChyb3dTcGFuQXR0cikuY29uY2F0KGNvbFNwYW5BdHRyKS5jb25jYXQoYnVpbGRDb21tb25BdHRycyhub2RlKSwgXCI+XCIpLmNvbmNhdChzYW5pdGl6ZUhUTUwobmV4dChub2RlLmNoaWxkcmVuKSksIFwiPC90ZD5cIik7XHJcbiAgICB9LFxyXG4gICAgX2FbTm9kZVR5cGUkMS5CTE9DS19RVU9URV0gPSBmdW5jdGlvbiAobm9kZSwgbmV4dCkge1xyXG4gICAgICAgIHJldHVybiBcIjxibG9ja3F1b3RlXCIuY29uY2F0KGJ1aWxkQ29tbW9uQXR0cnMobm9kZSksIFwiPlwiKS5jb25jYXQoc2FuaXRpemVIVE1MKG5leHQobm9kZS5jaGlsZHJlbikpLCBcIjwvYmxvY2txdW90ZT5cIik7XHJcbiAgICB9LFxyXG4gICAgX2FbTm9kZVR5cGUkMS5DT0RFXSA9IGZ1bmN0aW9uIChub2RlLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIFwiPGNvZGVcIi5jb25jYXQoYnVpbGRDb21tb25BdHRycyhub2RlKSwgXCI+XCIpLmNvbmNhdChzYW5pdGl6ZUhUTUwobmV4dChub2RlLmNoaWxkcmVuKSksIFwiPC9jb2RlPlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVsncmVmZXJlbmNlJ10gPSBmdW5jdGlvbiAobm9kZSwgbmV4dCkge1xyXG4gICAgICAgIHZhciB0eXBlID0gZ2V0QXR0cihub2RlLCAndHlwZScpO1xyXG4gICAgICAgIHZhciBkaXNwbGF5VHlwZSA9IGdldEF0dHIobm9kZSwgJ2Rpc3BsYXktdHlwZScpO1xyXG4gICAgICAgIGlmICgodHlwZSA9PT0gJ2VudHJ5JyB8fCB0eXBlID09PSAnYXNzZXQnKSAmJiBkaXNwbGF5VHlwZSA9PT0gJ2xpbmsnKSB7XHJcbiAgICAgICAgICAgIHZhciBocmVmID0gZ2V0QXR0clN0cmluZyhub2RlLCAnaHJlZicpIHx8IGdldEF0dHJTdHJpbmcobm9kZSwgJ3VybCcpIHx8ICcnO1xyXG4gICAgICAgICAgICB2YXIgdGFyZ2V0ID0gZ2V0QXR0clN0cmluZyhub2RlLCAndGFyZ2V0Jyk7XHJcbiAgICAgICAgICAgIHZhciBhc3NldFVpZCA9IGdldEF0dHJTdHJpbmcobm9kZSwgJ2Fzc2V0LXVpZCcpO1xyXG4gICAgICAgICAgICB2YXIgYVRhZ0F0dHJzID0gYnVpbGRDb21tb25BdHRycyhub2RlKTtcclxuICAgICAgICAgICAgaWYgKGhyZWYpXHJcbiAgICAgICAgICAgICAgICBhVGFnQXR0cnMgKz0gXCIgaHJlZj1cXFwiXCIuY29uY2F0KGhyZWYsIFwiXFxcIlwiKTtcclxuICAgICAgICAgICAgaWYgKHRhcmdldCkge1xyXG4gICAgICAgICAgICAgICAgYVRhZ0F0dHJzICs9IFwiIHRhcmdldD1cXFwiXCIuY29uY2F0KHRhcmdldCwgXCJcXFwiXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0eXBlID09PSAnYXNzZXQnKSB7XHJcbiAgICAgICAgICAgICAgICBhVGFnQXR0cnMgKz0gXCIgdHlwZT1cXFwiYXNzZXRcXFwiIGNvbnRlbnQtdHlwZS11aWQ9XFxcInN5c19hc3NldHNcXFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoYXNzZXRVaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBhVGFnQXR0cnMgKz0gXCIgZGF0YS1zeXMtYXNzZXQtdWlkPVxcXCJcIi5jb25jYXQoYXNzZXRVaWQsIFwiXFxcIlwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGFUYWdBdHRycyArPSBcIiBzeXMtc3R5bGUtdHlwZT1cXFwiZG93bmxvYWRcXFwiXCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFwiPGFcIi5jb25jYXQoYVRhZ0F0dHJzLCBcIj5cIikuY29uY2F0KHNhbml0aXplSFRNTChuZXh0KG5vZGUuY2hpbGRyZW4pKSwgXCI8L2E+XCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZSA9PT0gJ2Fzc2V0Jykge1xyXG4gICAgICAgICAgICB2YXIgYXNzZXRMaW5rID0gZ2V0QXR0clN0cmluZyhub2RlLCAnYXNzZXQtbGluaycpO1xyXG4gICAgICAgICAgICB2YXIgc3JjID0gYXNzZXRMaW5rID8gZW5jb2RlVVJJKGFzc2V0TGluaykgOiAnJztcclxuICAgICAgICAgICAgdmFyIHJlZGFjdG9yQXR0cnMgPSBnZXRBdHRyKG5vZGUsICdyZWRhY3Rvci1hdHRyaWJ1dGVzJyk7XHJcbiAgICAgICAgICAgIHZhciBhbHQgPSByZWRhY3RvckF0dHJzID09PSBudWxsIHx8IHJlZGFjdG9yQXR0cnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlZGFjdG9yQXR0cnNbJ2FsdCddO1xyXG4gICAgICAgICAgICB2YXIgbGluayA9IGdldEF0dHJTdHJpbmcobm9kZSwgJ2xpbmsnKTtcclxuICAgICAgICAgICAgdmFyIHRhcmdldCA9IGdldEF0dHJTdHJpbmcobm9kZSwgJ3RhcmdldCcpIHx8IFwiXCI7XHJcbiAgICAgICAgICAgIHZhciBjYXB0aW9uID0gKHJlZGFjdG9yQXR0cnMgPT09IG51bGwgfHwgcmVkYWN0b3JBdHRycyA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVkYWN0b3JBdHRyc1snYXNzZXQtY2FwdGlvbiddKSB8fCBnZXRBdHRyU3RyaW5nKG5vZGUsICdhc3NldC1jYXB0aW9uJykgfHwgXCJcIjtcclxuICAgICAgICAgICAgdmFyIHN0eWxlID0gZ2V0QXR0clN0cmluZyhub2RlLCAnc3R5bGUnKTtcclxuICAgICAgICAgICAgdmFyIGFzc2V0VWlkID0gZ2V0QXR0clN0cmluZyhub2RlLCAnYXNzZXQtdWlkJyk7XHJcbiAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBnZXRBdHRyU3RyaW5nKG5vZGUsICdjbGFzcy1uYW1lJyk7XHJcbiAgICAgICAgICAgIHZhciBhc3NldFVpZEF0dHIgPSBhc3NldFVpZCA/IFwiIGFzc2V0X3VpZD1cXFwiXCIuY29uY2F0KGFzc2V0VWlkLCBcIlxcXCJcIikgOiAnJztcclxuICAgICAgICAgICAgdmFyIGNsYXNzQXR0ciA9IGNsYXNzTmFtZSA/IFwiIGNsYXNzPVxcXCJcIi5jb25jYXQoc2FuaXRpemVIVE1MKGNsYXNzTmFtZSksIFwiXFxcIlwiKSA6ICcnO1xyXG4gICAgICAgICAgICB2YXIgc3JjQXR0ciA9IHNyYyA/IFwiIHNyYz1cXFwiXCIuY29uY2F0KHNhbml0aXplSFRNTChzcmMpLCBcIlxcXCJcIikgOiAnJztcclxuICAgICAgICAgICAgdmFyIGFsdEF0dHIgPSBhbHQgPyBcIiBhbHQ9XFxcIlwiLmNvbmNhdChhbHQsIFwiXFxcIlwiKSA6ICcnO1xyXG4gICAgICAgICAgICB2YXIgdGFyZ2V0QXR0ciA9IHRhcmdldCA9PT0gXCJfYmxhbmtcIiA/IFwiIHRhcmdldD1cXFwiX2JsYW5rXFxcIlwiIDogJyc7XHJcbiAgICAgICAgICAgIHZhciBzdHlsZUF0dHIgPSBzdHlsZSA/IFwiIHN0eWxlPVxcXCJcIi5jb25jYXQoc3R5bGUsIFwiXFxcIlwiKSA6ICcnO1xyXG4gICAgICAgICAgICB2YXIgaW1hZ2VUYWcgPSBcIjxpbWdcIi5jb25jYXQoYXNzZXRVaWRBdHRyKS5jb25jYXQoY2xhc3NBdHRyKS5jb25jYXQoc3JjQXR0cikuY29uY2F0KGFsdEF0dHIpLmNvbmNhdCh0YXJnZXRBdHRyKS5jb25jYXQoc3R5bGVBdHRyLCBcIiAvPlwiKTtcclxuICAgICAgICAgICAgdmFyIHN0eWxlQXR0ckZpZyA9IHN0eWxlID8gXCIgc3R5bGU9XFxcIlwiLmNvbmNhdChzdHlsZSwgXCJcXFwiXCIpIDogJyc7XHJcbiAgICAgICAgICAgIHJldHVybiBcIjxmaWd1cmVcIi5jb25jYXQoc3R5bGVBdHRyRmlnLCBcIj5cIikgK1xyXG4gICAgICAgICAgICAgICAgKGxpbmsgPyBcIjxhIGhyZWY9XFxcIlwiLmNvbmNhdChsaW5rLCBcIlxcXCIgdGFyZ2V0PVxcXCJcIikuY29uY2F0KHRhcmdldCB8fCBcIlwiLCBcIlxcXCI+XCIpIDogXCJcIikgK1xyXG4gICAgICAgICAgICAgICAgaW1hZ2VUYWcgK1xyXG4gICAgICAgICAgICAgICAgKGxpbmsgPyBcIjwvYT5cIiA6IFwiXCIpICtcclxuICAgICAgICAgICAgICAgIChjYXB0aW9uID8gXCI8ZmlnY2FwdGlvbj5cIi5jb25jYXQoY2FwdGlvbiwgXCI8L2ZpZ2NhcHRpb24+XCIpIDogXCJcIikgK1xyXG4gICAgICAgICAgICAgICAgXCI8L2ZpZ3VyZT5cIjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFwiXCI7XHJcbiAgICB9LFxyXG4gICAgX2FbJ2RlZmF1bHQnXSA9IGZ1bmN0aW9uIChub2RlLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIHNhbml0aXplSFRNTChuZXh0KG5vZGUuY2hpbGRyZW4pKTtcclxuICAgIH0sXHJcbiAgICBfYVtNYXJrVHlwZSQxLkJPTERdID0gZnVuY3Rpb24gKHRleHQpIHtcclxuICAgICAgICByZXR1cm4gXCI8c3Ryb25nPlwiLmNvbmNhdChzYW5pdGl6ZUhUTUwodGV4dCksIFwiPC9zdHJvbmc+XCIpO1xyXG4gICAgfSxcclxuICAgIF9hW01hcmtUeXBlJDEuSVRBTElDXSA9IGZ1bmN0aW9uICh0ZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIFwiPGVtPlwiLmNvbmNhdChzYW5pdGl6ZUhUTUwodGV4dCksIFwiPC9lbT5cIik7XHJcbiAgICB9LFxyXG4gICAgX2FbTWFya1R5cGUkMS5VTkRFUkxJTkVdID0gZnVuY3Rpb24gKHRleHQpIHtcclxuICAgICAgICByZXR1cm4gXCI8dT5cIi5jb25jYXQoc2FuaXRpemVIVE1MKHRleHQpLCBcIjwvdT5cIik7XHJcbiAgICB9LFxyXG4gICAgX2FbTWFya1R5cGUkMS5TVFJJS0VfVEhST1VHSF0gPSBmdW5jdGlvbiAodGV4dCkge1xyXG4gICAgICAgIHJldHVybiBcIjxzdHJpa2U+XCIuY29uY2F0KHNhbml0aXplSFRNTCh0ZXh0KSwgXCI8L3N0cmlrZT5cIik7XHJcbiAgICB9LFxyXG4gICAgX2FbTWFya1R5cGUkMS5JTkxJTkVfQ09ERV0gPSBmdW5jdGlvbiAodGV4dCkge1xyXG4gICAgICAgIHJldHVybiBcIjxzcGFuIGRhdGEtdHlwZT0naW5saW5lQ29kZSc+XCIuY29uY2F0KHNhbml0aXplSFRNTCh0ZXh0KSwgXCI8L3NwYW4+XCIpO1xyXG4gICAgfSxcclxuICAgIF9hW01hcmtUeXBlJDEuU1VCU0NSSVBUXSA9IGZ1bmN0aW9uICh0ZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIFwiPHN1Yj5cIi5jb25jYXQoc2FuaXRpemVIVE1MKHRleHQpLCBcIjwvc3ViPlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVtNYXJrVHlwZSQxLlNVUEVSU0NSSVBUXSA9IGZ1bmN0aW9uICh0ZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIFwiPHN1cD5cIi5jb25jYXQoc2FuaXRpemVIVE1MKHRleHQpLCBcIjwvc3VwPlwiKTtcclxuICAgIH0sXHJcbiAgICBfYVtNYXJrVHlwZSQxLkJSRUFLXSA9IGZ1bmN0aW9uICh0ZXh0KSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGV4dCBpcyBvbmx5IG5ld2xpbmVzICh3aGljaCB3aWxsIGJlIGNvbnZlcnRlZCB0byA8YnIgLz4gYnkgc2FuaXRpemVIVE1MKVxyXG4gICAgICAgIC8vIElmIHNvLCBkb24ndCBhZGQgYW4gZXh0cmEgPGJyIC8+IHRvIGF2b2lkIGR1cGxpY2F0aW9uXHJcbiAgICAgICAgdmFyIG9ubHlOZXdsaW5lcyA9IC9eXFxuKyQvLnRlc3QodGV4dCk7XHJcbiAgICAgICAgaWYgKG9ubHlOZXdsaW5lcykge1xyXG4gICAgICAgICAgICByZXR1cm4gc2FuaXRpemVIVE1MKHRleHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gXCI8YnIgLz5cIi5jb25jYXQoc2FuaXRpemVIVE1MKHRleHQpKTtcclxuICAgIH0sXHJcbiAgICBfYVtNYXJrVHlwZSQxLkNMQVNTTkFNRV9PUl9JRF0gPSBmdW5jdGlvbiAodGV4dCwgY2xhc3NuYW1lLCBpZCkge1xyXG4gICAgICAgIHJldHVybiBcIjxzcGFuXCIuY29uY2F0KGNsYXNzbmFtZSA/IFwiIGNsYXNzPVxcXCJcIi5jb25jYXQoY2xhc3NuYW1lLCBcIlxcXCJcIikgOiBcIlwiKS5jb25jYXQoaWQgPyBcIiBpZD1cXFwiXCIuY29uY2F0KGlkLCBcIlxcXCJcIikgOiBcIlwiLCBcIj5cIikuY29uY2F0KHNhbml0aXplSFRNTCh0ZXh0KSwgXCI8L3NwYW4+XCIpO1xyXG4gICAgfSxcclxuICAgIF9hKTtcblxuZnVuY3Rpb24gZW51bWVyYXRlKGVudHJpZXMsIHByb2Nlc3MpIHtcclxuICAgIGZvciAodmFyIF9pID0gMCwgZW50cmllc18xID0gZW50cmllczsgX2kgPCBlbnRyaWVzXzEubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgdmFyIGVudHJ5ID0gZW50cmllc18xW19pXTtcclxuICAgICAgICBwcm9jZXNzKGVudHJ5KTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBlbnVtZXJhdGVDb250ZW50cyhjb250ZW50LCByZW5kZXJPcHRpb24sIHJlbmRlckVtYmVkKSB7XHJcbiAgICBpZiAoIShjb250ZW50IGluc3RhbmNlb2YgQXJyYXkpICYmIGNvbnRlbnQudHlwZSAhPT0gJ2RvYycpIHtcclxuICAgICAgICByZXR1cm4gY29udGVudDtcclxuICAgIH1cclxuICAgIGlmIChjb250ZW50IGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICB2YXIgcmVzdWx0XzEgPSBbXTtcclxuICAgICAgICBjb250ZW50LmZvckVhY2goZnVuY3Rpb24gKGRvYykge1xyXG4gICAgICAgICAgICByZXN1bHRfMS5wdXNoKGVudW1lcmF0ZUNvbnRlbnRzKGRvYywgcmVuZGVyT3B0aW9uLCByZW5kZXJFbWJlZCkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiByZXN1bHRfMTtcclxuICAgIH1cclxuICAgIHZhciBjb21tb25SZW5kZXJPcHRpb24gPSBfX2Fzc2lnbihfX2Fzc2lnbih7fSwgZGVmYXVsdE5vZGVPcHRpb24pLCByZW5kZXJPcHRpb24pO1xyXG4gICAgcmV0dXJuIG5vZGVDaGlsZHJlblRvSFRNTChjb250ZW50LmNoaWxkcmVuLCBjb21tb25SZW5kZXJPcHRpb24sIHJlbmRlckVtYmVkKTtcclxufVxyXG5mdW5jdGlvbiB0ZXh0Tm9kZVRvSFRNTChub2RlLCByZW5kZXJPcHRpb24pIHtcclxuICAgIHZhciB0ZXh0ID0gcmVwbGFjZUh0bWxFbnRpdGllcyhub2RlLnRleHQpO1xyXG4gICAgLy8gQ29udmVydCBuZXdsaW5lcyB0byA8YnIgLz4gdGFncyBpZiB0aGVyZSBhcmUgbm8gb3RoZXIgbWFya3NcclxuICAgIC8vIFRoaXMgZW5zdXJlcyBuZXdsaW5lcyBhcmUgYWx3YXlzIGhhbmRsZWQgY29uc2lzdGVudGx5XHJcbiAgICB2YXIgaGFzTWFya3MgPSBmYWxzZTtcclxuICAgIGlmIChub2RlLmNsYXNzbmFtZSB8fCBub2RlLmlkKSB7XHJcbiAgICAgICAgdGV4dCA9IHJlbmRlck9wdGlvbltNYXJrVHlwZSQxLkNMQVNTTkFNRV9PUl9JRF0odGV4dCwgbm9kZS5jbGFzc25hbWUsIG5vZGUuaWQpO1xyXG4gICAgICAgIGhhc01hcmtzID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIGlmIChub2RlLmJyZWFrKSB7XHJcbiAgICAgICAgdGV4dCA9IHJlbmRlck9wdGlvbltNYXJrVHlwZSQxLkJSRUFLXSh0ZXh0KTtcclxuICAgICAgICBoYXNNYXJrcyA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBpZiAobm9kZS5zdXBlcnNjcmlwdCkge1xyXG4gICAgICAgIHRleHQgPSByZW5kZXJPcHRpb25bTWFya1R5cGUkMS5TVVBFUlNDUklQVF0odGV4dCk7XHJcbiAgICAgICAgaGFzTWFya3MgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKG5vZGUuc3Vic2NyaXB0KSB7XHJcbiAgICAgICAgdGV4dCA9IHJlbmRlck9wdGlvbltNYXJrVHlwZSQxLlNVQlNDUklQVF0odGV4dCk7XHJcbiAgICAgICAgaGFzTWFya3MgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKG5vZGUuaW5saW5lQ29kZSkge1xyXG4gICAgICAgIHRleHQgPSByZW5kZXJPcHRpb25bTWFya1R5cGUkMS5JTkxJTkVfQ09ERV0odGV4dCk7XHJcbiAgICAgICAgaGFzTWFya3MgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKG5vZGUuc3RyaWtldGhyb3VnaCkge1xyXG4gICAgICAgIHRleHQgPSByZW5kZXJPcHRpb25bTWFya1R5cGUkMS5TVFJJS0VfVEhST1VHSF0odGV4dCk7XHJcbiAgICAgICAgaGFzTWFya3MgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKG5vZGUudW5kZXJsaW5lKSB7XHJcbiAgICAgICAgdGV4dCA9IHJlbmRlck9wdGlvbltNYXJrVHlwZSQxLlVOREVSTElORV0odGV4dCk7XHJcbiAgICAgICAgaGFzTWFya3MgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKG5vZGUuaXRhbGljKSB7XHJcbiAgICAgICAgdGV4dCA9IHJlbmRlck9wdGlvbltNYXJrVHlwZSQxLklUQUxJQ10odGV4dCk7XHJcbiAgICAgICAgaGFzTWFya3MgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgaWYgKG5vZGUuYm9sZCkge1xyXG4gICAgICAgIHRleHQgPSByZW5kZXJPcHRpb25bTWFya1R5cGUkMS5CT0xEXSh0ZXh0KTtcclxuICAgICAgICBoYXNNYXJrcyA9IHRydWU7XHJcbiAgICB9XHJcbiAgICAvLyBJZiBubyBtYXJrcyB3ZXJlIGFwcGxpZWQsIGJ1dCB0ZXh0IGNvbnRhaW5zIG5ld2xpbmVzLCBjb252ZXJ0IHRoZW0gdG8gPGJyIC8+XHJcbiAgICBpZiAoIWhhc01hcmtzICYmIHRleHQuaW5jbHVkZXMoJ1xcbicpKSB7XHJcbiAgICAgICAgdGV4dCA9IHRleHQucmVwbGFjZSgvXFxuL2csICc8YnIgLz4nKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0ZXh0O1xyXG59XHJcbmZ1bmN0aW9uIHJlZmVyZW5jZVRvSFRNTChub2RlLCByZW5kZXJPcHRpb24sIHJlbmRlckVtYmVkKSB7XHJcbiAgICBmdW5jdGlvbiBzZW5kVG9SZW5kZXJPcHRpb24ocmVmZXJlbmNlTm9kZSkge1xyXG4gICAgICAgIHZhciBuZXh0ID0gZnVuY3Rpb24gKG5vZGVzKSB7IHJldHVybiBub2RlQ2hpbGRyZW5Ub0hUTUwobm9kZXMsIHJlbmRlck9wdGlvbiwgcmVuZGVyRW1iZWQpOyB9O1xyXG4gICAgICAgIHJldHVybiByZW5kZXJPcHRpb25bcmVmZXJlbmNlTm9kZS50eXBlXShyZWZlcmVuY2VOb2RlLCBuZXh0KTtcclxuICAgIH1cclxuICAgIGlmICgobm9kZS5hdHRycy50eXBlID09PSAnZW50cnknIHx8IG5vZGUuYXR0cnMudHlwZSA9PT0gJ2Fzc2V0JykgJiYgbm9kZS5hdHRyc1snZGlzcGxheS10eXBlJ10gPT09ICdsaW5rJykge1xyXG4gICAgICAgIHZhciBlbnRyeVRleHQgPSBub2RlLmNoaWxkcmVuID8gbm9kZUNoaWxkcmVuVG9IVE1MKG5vZGUuY2hpbGRyZW4sIHJlbmRlck9wdGlvbiwgcmVuZGVyRW1iZWQpIDogJyc7XHJcbiAgICAgICAgaWYgKHJlbmRlck9wdGlvbltub2RlLnR5cGVdICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHNlbmRUb1JlbmRlck9wdGlvbihub2RlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGhyZWYgPSBub2RlLmF0dHJzLmhyZWYgfHwgbm9kZS5hdHRycy51cmw7XHJcbiAgICAgICAgdmFyIGFUYWdBdHRycyA9IFwiXCIuY29uY2F0KG5vZGUuYXR0cnMuc3R5bGUgPyBcIiBzdHlsZT1cXFwiXCIuY29uY2F0KG5vZGUuYXR0cnMuc3R5bGUsIFwiXFxcIlwiKSA6IFwiXCIpLmNvbmNhdChub2RlLmF0dHJzWydjbGFzcy1uYW1lJ10gPyBcIiBjbGFzcz1cXFwiXCIuY29uY2F0KG5vZGUuYXR0cnNbJ2NsYXNzLW5hbWUnXSwgXCJcXFwiXCIpIDogXCJcIikuY29uY2F0KG5vZGUuYXR0cnMuaWQgPyBcIiBpZD1cXFwiXCIuY29uY2F0KG5vZGUuYXR0cnMuaWQsIFwiXFxcIlwiKSA6IFwiXCIpLmNvbmNhdChocmVmID8gXCIgaHJlZj1cXFwiXCIuY29uY2F0KGhyZWYsIFwiXFxcIlwiKSA6IFwiXCIpO1xyXG4gICAgICAgIGlmIChub2RlLmF0dHJzLnRhcmdldCkge1xyXG4gICAgICAgICAgICBhVGFnQXR0cnMgKz0gXCIgdGFyZ2V0PVxcXCJcIi5jb25jYXQobm9kZS5hdHRycy50YXJnZXQsIFwiXFxcIlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5vZGUuYXR0cnMudHlwZSA9PSAnYXNzZXQnKSB7XHJcbiAgICAgICAgICAgIGFUYWdBdHRycyArPSBcIiB0eXBlPVxcXCJhc3NldFxcXCIgY29udGVudC10eXBlLXVpZD1cXFwic3lzX2Fzc2V0c1xcXCIgXCIuY29uY2F0KG5vZGUuYXR0cnNbJ2Fzc2V0LXVpZCddID8gXCJkYXRhLXN5cy1hc3NldC11aWQ9XFxcIlwiLmNvbmNhdChub2RlLmF0dHJzWydhc3NldC11aWQnXSwgXCJcXFwiXCIpIDogXCJcIiwgXCIgc3lzLXN0eWxlLXR5cGU9XFxcImRvd25sb2FkXFxcIlwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGFUYWcgPSBcIjxhXCIuY29uY2F0KGFUYWdBdHRycywgXCI+XCIpLmNvbmNhdChlbnRyeVRleHQsIFwiPC9hPlwiKTtcclxuICAgICAgICByZXR1cm4gYVRhZztcclxuICAgIH1cclxuICAgIGlmICghcmVuZGVyRW1iZWQgJiYgcmVuZGVyT3B0aW9uW25vZGUudHlwZV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHJldHVybiBzZW5kVG9SZW5kZXJPcHRpb24obm9kZSk7XHJcbiAgICB9XHJcbiAgICBpZiAoIXJlbmRlckVtYmVkKSB7XHJcbiAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgfVxyXG4gICAgdmFyIG1ldGFkYXRhID0gbm9kZVRvTWV0YWRhdGEobm9kZS5hdHRycywgKG5vZGUuY2hpbGRyZW4gJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwID8gbm9kZS5jaGlsZHJlblswXSA6IHt9KSk7XHJcbiAgICB2YXIgaXRlbSA9IHJlbmRlckVtYmVkKG1ldGFkYXRhKTtcclxuICAgIGlmICghaXRlbSAmJiByZW5kZXJPcHRpb25bbm9kZS50eXBlXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgcmV0dXJuIHNlbmRUb1JlbmRlck9wdGlvbihub2RlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBmaW5kUmVuZGVyU3RyaW5nKGl0ZW0sIG1ldGFkYXRhLCByZW5kZXJPcHRpb24pO1xyXG59XHJcbmZ1bmN0aW9uIG5vZGVDaGlsZHJlblRvSFRNTChub2RlcywgcmVuZGVyT3B0aW9uLCByZW5kZXJFbWJlZCkge1xyXG4gICAgcmV0dXJuIG5vZGVzLm1hcChmdW5jdGlvbiAobm9kZSkgeyByZXR1cm4gbm9kZVRvSFRNTChub2RlLCByZW5kZXJPcHRpb24sIHJlbmRlckVtYmVkKTsgfSkuam9pbignJyk7XHJcbn1cclxuZnVuY3Rpb24gc3R5bGVPYmplY3RUb1N0cmluZyhzdHlsZU9iaikge1xyXG4gICAgaWYgKCFzdHlsZU9iailcclxuICAgICAgICByZXR1cm4gJyc7XHJcbiAgICBpZiAodHlwZW9mIHN0eWxlT2JqID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHJldHVybiBzdHlsZU9iajtcclxuICAgIH1cclxuICAgIHZhciBzdHlsZVN0cmluZyA9ICcnO1xyXG4gICAgZm9yICh2YXIga2V5IGluIHN0eWxlT2JqKSB7XHJcbiAgICAgICAgaWYgKHN0eWxlT2JqLmhhc093blByb3BlcnR5KGtleSkpIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gc3R5bGVPYmpba2V5XTtcclxuICAgICAgICAgICAgc3R5bGVTdHJpbmcgKz0gXCJcIi5jb25jYXQoa2V5LCBcIjpcIikuY29uY2F0KHZhbHVlLCBcIjtcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN0eWxlU3RyaW5nO1xyXG59XHJcbmZ1bmN0aW9uIG5vZGVUb0hUTUwobm9kZSwgcmVuZGVyT3B0aW9uLCByZW5kZXJFbWJlZCkge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgaWYgKChfYSA9IG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZS5hdHRycykgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN0eWxlKSB7XHJcbiAgICAgICAgbm9kZS5hdHRycy5zdHlsZSA9IHN0eWxlT2JqZWN0VG9TdHJpbmcobm9kZS5hdHRycy5zdHlsZSk7XHJcbiAgICB9XHJcbiAgICBpZiAoIW5vZGUudHlwZSkge1xyXG4gICAgICAgIHJldHVybiB0ZXh0Tm9kZVRvSFRNTChub2RlLCByZW5kZXJPcHRpb24pO1xyXG4gICAgfVxyXG4gICAgZWxzZSBpZiAobm9kZS50eXBlID09PSAncmVmZXJlbmNlJykge1xyXG4gICAgICAgIHJldHVybiByZWZlcmVuY2VUb0hUTUwobm9kZSwgcmVuZGVyT3B0aW9uLCByZW5kZXJFbWJlZCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICB2YXIgbmV4dCA9IGZ1bmN0aW9uIChub2RlcykgeyByZXR1cm4gbm9kZUNoaWxkcmVuVG9IVE1MKG5vZGVzLCByZW5kZXJPcHRpb24sIHJlbmRlckVtYmVkKTsgfTtcclxuICAgICAgICBpZiAocmVuZGVyT3B0aW9uW25vZGUudHlwZV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyT3B0aW9uW25vZGUudHlwZV0obm9kZSwgbmV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVuZGVyT3B0aW9uLmRlZmF1bHQobm9kZSwgbmV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XG5cbmZ1bmN0aW9uIGpzb25Ub0hUTUwkMShvcHRpb24pIHtcclxuICAgIGlmIChvcHRpb24uZW50cnkgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgIGVudW1lcmF0ZShvcHRpb24uZW50cnksIGZ1bmN0aW9uIChlbnRyeSkge1xyXG4gICAgICAgICAgICBqc29uVG9IVE1MJDEoeyBlbnRyeTogZW50cnksIHBhdGhzOiBvcHRpb24ucGF0aHMsIHJlbmRlck9wdGlvbjogb3B0aW9uLnJlbmRlck9wdGlvbiB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGVudW1lcmF0ZUtleXMkMSh7XHJcbiAgICAgICAgICAgIGVudHJ5OiBvcHRpb24uZW50cnksXHJcbiAgICAgICAgICAgIHBhdGhzOiBvcHRpb24ucGF0aHMsXHJcbiAgICAgICAgICAgIHJlbmRlck9wdGlvbjogb3B0aW9uLnJlbmRlck9wdGlvbixcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBlbnVtZXJhdGVLZXlzJDEob3B0aW9uKSB7XHJcbiAgICBmb3IgKHZhciBfaSA9IDAsIF9hID0gb3B0aW9uLnBhdGhzOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgIHZhciBrZXkgPSBfYVtfaV07XHJcbiAgICAgICAgZmluZFJlbmRlckNvbnRlbnQoa2V5LCBvcHRpb24uZW50cnksIChmdW5jdGlvbiAoY29udGVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZW51bWVyYXRlQ29udGVudHMoY29udGVudCwgb3B0aW9uLnJlbmRlck9wdGlvbiwgZnVuY3Rpb24gKG1ldGFkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmluZEVtYmVkZGVkSXRlbXMobWV0YWRhdGEsIG9wdGlvbi5lbnRyeSlbMF07XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pKTtcclxuICAgIH1cclxufVxuXG5mdW5jdGlvbiBqc29uVG9IVE1MKG9wdGlvbikge1xyXG4gICAgaWYgKG9wdGlvbi5lbnRyeSBpbnN0YW5jZW9mIEFycmF5KSB7XHJcbiAgICAgICAgZW51bWVyYXRlKG9wdGlvbi5lbnRyeSwgZnVuY3Rpb24gKGVudHJ5KSB7XHJcbiAgICAgICAgICAgIGpzb25Ub0hUTUwoeyBlbnRyeTogZW50cnksIHBhdGhzOiBvcHRpb24ucGF0aHMsIHJlbmRlck9wdGlvbjogb3B0aW9uLnJlbmRlck9wdGlvbiB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIGVudW1lcmF0ZUtleXMoe1xyXG4gICAgICAgICAgICBlbnRyeTogb3B0aW9uLmVudHJ5LFxyXG4gICAgICAgICAgICBwYXRoczogb3B0aW9uLnBhdGhzLFxyXG4gICAgICAgICAgICByZW5kZXJPcHRpb246IG9wdGlvbi5yZW5kZXJPcHRpb24sXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZW51bWVyYXRlS2V5cyhvcHRpb24pIHtcclxuICAgIGZvciAodmFyIF9pID0gMCwgX2EgPSBvcHRpb24ucGF0aHM7IF9pIDwgX2EubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgdmFyIGtleSA9IF9hW19pXTtcclxuICAgICAgICBmaW5kUmVuZGVyQ29udGVudChrZXksIG9wdGlvbi5lbnRyeSwgKGZ1bmN0aW9uIChjb250ZW50KSB7XHJcbiAgICAgICAgICAgIGlmIChjb250ZW50ICYmIGNvbnRlbnQuanNvbikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVkZ2VzID0gY29udGVudC5lbWJlZGRlZF9pdGVtc0Nvbm5lY3Rpb24gPyBjb250ZW50LmVtYmVkZGVkX2l0ZW1zQ29ubmVjdGlvbi5lZGdlcyA6IFtdO1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zXzEgPSBPYmplY3QudmFsdWVzKGVkZ2VzIHx8IFtdKS5yZWR1Y2UoZnVuY3Rpb24gKGFjY3VtdWxhdG9yLCB2YWx1ZSkgeyByZXR1cm4gYWNjdW11bGF0b3IuY29uY2F0KHZhbHVlLm5vZGUpOyB9LCBbXSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZW51bWVyYXRlQ29udGVudHMoY29udGVudC5qc29uLCBvcHRpb24ucmVuZGVyT3B0aW9uLCBmdW5jdGlvbiAobWV0YWRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmluZEdRTEVtYmVkZGVkSXRlbXMobWV0YWRhdGEsIGl0ZW1zXzEpWzBdO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGNvbnRlbnQ7XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfVxyXG59XHJcbnZhciBHUUwgPSB7XHJcbiAgICBqc29uVG9IVE1MOiBqc29uVG9IVE1MXHJcbn07XG5cbmZ1bmN0aW9uIGFkZFRhZ3MoZW50cnksIGNvbnRlbnRUeXBlVWlkLCB0YWdzQXNPYmplY3QsIGxvY2FsZSkge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgaWYgKGxvY2FsZSA9PT0gdm9pZCAwKSB7IGxvY2FsZSA9ICdlbi11cyc7IH1cclxuICAgIGlmIChlbnRyeSkge1xyXG4gICAgICAgIC8vIGhhbmRsZSBjYXNlIHNlbnN0aXZpdHkgZm9yIGNvbnRlbnRUeXBlVWlkIGFuZCBsb2NhbGVcclxuICAgICAgICBjb250ZW50VHlwZVVpZCA9IGNvbnRlbnRUeXBlVWlkLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgbG9jYWxlID0gbG9jYWxlLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgdmFyIGFwcGxpZWRWYXJpYW50cyA9IGVudHJ5Ll9hcHBsaWVkX3ZhcmlhbnRzIHx8ICgoX2EgPSBlbnRyeSA9PT0gbnVsbCB8fCBlbnRyeSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZW50cnkuc3lzdGVtKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuYXBwbGllZF92YXJpYW50cykgfHwgbnVsbDtcclxuICAgICAgICBlbnRyeS4kID0gZ2V0VGFnKGVudHJ5LCBcIlwiLmNvbmNhdChjb250ZW50VHlwZVVpZCwgXCIuXCIpLmNvbmNhdChlbnRyeS51aWQsIFwiLlwiKS5jb25jYXQobG9jYWxlKSwgdGFnc0FzT2JqZWN0LCBsb2NhbGUsIHsgX2FwcGxpZWRfdmFyaWFudHM6IGFwcGxpZWRWYXJpYW50cywgc2hvdWxkQXBwbHlWYXJpYW50OiAhIWFwcGxpZWRWYXJpYW50cywgbWV0YUtleTogJycgfSk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZ2V0VGFnKGNvbnRlbnQsIHByZWZpeCwgdGFnc0FzT2JqZWN0LCBsb2NhbGUsIGFwcGxpZWRWYXJpYW50cykge1xyXG4gICAgdmFyIHRhZ3MgPSB7fTtcclxuICAgIGFwcGxpZWRWYXJpYW50cy5tZXRhS2V5OyB2YXIgc2hvdWxkQXBwbHlWYXJpYW50ID0gYXBwbGllZFZhcmlhbnRzLnNob3VsZEFwcGx5VmFyaWFudCwgX2FwcGxpZWRfdmFyaWFudHMgPSBhcHBsaWVkVmFyaWFudHMuX2FwcGxpZWRfdmFyaWFudHM7XHJcbiAgICBPYmplY3QuZW50cmllcyhjb250ZW50KS5mb3JFYWNoKGZ1bmN0aW9uIChfYSkge1xyXG4gICAgICAgIHZhciBrZXkgPSBfYVswXSwgdmFsdWUgPSBfYVsxXTtcclxuICAgICAgICBpZiAoa2V5ID09PSAnJCcpXHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB2YXIgbWV0YVVJRCA9IHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgIT09IG51bGwgJiYgdmFsdWUuX21ldGFkYXRhICYmIHZhbHVlLl9tZXRhZGF0YS51aWQgPyB2YWx1ZS5fbWV0YWRhdGEudWlkIDogJyc7XHJcbiAgICAgICAgdmFyIHVwZGF0ZWRNZXRha2V5ID0gYXBwbGllZFZhcmlhbnRzLnNob3VsZEFwcGx5VmFyaWFudCA/IFwiXCIuY29uY2F0KGFwcGxpZWRWYXJpYW50cy5tZXRhS2V5ID8gYXBwbGllZFZhcmlhbnRzLm1ldGFLZXkgKyAnLicgOiAnJykuY29uY2F0KGtleSkgOiAnJztcclxuICAgICAgICBpZiAobWV0YVVJRCAmJiB1cGRhdGVkTWV0YWtleSlcclxuICAgICAgICAgICAgdXBkYXRlZE1ldGFrZXkgPSB1cGRhdGVkTWV0YWtleSArICcuJyArIG1ldGFVSUQ7XHJcbiAgICAgICAgc3dpdGNoICh0eXBlb2YgdmFsdWUpIHtcclxuICAgICAgICAgICAgY2FzZSBcIm9iamVjdFwiOlxyXG4gICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUuZm9yRWFjaChmdW5jdGlvbiAob2JqLCBpbmRleCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgX2E7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvYmogPT09IG51bGwgfHwgb2JqID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGRLZXkgPSBcIlwiLmNvbmNhdChrZXksIFwiX19cIikuY29uY2F0KGluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudEtleSA9IFwiXCIuY29uY2F0KGtleSwgXCJfX3BhcmVudFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWV0YVVJRCA9IHZhbHVlICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgb2JqICE9PSBudWxsICYmIG9iai5fbWV0YWRhdGEgJiYgb2JqLl9tZXRhZGF0YS51aWQgPyBvYmouX21ldGFkYXRhLnVpZCA6ICcnO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVkTWV0YWtleSA9IGFwcGxpZWRWYXJpYW50cy5zaG91bGRBcHBseVZhcmlhbnQgPyBcIlwiLmNvbmNhdChhcHBsaWVkVmFyaWFudHMubWV0YUtleSA/IGFwcGxpZWRWYXJpYW50cy5tZXRhS2V5ICsgJy4nIDogJycpLmNvbmNhdChrZXkpIDogJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtZXRhVUlEICYmIHVwZGF0ZWRNZXRha2V5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlZE1ldGFrZXkgPSB1cGRhdGVkTWV0YWtleSArICcuJyArIG1ldGFVSUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBJbmRleGVzIG9mIGFycmF5IGFyZSBoYW5kbGVkIGhlcmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiAgXCJhcnJheVwiOiBbXCJoZWxsb1wiLCBcIndvcmxkXCJdLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiAgXCIkXCI6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICogICAgICBcImFycmF5XCI6IHtcImRhdGEtY3NscFwiOiBcImNvbnRlbnRfdHlwZV91aWQuZW50cnlfdWlkLmxvY2FsZS5hcnJheVwifVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiAgICAgIFwiYXJyYXlfXzBcIjoge1wiZGF0YS1jc2xwXCI6IFwiY29udGVudF90eXBlX3VpZC5lbnRyeV91aWQubG9jYWxlLmFycmF5LjBcIn1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICogICAgICBcImFycmF5X18xXCI6IHtcImRhdGEtY3NscFwiOiBcImNvbnRlbnRfdHlwZV91aWQuZW50cnlfdWlkLmxvY2FsZS5hcnJheS4xXCJ9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAqICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAqIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbY2hpbGRLZXldID0gZ2V0VGFnc1ZhbHVlKFwiXCIuY29uY2F0KHByZWZpeCwgXCIuXCIpLmNvbmNhdChrZXksIFwiLlwiKS5jb25jYXQoaW5kZXgpLCB0YWdzQXNPYmplY3QsIHsgX2FwcGxpZWRfdmFyaWFudHM6IF9hcHBsaWVkX3ZhcmlhbnRzLCBzaG91bGRBcHBseVZhcmlhbnQ6IHNob3VsZEFwcGx5VmFyaWFudCwgbWV0YUtleTogdXBkYXRlZE1ldGFrZXkgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhZ3NbcGFyZW50S2V5XSA9IGdldFBhcmVudFRhZ3NWYWx1ZShcIlwiLmNvbmNhdChwcmVmaXgsIFwiLlwiKS5jb25jYXQoa2V5KSwgdGFnc0FzT2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmogIT09ICd1bmRlZmluZWQnICYmIG9iaiAhPT0gbnVsbCAmJiBvYmouX2NvbnRlbnRfdHlwZV91aWQgIT09IHVuZGVmaW5lZCAmJiBvYmoudWlkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICogUmVmZXJlbmNlcyBhcmUgaGFuZGxlZCBoZXJlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgXCJyZWZlcmVuY2VcIjogW3tcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICAgICAgXCJ0aXRsZVwiOiBcInRpdGxlXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgICAgIFwidWlkXCI6IFwicmVmX3VpZFwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICogICAgICBcIl9jb250ZW50X3R5cGVfdWlkXCI6IFwicmVmX2NvbnRlbnRfdHlwZV91aWRcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICAgICBcIiRcIjoge1widGl0bGVcIjoge1wiZGF0YS1jc2xwXCI6IFwicmVmX2NvbnRlbnRfdHlwZV91aWQucmVmX3VpZC5sb2NhbGUudGl0bGVcIn19XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgfV1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0FwcGxpZWRWYXJpYW50cyA9IG9iai5fYXBwbGllZF92YXJpYW50cyB8fCAoKF9hID0gb2JqID09PSBudWxsIHx8IG9iaiA9PT0gdm9pZCAwID8gdm9pZCAwIDogb2JqLnN5c3RlbSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmFwcGxpZWRfdmFyaWFudHMpIHx8IG51bGw7IC8vY2hlY2sgZm9yIF9hcHBsaWVkX3ZhcmlhbnRzIGluIHRoZSByZWZlcmVuY2Ugb2JqZWN0IG9ubHkgcmV0dXJuIG51bGwgaWYgbm90IHByZXNlbnQgLCBkbyBub3QgY2hlY2sgaW4gdGhlIHBhcmVudCBvYmplY3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3U2hvdWxkQXBwbHlWYXJpYW50ID0gISFuZXdBcHBsaWVkVmFyaWFudHM7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZVtpbmRleF0uJCA9IGdldFRhZyhvYmosIFwiXCIuY29uY2F0KG9iai5fY29udGVudF90eXBlX3VpZCwgXCIuXCIpLmNvbmNhdChvYmoudWlkLCBcIi5cIikuY29uY2F0KG9iai5sb2NhbGUgfHwgbG9jYWxlKSwgdGFnc0FzT2JqZWN0LCBsb2NhbGUsIHsgX2FwcGxpZWRfdmFyaWFudHM6IG5ld0FwcGxpZWRWYXJpYW50cywgc2hvdWxkQXBwbHlWYXJpYW50OiBuZXdTaG91bGRBcHBseVZhcmlhbnQsIG1ldGFLZXk6IFwiXCIgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIG9iaiA9PT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLyoqXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiBPYmplY3RzIGluc2lkZSBBcnJheSBsaWtlIG1vZHVsYXIgYmxvY2tzIGFyZSBoYW5kbGVkIGhlcmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICBcImFycmF5XCI6IFt7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKiAgICBcInRpdGxlXCI6IFwidGl0bGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICAgIFwiJFwiOiB7XCJ0aXRsZVwiOiB7XCJkYXRhLWNzbHBcIjogXCJjb250ZW50X3R5cGVfdWlkLmVudHJ5X3VpZC5sb2NhbGUuYXJyYXkuMC50aXRsZVwifX1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqICB9XVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICogfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvYmouJCA9IGdldFRhZyhvYmosIFwiXCIuY29uY2F0KHByZWZpeCwgXCIuXCIpLmNvbmNhdChrZXksIFwiLlwiKS5jb25jYXQoaW5kZXgpLCB0YWdzQXNPYmplY3QsIGxvY2FsZSwgeyBfYXBwbGllZF92YXJpYW50czogX2FwcGxpZWRfdmFyaWFudHMsIHNob3VsZEFwcGx5VmFyaWFudDogc2hvdWxkQXBwbHlWYXJpYW50LCBtZXRhS2V5OiB1cGRhdGVkTWV0YWtleSB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiBPYmplY3RzIGFyZSBoYW5kbGVkIGhlcmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiAgXCJvYmplY3RcIjoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiAgICAgIFwidGl0bGVcIjogXCJ0aXRsZVwiLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiAgICAgIFwiJFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAqICAgICAgICAgIFwidGl0bGVcIjoge1wiZGF0YS1jc2xwXCI6IFwiY29udGVudF90eXBlX3VpZC5lbnRyeV91aWQubG9jYWxlLm9iamVjdC50aXRsZVwifVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgKiAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICogIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAqIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlLiQgPSBnZXRUYWcodmFsdWUsIFwiXCIuY29uY2F0KHByZWZpeCwgXCIuXCIpLmNvbmNhdChrZXkpLCB0YWdzQXNPYmplY3QsIGxvY2FsZSwgeyBfYXBwbGllZF92YXJpYW50czogX2FwcGxpZWRfdmFyaWFudHMsIHNob3VsZEFwcGx5VmFyaWFudDogc2hvdWxkQXBwbHlWYXJpYW50LCBtZXRhS2V5OiB1cGRhdGVkTWV0YWtleSB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICAgICAqIHtcclxuICAgICAgICAgICAgICAgICAqICBcIm9iamVjdFwiOiB7XHJcbiAgICAgICAgICAgICAgICAgKiAgICAgIFwidGl0bGVcIjogXCJ0aXRsZVwiLFxyXG4gICAgICAgICAgICAgICAgICogIH0sXHJcbiAgICAgICAgICAgICAgICAgKiAgXCJhcnJheVwiOiBbXCJoZWxsb1wiLCBcIndvcmxkXCJdXHJcbiAgICAgICAgICAgICAgICAgKiAgXCIkXCI6IHtcclxuICAgICAgICAgICAgICAgICAqICAgICAgXCJvYmplY3RcIjoge1wiZGF0YS1jc2xwXCI6IFwiY29udGVudF90eXBlX3VpZC5lbnRyeV91aWQubG9jYWxlLm9iamVjdFwifSxcclxuICAgICAgICAgICAgICAgICAqICAgICAgXCJhcnJheVwiOiB7XCJkYXRhLWNzbHBcIjogXCJjb250ZW50X3R5cGVfdWlkLmVudHJ5X3VpZC5sb2NhbGUuYXJyYXlcIn1cclxuICAgICAgICAgICAgICAgICAqICB9XHJcbiAgICAgICAgICAgICAgICAgKiB9XHJcbiAgICAgICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgICAgIHRhZ3Nba2V5XSA9IGdldFRhZ3NWYWx1ZShcIlwiLmNvbmNhdChwcmVmaXgsIFwiLlwiKS5jb25jYXQoa2V5KSwgdGFnc0FzT2JqZWN0LCB7IF9hcHBsaWVkX3ZhcmlhbnRzOiBfYXBwbGllZF92YXJpYW50cywgc2hvdWxkQXBwbHlWYXJpYW50OiBzaG91bGRBcHBseVZhcmlhbnQsIG1ldGFLZXk6IHVwZGF0ZWRNZXRha2V5IH0pO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICAgICAqIEFsbCBwcmltaXRpdmUgdmFsdWVzIGFyZSBoYW5kbGVkIGhlcmVcclxuICAgICAgICAgICAgICAgICAqIHtcclxuICAgICAgICAgICAgICAgICAqICBcInRpdGxlXCI6IFwidGl0bGVcIixcclxuICAgICAgICAgICAgICAgICAqICBcIiRcIjoge3RpdGxlOiB7XCJkYXRhLWNzbHBcIjogXCJjb250ZW50X3R5cGVfdWlkLmVudHJ5X3VpZC5sb2NhbGUudGl0bGVcIn19XHJcbiAgICAgICAgICAgICAgICAgKiB9XHJcbiAgICAgICAgICAgICAgICAgKi9cclxuICAgICAgICAgICAgICAgIHRhZ3Nba2V5XSA9IGdldFRhZ3NWYWx1ZShcIlwiLmNvbmNhdChwcmVmaXgsIFwiLlwiKS5jb25jYXQoa2V5KSwgdGFnc0FzT2JqZWN0LCB7IF9hcHBsaWVkX3ZhcmlhbnRzOiBfYXBwbGllZF92YXJpYW50cywgc2hvdWxkQXBwbHlWYXJpYW50OiBzaG91bGRBcHBseVZhcmlhbnQsIG1ldGFLZXk6IHVwZGF0ZWRNZXRha2V5IH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIHRhZ3M7XHJcbn1cclxuZnVuY3Rpb24gZ2V0VGFnc1ZhbHVlKGRhdGFWYWx1ZSwgdGFnc0FzT2JqZWN0LCBhcHBsaWVkVmFyaWFudHMpIHtcclxuICAgIGlmIChhcHBsaWVkVmFyaWFudHMuc2hvdWxkQXBwbHlWYXJpYW50ICYmIGFwcGxpZWRWYXJpYW50cy5fYXBwbGllZF92YXJpYW50cykge1xyXG4gICAgICAgIHZhciBpc0ZpZWxkVmFyaWFudGlzZWQgPSBhcHBsaWVkVmFyaWFudHMuX2FwcGxpZWRfdmFyaWFudHNbYXBwbGllZFZhcmlhbnRzLm1ldGFLZXldO1xyXG4gICAgICAgIGlmIChpc0ZpZWxkVmFyaWFudGlzZWQpIHtcclxuICAgICAgICAgICAgdmFyIHZhcmlhbnQgPSBhcHBsaWVkVmFyaWFudHMuX2FwcGxpZWRfdmFyaWFudHNbYXBwbGllZFZhcmlhbnRzLm1ldGFLZXldO1xyXG4gICAgICAgICAgICAvLyBBZGRpbmcgdjIgcHJlZml4IHRvIHRoZSBjc2xwIHRhZy4gTmV3IGNzbHAgdGFncyBhcmUgaW4gdjIgZm9ybWF0LiBleDogdjI6Y29udGVudF90eXBlX3VpZC5lbnRyeV91aWQubG9jYWxlLnRpdGxlXHJcbiAgICAgICAgICAgIHZhciBuZXdEYXRhVmFsdWVBcnJheSA9ICgndjI6JyArIGRhdGFWYWx1ZSkuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgbmV3RGF0YVZhbHVlQXJyYXlbMV0gPSBuZXdEYXRhVmFsdWVBcnJheVsxXSArICdfJyArIHZhcmlhbnQ7XHJcbiAgICAgICAgICAgIGRhdGFWYWx1ZSA9IG5ld0RhdGFWYWx1ZUFycmF5LmpvaW4oJy4nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBwYXJlbnRWYXJpYW50aXNlZFBhdGggPSBnZXRQYXJlbnRWYXJpYW50aXNlZFBhdGgoYXBwbGllZFZhcmlhbnRzKTtcclxuICAgICAgICAgICAgaWYgKHBhcmVudFZhcmlhbnRpc2VkUGF0aCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHZhcmlhbnQgPSBhcHBsaWVkVmFyaWFudHMuX2FwcGxpZWRfdmFyaWFudHNbcGFyZW50VmFyaWFudGlzZWRQYXRoXTtcclxuICAgICAgICAgICAgICAgIHZhciBuZXdEYXRhVmFsdWVBcnJheSA9ICgndjI6JyArIGRhdGFWYWx1ZSkuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgICAgIG5ld0RhdGFWYWx1ZUFycmF5WzFdID0gbmV3RGF0YVZhbHVlQXJyYXlbMV0gKyAnXycgKyB2YXJpYW50O1xyXG4gICAgICAgICAgICAgICAgZGF0YVZhbHVlID0gbmV3RGF0YVZhbHVlQXJyYXkuam9pbignLicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKHRhZ3NBc09iamVjdCkge1xyXG4gICAgICAgIHJldHVybiB7IFwiZGF0YS1jc2xwXCI6IGRhdGFWYWx1ZSB9O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIFwiZGF0YS1jc2xwPVwiLmNvbmNhdChkYXRhVmFsdWUpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGdldFBhcmVudFRhZ3NWYWx1ZShkYXRhVmFsdWUsIHRhZ3NBc09iamVjdCkge1xyXG4gICAgaWYgKHRhZ3NBc09iamVjdCkge1xyXG4gICAgICAgIHJldHVybiB7IFwiZGF0YS1jc2xwLXBhcmVudC1maWVsZFwiOiBkYXRhVmFsdWUgfTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBcImRhdGEtY3NscC1wYXJlbnQtZmllbGQ9XCIuY29uY2F0KGRhdGFWYWx1ZSk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZ2V0UGFyZW50VmFyaWFudGlzZWRQYXRoKGFwcGxpZWRWYXJpYW50cykge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgdHJ5IHtcclxuICAgICAgICAvLyBTYWZldHkgZmFsbGJhY2tcclxuICAgICAgICBpZiAoIWFwcGxpZWRWYXJpYW50cy5fYXBwbGllZF92YXJpYW50cylcclxuICAgICAgICAgICAgcmV0dXJuICcnO1xyXG4gICAgICAgIHZhciB2YXJpYW50aXNlZEZpZWxkUGF0aHMgPSBPYmplY3Qua2V5cyhhcHBsaWVkVmFyaWFudHMuX2FwcGxpZWRfdmFyaWFudHMpLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGIubGVuZ3RoIC0gYS5sZW5ndGg7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIGNoaWxkUGF0aEZyYWdtZW50c18xID0gYXBwbGllZFZhcmlhbnRzLm1ldGFLZXkuc3BsaXQoJy4nKTtcclxuICAgICAgICAvLyBTYWZldHkgZmFsbGJhY2tcclxuICAgICAgICBpZiAoY2hpbGRQYXRoRnJhZ21lbnRzXzEubGVuZ3RoID09PSAwIHx8IHZhcmlhbnRpc2VkRmllbGRQYXRocy5sZW5ndGggPT09IDApXHJcbiAgICAgICAgICAgIHJldHVybiAnJztcclxuICAgICAgICB2YXIgcGFyZW50VmFyaWFudGlzZWRQYXRoID0gKF9hID0gdmFyaWFudGlzZWRGaWVsZFBhdGhzLmZpbmQoZnVuY3Rpb24gKHBhdGgpIHtcclxuICAgICAgICAgICAgdmFyIHBhcmVudEZyYWdtZW50cyA9IHBhdGguc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgaWYgKHBhcmVudEZyYWdtZW50cy5sZW5ndGggPiBjaGlsZFBhdGhGcmFnbWVudHNfMS5sZW5ndGgpXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIHJldHVybiBwYXJlbnRGcmFnbWVudHMuZXZlcnkoZnVuY3Rpb24gKGZyYWdtZW50LCBpbmRleCkgeyByZXR1cm4gY2hpbGRQYXRoRnJhZ21lbnRzXzFbaW5kZXhdID09PSBmcmFnbWVudDsgfSk7XHJcbiAgICAgICAgfSkpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6ICcnO1xyXG4gICAgICAgIHJldHVybiBwYXJlbnRWYXJpYW50aXNlZFBhdGg7XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgIHJldHVybiAnJztcclxuICAgIH1cclxufVxuXG5mdW5jdGlvbiB1cGRhdGVBc3NldFVSTEZvckdRTChncWxSZXNwb25zZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICB2YXIgcmVzcG9uc2UgPSBncWxSZXNwb25zZSA9PT0gbnVsbCB8fCBncWxSZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZ3FsUmVzcG9uc2UuZGF0YTtcclxuICAgICAgICBmb3IgKHZhciBjb250ZW50VHlwZSBpbiByZXNwb25zZSkge1xyXG4gICAgICAgICAgICBpZiAoXCJpdGVtc1wiIGluIHJlc3BvbnNlW2NvbnRlbnRUeXBlXSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGVudHJpZXMgPSByZXNwb25zZVtjb250ZW50VHlwZV0uaXRlbXM7XHJcbiAgICAgICAgICAgICAgICBlbnRyaWVzLmZvckVhY2goZnVuY3Rpb24gKGVudHJ5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0VudHJ5KGVudHJ5KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcHJvY2Vzc0VudHJ5KHJlc3BvbnNlW2NvbnRlbnRUeXBlXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBpbiB1cGRhdGluZyBhc3NldCBVUkwgZm9yIEdRTCByZXNwb25zZScsIGVycm9yKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBwcm9jZXNzRW50cnkoZW50cnkpIHtcclxuICAgIGZvciAodmFyIGZpZWxkIGluIGVudHJ5KSB7XHJcbiAgICAgICAgdmFyIGZpZWxkRGF0YSA9IGVudHJ5W2ZpZWxkXTtcclxuICAgICAgICBpZiAoZmllbGREYXRhIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgZmllbGREYXRhLmZvckVhY2goZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIGZpbmRSVEVGaWVsZEFuZFVwZGF0ZVVSTChkYXRhKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGZpZWxkRGF0YSAmJiB0eXBlb2YgZmllbGREYXRhID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICBmaW5kUlRFRmllbGRBbmRVcGRhdGVVUkwoZmllbGREYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZmluZFJURUZpZWxkQW5kVXBkYXRlVVJMKGZpZWxkRGF0YSkge1xyXG4gICAgdmFyIF9hO1xyXG4gICAgdmFyIHJ0ZUZpZWxkID0gZmluZFJURUZpZWxkKGZpZWxkRGF0YSk7XHJcbiAgICBpZiAoIXJ0ZUZpZWxkKVxyXG4gICAgICAgIHJldHVybjtcclxuICAgIHZhciBlZGdlcyA9IChfYSA9IHJ0ZUZpZWxkID09PSBudWxsIHx8IHJ0ZUZpZWxkID09PSB2b2lkIDAgPyB2b2lkIDAgOiBydGVGaWVsZC5lbWJlZGRlZF9pdGVtc0Nvbm5lY3Rpb24pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5lZGdlcztcclxuICAgIGVkZ2VzLmZvckVhY2goZnVuY3Rpb24gKGVkZ2UpIHtcclxuICAgICAgICB2YXIgX2EsIF9iLCBfYztcclxuICAgICAgICB2YXIgbm9kZSA9IGVkZ2Uubm9kZTtcclxuICAgICAgICBpZiAoKG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZS51cmwpICYmIChub2RlID09PSBudWxsIHx8IG5vZGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG5vZGUuZmlsZW5hbWUpKSB7XHJcbiAgICAgICAgICAgIGlmICghKChfYSA9IG5vZGUgPT09IG51bGwgfHwgbm9kZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogbm9kZS5zeXN0ZW0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51aWQpKVxyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBc3NldCBVSUQgbm90IGZvdW5kIGluIHRoZSByZXNwb25zZScpO1xyXG4gICAgICAgICAgICB2YXIgY29ycmVzcG9uZGluZ0Fzc2V0ID0gKF9jID0gKF9iID0gcnRlRmllbGQgPT09IG51bGwgfHwgcnRlRmllbGQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJ0ZUZpZWxkLmpzb24pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5jaGlsZHJlbikgPT09IG51bGwgfHwgX2MgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9jLmZpbmQoZnVuY3Rpb24gKGNoaWxkKSB7IHJldHVybiBjaGlsZC5hdHRyc1snYXNzZXQtdWlkJ10gPT09IG5vZGUuc3lzdGVtLnVpZDsgfSk7XHJcbiAgICAgICAgICAgIGNvcnJlc3BvbmRpbmdBc3NldC5hdHRyc1snYXNzZXQtbGluayddID0gbm9kZS51cmw7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gZmluZFJURUZpZWxkKGZpZWxkRGF0YSkge1xyXG4gICAgaWYgKGZpZWxkRGF0YSAmJiBmaWVsZERhdGEuZW1iZWRkZWRfaXRlbXNDb25uZWN0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIGZpZWxkRGF0YTtcclxuICAgIH1cclxuICAgIGZvciAodmFyIGtleSBpbiBmaWVsZERhdGEpIHtcclxuICAgICAgICBpZiAoZmllbGREYXRhW2tleV0gJiYgdHlwZW9mIGZpZWxkRGF0YVtrZXldID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICB2YXIgZm91bmQgPSBmaW5kUlRFRmllbGQoZmllbGREYXRhW2tleV0pO1xyXG4gICAgICAgICAgICBpZiAoZm91bmQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmb3VuZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxuXG52YXIgcmVnaW9ucyA9IFtcblx0e1xuXHRcdGlkOiBcIm5hXCIsXG5cdFx0bmFtZTogXCJBV1MgTm9ydGggQW1lcmljYVwiLFxuXHRcdGNsb3VkUHJvdmlkZXI6IFwiQVdTXCIsXG5cdFx0bG9jYXRpb246IFwiTm9ydGggQW1lcmljYVwiLFxuXHRcdGFsaWFzOiBbXG5cdFx0XHRcIm5hXCIsXG5cdFx0XHRcInVzXCIsXG5cdFx0XHRcImF3cy1uYVwiLFxuXHRcdFx0XCJhd3NfbmFcIixcblx0XHRcdFwiTkFcIixcblx0XHRcdFwiVVNcIixcblx0XHRcdFwiQVdTLU5BXCIsXG5cdFx0XHRcIkFXU19OQVwiXG5cdFx0XSxcblx0XHRpc0RlZmF1bHQ6IHRydWUsXG5cdFx0ZW5kcG9pbnRzOiB7XG5cdFx0XHRhcHBsaWNhdGlvbjogXCJodHRwczovL2FwcC5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRjb250ZW50RGVsaXZlcnk6IFwiaHR0cHM6Ly9jZG4uY29udGVudHN0YWNrLmlvXCIsXG5cdFx0XHRjb250ZW50TWFuYWdlbWVudDogXCJodHRwczovL2FwaS5jb250ZW50c3RhY2suaW9cIixcblx0XHRcdGF1dGg6IFwiaHR0cHM6Ly9hdXRoLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRncmFwaHFsRGVsaXZlcnk6IFwiaHR0cHM6Ly9ncmFwaHFsLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdHByZXZpZXc6IFwiaHR0cHM6Ly9yZXN0LXByZXZpZXcuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Z3JhcGhxbFByZXZpZXc6IFwiaHR0cHM6Ly9ncmFwaHFsLXByZXZpZXcuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0aW1hZ2VzOiBcImh0dHBzOi8vaW1hZ2VzLmNvbnRlbnRzdGFjay5pb1wiLFxuXHRcdFx0YXNzZXRzOiBcImh0dHBzOi8vYXNzZXRzLmNvbnRlbnRzdGFjay5pb1wiLFxuXHRcdFx0YXV0b21hdGU6IFwiaHR0cHM6Ly9hdXRvbWF0aW9ucy1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0bGF1bmNoOiBcImh0dHBzOi8vbGF1bmNoLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRkZXZlbG9wZXJIdWI6IFwiaHR0cHM6Ly9kZXZlbG9wZXJodWItYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGJyYW5kS2l0OiBcImh0dHBzOi8vYnJhbmQta2l0cy1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Z2VuQUk6IFwiaHR0cHM6Ly9haS5jb250ZW50c3RhY2suY29tL2JyYW5kLWtpdHNcIixcblx0XHRcdHBlcnNvbmFsaXplTWFuYWdlbWVudDogXCJodHRwczovL3BlcnNvbmFsaXplLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRwZXJzb25hbGl6ZUVkZ2U6IFwiaHR0cHM6Ly9wZXJzb25hbGl6ZS1lZGdlLmNvbnRlbnRzdGFjay5jb21cIlxuXHRcdH1cblx0fSxcblx0e1xuXHRcdGlkOiBcImV1XCIsXG5cdFx0bmFtZTogXCJBV1MgRXVyb3BlXCIsXG5cdFx0Y2xvdWRQcm92aWRlcjogXCJBV1NcIixcblx0XHRsb2NhdGlvbjogXCJFdXJvcGVcIixcblx0XHRhbGlhczogW1xuXHRcdFx0XCJldVwiLFxuXHRcdFx0XCJhd3MtZXVcIixcblx0XHRcdFwiYXdzX2V1XCIsXG5cdFx0XHRcIkVVXCIsXG5cdFx0XHRcIkFXUy1FVVwiLFxuXHRcdFx0XCJBV1NfRVVcIlxuXHRcdF0sXG5cdFx0aXNEZWZhdWx0OiBmYWxzZSxcblx0XHRlbmRwb2ludHM6IHtcblx0XHRcdGFwcGxpY2F0aW9uOiBcImh0dHBzOi8vZXUtYXBwLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGNvbnRlbnREZWxpdmVyeTogXCJodHRwczovL2V1LWNkbi5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRjb250ZW50TWFuYWdlbWVudDogXCJodHRwczovL2V1LWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRhdXRoOiBcImh0dHBzOi8vZXUtYXV0aC1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Z3JhcGhxbERlbGl2ZXJ5OiBcImh0dHBzOi8vZXUtZ3JhcGhxbC5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRwcmV2aWV3OiBcImh0dHBzOi8vZXUtcmVzdC1wcmV2aWV3LmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGdyYXBocWxQcmV2aWV3OiBcImh0dHBzOi8vZXUtZ3JhcGhxbC1wcmV2aWV3LmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGltYWdlczogXCJodHRwczovL2V1LWltYWdlcy5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRhc3NldHM6IFwiaHR0cHM6Ly9ldS1hc3NldHMuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0YXV0b21hdGU6IFwiaHR0cHM6Ly9ldS1wcm9kLWF1dG9tYXRpb25zLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRsYXVuY2g6IFwiaHR0cHM6Ly9ldS1sYXVuY2gtYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGRldmVsb3Blckh1YjogXCJodHRwczovL2V1LWRldmVsb3Blcmh1Yi1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0YnJhbmRLaXQ6IFwiaHR0cHM6Ly9ldS1icmFuZC1raXRzLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRnZW5BSTogXCJodHRwczovL2V1LWFpLmNvbnRlbnRzdGFjay5jb20vYnJhbmQta2l0c1wiLFxuXHRcdFx0cGVyc29uYWxpemVNYW5hZ2VtZW50OiBcImh0dHBzOi8vZXUtcGVyc29uYWxpemUtYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdHBlcnNvbmFsaXplRWRnZTogXCJodHRwczovL2V1LXBlcnNvbmFsaXplLWVkZ2UuY29udGVudHN0YWNrLmNvbVwiXG5cdFx0fVxuXHR9LFxuXHR7XG5cdFx0aWQ6IFwiYXVcIixcblx0XHRuYW1lOiBcIkFXUyBBdXN0cmFsaWFcIixcblx0XHRjbG91ZFByb3ZpZGVyOiBcIkFXU1wiLFxuXHRcdGxvY2F0aW9uOiBcIkF1c3RyYWxpYVwiLFxuXHRcdGFsaWFzOiBbXG5cdFx0XHRcImF1XCIsXG5cdFx0XHRcImF3cy1hdVwiLFxuXHRcdFx0XCJhd3NfYXVcIixcblx0XHRcdFwiQVVcIixcblx0XHRcdFwiQVdTLUFVXCIsXG5cdFx0XHRcIkFXU19BVVwiXG5cdFx0XSxcblx0XHRpc0RlZmF1bHQ6IGZhbHNlLFxuXHRcdGVuZHBvaW50czoge1xuXHRcdFx0YXBwbGljYXRpb246IFwiaHR0cHM6Ly9hdS1hcHAuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Y29udGVudERlbGl2ZXJ5OiBcImh0dHBzOi8vYXUtY2RuLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGNvbnRlbnRNYW5hZ2VtZW50OiBcImh0dHBzOi8vYXUtYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGF1dGg6IFwiaHR0cHM6Ly9hdS1hdXRoLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRncmFwaHFsRGVsaXZlcnk6IFwiaHR0cHM6Ly9hdS1ncmFwaHFsLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdHByZXZpZXc6IFwiaHR0cHM6Ly9hdS1yZXN0LXByZXZpZXcuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Z3JhcGhxbFByZXZpZXc6IFwiaHR0cHM6Ly9hdS1ncmFwaHFsLXByZXZpZXcuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0aW1hZ2VzOiBcImh0dHBzOi8vYXUtaW1hZ2VzLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGFzc2V0czogXCJodHRwczovL2F1LWFzc2V0cy5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRhdXRvbWF0ZTogXCJodHRwczovL2F1LXByb2QtYXV0b21hdGlvbnMtYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGxhdW5jaDogXCJodHRwczovL2F1LWxhdW5jaC1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0ZGV2ZWxvcGVySHViOiBcImh0dHBzOi8vYXUtZGV2ZWxvcGVyaHViLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRicmFuZEtpdDogXCJodHRwczovL2F1LWJyYW5kLWtpdHMtYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGdlbkFJOiBcImh0dHBzOi8vYXUtYWkuY29udGVudHN0YWNrLmNvbS9icmFuZC1raXRzXCIsXG5cdFx0XHRwZXJzb25hbGl6ZU1hbmFnZW1lbnQ6IFwiaHR0cHM6Ly9hdS1wZXJzb25hbGl6ZS1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0cGVyc29uYWxpemVFZGdlOiBcImh0dHBzOi8vYXUtcGVyc29uYWxpemUtZWRnZS5jb250ZW50c3RhY2suY29tXCJcblx0XHR9XG5cdH0sXG5cdHtcblx0XHRpZDogXCJhenVyZS1uYVwiLFxuXHRcdG5hbWU6IFwiQXp1cmUgTm9ydGggQW1lcmljYVwiLFxuXHRcdGNsb3VkUHJvdmlkZXI6IFwiQXp1cmVcIixcblx0XHRsb2NhdGlvbjogXCJOb3J0aCBBbWVyaWNhXCIsXG5cdFx0YWxpYXM6IFtcblx0XHRcdFwiYXp1cmUtbmFcIixcblx0XHRcdFwiYXp1cmVfbmFcIixcblx0XHRcdFwiQVpVUkUtTkFcIixcblx0XHRcdFwiQVpVUkVfTkFcIlxuXHRcdF0sXG5cdFx0aXNEZWZhdWx0OiBmYWxzZSxcblx0XHRlbmRwb2ludHM6IHtcblx0XHRcdGFwcGxpY2F0aW9uOiBcImh0dHBzOi8vYXp1cmUtbmEtYXBwLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGNvbnRlbnREZWxpdmVyeTogXCJodHRwczovL2F6dXJlLW5hLWNkbi5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRjb250ZW50TWFuYWdlbWVudDogXCJodHRwczovL2F6dXJlLW5hLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRhdXRoOiBcImh0dHBzOi8vYXp1cmUtbmEtYXV0aC1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Z3JhcGhxbERlbGl2ZXJ5OiBcImh0dHBzOi8vYXp1cmUtbmEtZ3JhcGhxbC5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRwcmV2aWV3OiBcImh0dHBzOi8vYXp1cmUtbmEtcmVzdC1wcmV2aWV3LmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGdyYXBocWxQcmV2aWV3OiBcImh0dHBzOi8vYXp1cmUtbmEtZ3JhcGhxbC1wcmV2aWV3LmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGltYWdlczogXCJodHRwczovL2F6dXJlLW5hLWltYWdlcy5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRhc3NldHM6IFwiaHR0cHM6Ly9henVyZS1uYS1hc3NldHMuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0YXV0b21hdGU6IFwiaHR0cHM6Ly9henVyZS1uYS1hdXRvbWF0aW9ucy1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0bGF1bmNoOiBcImh0dHBzOi8vYXp1cmUtbmEtbGF1bmNoLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRkZXZlbG9wZXJIdWI6IFwiaHR0cHM6Ly9henVyZS1uYS1kZXZlbG9wZXJodWItYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGJyYW5kS2l0OiBcImh0dHBzOi8vYXp1cmUtbmEtYnJhbmQta2l0cy1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Z2VuQUk6IFwiaHR0cHM6Ly9henVyZS1uYS1haS5jb250ZW50c3RhY2suY29tL2JyYW5kLWtpdHNcIixcblx0XHRcdHBlcnNvbmFsaXplTWFuYWdlbWVudDogXCJodHRwczovL2F6dXJlLW5hLXBlcnNvbmFsaXplLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRwZXJzb25hbGl6ZUVkZ2U6IFwiaHR0cHM6Ly9henVyZS1uYS1wZXJzb25hbGl6ZS1lZGdlLmNvbnRlbnRzdGFjay5jb21cIlxuXHRcdH1cblx0fSxcblx0e1xuXHRcdGlkOiBcImF6dXJlLWV1XCIsXG5cdFx0bmFtZTogXCJBenVyZSBFdXJvcGVcIixcblx0XHRjbG91ZFByb3ZpZGVyOiBcIkF6dXJlXCIsXG5cdFx0bG9jYXRpb246IFwiRXVyb3BlXCIsXG5cdFx0YWxpYXM6IFtcblx0XHRcdFwiYXp1cmUtZXVcIixcblx0XHRcdFwiYXp1cmVfZXVcIixcblx0XHRcdFwiQVpVUkUtRVVcIixcblx0XHRcdFwiQVpVUkVfRVVcIlxuXHRcdF0sXG5cdFx0aXNEZWZhdWx0OiBmYWxzZSxcblx0XHRlbmRwb2ludHM6IHtcblx0XHRcdGFwcGxpY2F0aW9uOiBcImh0dHBzOi8vYXp1cmUtZXUtYXBwLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGNvbnRlbnREZWxpdmVyeTogXCJodHRwczovL2F6dXJlLWV1LWNkbi5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRjb250ZW50TWFuYWdlbWVudDogXCJodHRwczovL2F6dXJlLWV1LWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRhdXRoOiBcImh0dHBzOi8vYXp1cmUtZXUtYXV0aC1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Z3JhcGhxbERlbGl2ZXJ5OiBcImh0dHBzOi8vYXp1cmUtZXUtZ3JhcGhxbC5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRwcmV2aWV3OiBcImh0dHBzOi8vYXp1cmUtZXUtcmVzdC1wcmV2aWV3LmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGdyYXBocWxQcmV2aWV3OiBcImh0dHBzOi8vYXp1cmUtZXUtZ3JhcGhxbC1wcmV2aWV3LmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGltYWdlczogXCJodHRwczovL2F6dXJlLWV1LWltYWdlcy5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRhc3NldHM6IFwiaHR0cHM6Ly9henVyZS1ldS1hc3NldHMuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0YXV0b21hdGU6IFwiaHR0cHM6Ly9henVyZS1ldS1hdXRvbWF0aW9ucy1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0bGF1bmNoOiBcImh0dHBzOi8vYXp1cmUtZXUtbGF1bmNoLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRkZXZlbG9wZXJIdWI6IFwiaHR0cHM6Ly9henVyZS1ldS1kZXZlbG9wZXJodWItYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGJyYW5kS2l0OiBcImh0dHBzOi8vYXp1cmUtZXUtYnJhbmQta2l0cy1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Z2VuQUk6IFwiaHR0cHM6Ly9henVyZS1ldS1haS5jb250ZW50c3RhY2suY29tL2JyYW5kLWtpdHNcIixcblx0XHRcdHBlcnNvbmFsaXplTWFuYWdlbWVudDogXCJodHRwczovL2F6dXJlLWV1LXBlcnNvbmFsaXplLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRwZXJzb25hbGl6ZUVkZ2U6IFwiaHR0cHM6Ly9henVyZS1ldS1wZXJzb25hbGl6ZS1lZGdlLmNvbnRlbnRzdGFjay5jb21cIlxuXHRcdH1cblx0fSxcblx0e1xuXHRcdGlkOiBcImdjcC1uYVwiLFxuXHRcdG5hbWU6IFwiR0NQIE5vcnRoIEFtZXJpY2FcIixcblx0XHRjbG91ZFByb3ZpZGVyOiBcIkdDUFwiLFxuXHRcdGxvY2F0aW9uOiBcIk5vcnRoIEFtZXJpY2FcIixcblx0XHRhbGlhczogW1xuXHRcdFx0XCJnY3AtbmFcIixcblx0XHRcdFwiZ2NwX25hXCIsXG5cdFx0XHRcIkdDUC1OQVwiLFxuXHRcdFx0XCJHQ1BfTkFcIlxuXHRcdF0sXG5cdFx0aXNEZWZhdWx0OiBmYWxzZSxcblx0XHRlbmRwb2ludHM6IHtcblx0XHRcdGFwcGxpY2F0aW9uOiBcImh0dHBzOi8vZ2NwLW5hLWFwcC5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRjb250ZW50RGVsaXZlcnk6IFwiaHR0cHM6Ly9nY3AtbmEtY2RuLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGNvbnRlbnRNYW5hZ2VtZW50OiBcImh0dHBzOi8vZ2NwLW5hLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRhdXRoOiBcImh0dHBzOi8vZ2NwLW5hLWF1dGgtYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGdyYXBocWxEZWxpdmVyeTogXCJodHRwczovL2djcC1uYS1ncmFwaHFsLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdHByZXZpZXc6IFwiaHR0cHM6Ly9nY3AtbmEtcmVzdC1wcmV2aWV3LmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGdyYXBocWxQcmV2aWV3OiBcImh0dHBzOi8vZ2NwLW5hLWdyYXBocWwtcHJldmlldy5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRpbWFnZXM6IFwiaHR0cHM6Ly9nY3AtbmEtaW1hZ2VzLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGFzc2V0czogXCJodHRwczovL2djcC1uYS1hc3NldHMuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0YXV0b21hdGU6IFwiaHR0cHM6Ly9nY3AtbmEtYXV0b21hdGlvbnMtYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGxhdW5jaDogXCJodHRwczovL2djcC1uYS1sYXVuY2gtYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGRldmVsb3Blckh1YjogXCJodHRwczovL2djcC1uYS1kZXZlbG9wZXJodWItYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGJyYW5kS2l0OiBcImh0dHBzOi8vZ2NwLW5hLWJyYW5kLWtpdHMtYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGdlbkFJOiBcImh0dHBzOi8vZ2NwLW5hLWFpLmNvbnRlbnRzdGFjay5jb20vYnJhbmQta2l0c1wiLFxuXHRcdFx0cGVyc29uYWxpemVNYW5hZ2VtZW50OiBcImh0dHBzOi8vZ2NwLW5hLXBlcnNvbmFsaXplLWFwaS5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRwZXJzb25hbGl6ZUVkZ2U6IFwiaHR0cHM6Ly9nY3AtbmEtcGVyc29uYWxpemUtZWRnZS5jb250ZW50c3RhY2suY29tXCJcblx0XHR9XG5cdH0sXG5cdHtcblx0XHRpZDogXCJnY3AtZXVcIixcblx0XHRuYW1lOiBcIkdDUCBFdXJvcGVcIixcblx0XHRjbG91ZFByb3ZpZGVyOiBcIkdDUFwiLFxuXHRcdGxvY2F0aW9uOiBcIkV1cm9wZVwiLFxuXHRcdGFsaWFzOiBbXG5cdFx0XHRcImdjcC1ldVwiLFxuXHRcdFx0XCJnY3BfZXVcIixcblx0XHRcdFwiR0NQLUVVXCIsXG5cdFx0XHRcIkdDUF9FVVwiXG5cdFx0XSxcblx0XHRpc0RlZmF1bHQ6IGZhbHNlLFxuXHRcdGVuZHBvaW50czoge1xuXHRcdFx0YXBwbGljYXRpb246IFwiaHR0cHM6Ly9nY3AtZXUtYXBwLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGNvbnRlbnREZWxpdmVyeTogXCJodHRwczovL2djcC1ldS1jZG4uY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Y29udGVudE1hbmFnZW1lbnQ6IFwiaHR0cHM6Ly9nY3AtZXUtYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGF1dGg6IFwiaHR0cHM6Ly9nY3AtZXUtYXV0aC1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Z3JhcGhxbERlbGl2ZXJ5OiBcImh0dHBzOi8vZ2NwLWV1LWdyYXBocWwuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0cHJldmlldzogXCJodHRwczovL2djcC1ldS1yZXN0LXByZXZpZXcuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Z3JhcGhxbFByZXZpZXc6IFwiaHR0cHM6Ly9nY3AtZXUtZ3JhcGhxbC1wcmV2aWV3LmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdGltYWdlczogXCJodHRwczovL2djcC1ldS1pbWFnZXMuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0YXNzZXRzOiBcImh0dHBzOi8vZ2NwLWV1LWFzc2V0cy5jb250ZW50c3RhY2suY29tXCIsXG5cdFx0XHRhdXRvbWF0ZTogXCJodHRwczovL2djcC1ldS1hdXRvbWF0aW9ucy1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0bGF1bmNoOiBcImh0dHBzOi8vZ2NwLWV1LWxhdW5jaC1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0ZGV2ZWxvcGVySHViOiBcImh0dHBzOi8vZ2NwLWV1LWRldmVsb3Blcmh1Yi1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0YnJhbmRLaXQ6IFwiaHR0cHM6Ly9nY3AtZXUtYnJhbmQta2l0cy1hcGkuY29udGVudHN0YWNrLmNvbVwiLFxuXHRcdFx0Z2VuQUk6IFwiaHR0cHM6Ly9nY3AtZXUtYWkuY29udGVudHN0YWNrLmNvbS9icmFuZC1raXRzXCIsXG5cdFx0XHRwZXJzb25hbGl6ZU1hbmFnZW1lbnQ6IFwiaHR0cHM6Ly9nY3AtZXUtcGVyc29uYWxpemUtYXBpLmNvbnRlbnRzdGFjay5jb21cIixcblx0XHRcdHBlcnNvbmFsaXplRWRnZTogXCJodHRwczovL2djcC1ldS1wZXJzb25hbGl6ZS1lZGdlLmNvbnRlbnRzdGFjay5jb21cIlxuXHRcdH1cblx0fVxuXTtcbnZhciByZWdpb25zRGF0YSA9IHtcblx0cmVnaW9uczogcmVnaW9uc1xufTtcblxuZnVuY3Rpb24gZ2V0Q29udGVudHN0YWNrRW5kcG9pbnQocmVnaW9uLCBzZXJ2aWNlLCBvbWl0SHR0cHMpIHtcclxuICAgIGlmIChyZWdpb24gPT09IHZvaWQgMCkgeyByZWdpb24gPSAndXMnOyB9XHJcbiAgICBpZiAoc2VydmljZSA9PT0gdm9pZCAwKSB7IHNlcnZpY2UgPSAnJzsgfVxyXG4gICAgaWYgKG9taXRIdHRwcyA9PT0gdm9pZCAwKSB7IG9taXRIdHRwcyA9IGZhbHNlOyB9XHJcbiAgICAvLyBWYWxpZGF0ZSBlbXB0eSByZWdpb24gYmVmb3JlIGFueSBwcm9jZXNzaW5nXHJcbiAgICBpZiAocmVnaW9uID09PSAnJykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRW1wdHkgcmVnaW9uIHByb3ZpZGVkLiBQbGVhc2UgcHV0IHZhbGlkIHJlZ2lvbi4nKTtcclxuICAgIH1cclxuICAgIHZhciByZWdpb25zID0gcmVnaW9uc0RhdGE7XHJcbiAgICAvLyBOb3JtYWxpemUgdGhlIHJlZ2lvbiBpbnB1dFxyXG4gICAgdmFyIG5vcm1hbGl6ZWRSZWdpb24gPSByZWdpb24udG9Mb3dlckNhc2UoKS50cmltKCkgfHwgJ3VzJztcclxuICAgIC8vIENoZWNrIGlmIHJlZ2lvbnMgZGF0YSBpcyBtYWxmb3JtZWRcclxuICAgIGlmICghQXJyYXkuaXNBcnJheShyZWdpb25zLnJlZ2lvbnMpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIFJlZ2lvbnMgZmlsZS4gUGxlYXNlIGluc3RhbGwgdGhlIFNESyBhZ2FpbiB0byBmaXggdGhpcyBpc3N1ZS4nKTtcclxuICAgIH1cclxuICAgIC8vIEZpbmQgdGhlIHJlZ2lvbiBieSBJRCBvciBhbGlhc1xyXG4gICAgdmFyIHJlZ2lvbkRhdGEgPSBmaW5kUmVnaW9uQnlJRE9yQWxpYXMocmVnaW9ucy5yZWdpb25zLCBub3JtYWxpemVkUmVnaW9uKTtcclxuICAgIGlmICghcmVnaW9uRGF0YSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgcmVnaW9uOiBcIi5jb25jYXQocmVnaW9uKSk7XHJcbiAgICB9XHJcbiAgICAvLyBHZXQgdGhlIGVuZHBvaW50KHMpXHJcbiAgICBpZiAoc2VydmljZSkge1xyXG4gICAgICAgIC8vIFJldHVybiBzcGVjaWZpYyBzZXJ2aWNlIGVuZHBvaW50XHJcbiAgICAgICAgdmFyIGVuZHBvaW50ID0gcmVnaW9uRGF0YS5lbmRwb2ludHNbc2VydmljZV07XHJcbiAgICAgICAgaWYgKCFlbmRwb2ludCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTZXJ2aWNlIFxcXCJcIi5jb25jYXQoc2VydmljZSwgXCJcXFwiIG5vdCBmb3VuZCBmb3IgcmVnaW9uIFxcXCJcIikuY29uY2F0KHJlZ2lvbkRhdGEuaWQsIFwiXFxcIlwiKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBvbWl0SHR0cHMgPyBzdHJpcEh0dHBzKGVuZHBvaW50KSA6IGVuZHBvaW50O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIG9taXRIdHRwcyA/IHN0cmlwSHR0cHMocmVnaW9uRGF0YS5lbmRwb2ludHMpIDogcmVnaW9uRGF0YS5lbmRwb2ludHM7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gZmluZFJlZ2lvbkJ5SURPckFsaWFzKHJlZ2lvbnMsIHJlZ2lvbklucHV0KSB7XHJcbiAgICAvLyBGaXJzdCB0cnkgdG8gZmluZCBieSBleGFjdCBJRCBtYXRjaFxyXG4gICAgdmFyIHJlZ2lvbiA9IHJlZ2lvbnMuZmluZChmdW5jdGlvbiAocikgeyByZXR1cm4gci5pZCA9PT0gcmVnaW9uSW5wdXQ7IH0pO1xyXG4gICAgaWYgKHJlZ2lvbikge1xyXG4gICAgICAgIHJldHVybiByZWdpb247XHJcbiAgICB9XHJcbiAgICAvLyBUaGVuIHRyeSB0byBmaW5kIGJ5IGFsaWFzXHJcbiAgICByZWdpb24gPSByZWdpb25zLmZpbmQoZnVuY3Rpb24gKHIpIHtcclxuICAgICAgICByZXR1cm4gci5hbGlhcy5zb21lKGZ1bmN0aW9uIChhbGlhcykgeyByZXR1cm4gYWxpYXMudG9Mb3dlckNhc2UoKSA9PT0gcmVnaW9uSW5wdXQudG9Mb3dlckNhc2UoKTsgfSk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiByZWdpb24gfHwgbnVsbDtcclxufVxyXG5mdW5jdGlvbiBzdHJpcEh0dHBzKGVuZHBvaW50KSB7XHJcbiAgICBpZiAodHlwZW9mIGVuZHBvaW50ID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIHJldHVybiBlbmRwb2ludC5yZXBsYWNlKC9eaHR0cHM/OlxcL1xcLy8sICcnKTtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHZhciByZXN1bHQgPSB7fTtcclxuICAgICAgICBmb3IgKHZhciBrZXkgaW4gZW5kcG9pbnQpIHtcclxuICAgICAgICAgICAgcmVzdWx0W2tleV0gPSBzdHJpcEh0dHBzKGVuZHBvaW50W2tleV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG59XG5cbmV4cG9ydHMuRG9jdW1lbnQgPSBEb2N1bWVudDtcbmV4cG9ydHMuR1FMID0gR1FMO1xuZXhwb3J0cy5NYXJrVHlwZSA9IE1hcmtUeXBlJDE7XG5leHBvcnRzLk5vZGUgPSBOb2RlO1xuZXhwb3J0cy5Ob2RlVHlwZSA9IE5vZGVUeXBlJDE7XG5leHBvcnRzLlN0eWxlVHlwZSA9IFN0eWxlVHlwZSQxO1xuZXhwb3J0cy5UZXh0Tm9kZSA9IFRleHROb2RlO1xuZXhwb3J0cy5hZGRFZGl0YWJsZVRhZ3MgPSBhZGRUYWdzO1xuZXhwb3J0cy5hdHRyaWJ1dGVUb1N0cmluZyA9IGF0dHJpYnV0ZVRvU3RyaW5nO1xuZXhwb3J0cy5nZXRDb250ZW50c3RhY2tFbmRwb2ludCA9IGdldENvbnRlbnRzdGFja0VuZHBvaW50O1xuZXhwb3J0cy5qc29uVG9IVE1MID0ganNvblRvSFRNTCQxO1xuZXhwb3J0cy5yZW5kZXIgPSByZW5kZXI7XG5leHBvcnRzLnJlbmRlckNvbnRlbnQgPSByZW5kZXJDb250ZW50O1xuZXhwb3J0cy51cGRhdGVBc3NldFVSTEZvckdRTCA9IHVwZGF0ZUFzc2V0VVJMRm9yR1FMO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguZXMuanMubWFwXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/@contentstack/utils/dist/index.es.js\n");

/***/ })

};
;